!function(){define("utils/query_param",[],function(){"use strict";return function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}}),define("jqueryui/widget",["jquery"],function(a){return function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;h<i;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(a.isPlainObject(f)?c[e]=a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):c[e]=f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,h?this.each(function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}):this.each(function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(a),a}),define("widgets/ad",["lodash","jquery","jqueryui/widget"],function(a,b){"use strict";b.widget("ted.ad",{_rendered:!1,$image:null,$text:null,$link:null,blocked:function(){this.element.hide()},refreshJsonAd:function(){if(this.options.blocked)return void this.blocked();if(this._rendered||(this._addAdClass(),this.element.children().addClass("ad__prefill"),this._getAppreciationText().appendTo(this.element),this.$link=b('<a class="ad__unit" href="#" rel="nofollow" target="_blank">').appendTo(this.element),this.$image=b("<img>").appendTo(this.$link),this._rendered=!0),!this.options.ad)return void this.element.hide();var a=this._getRenderDetails();this.$link.attr("href",a.click),this.$image.attr({src:a.currentCreative.url,width:a.dimensions.width,height:a.dimensions.height}),this.element[this.options.ad.hasDisplay===!1?"hide":"show"](),this._impress()},refreshHtmlAd:function(){this._addAdClass(),this._getAppreciationText().prependTo(this.element)},_init:function(){var a=String(this.options.mode);this._rendered=!1,"json"===a?this.refreshJsonAd():"html"===a&&this.refreshHtmlAd()},_fireImpression:function(a){var b=new Image;b.src=a},_impress:function(){this._fireImpression(this.options.ad.impression),a.forEach(this.options.ad.thirdPartyImpressions,this._fireImpression)},_getCreative:function(){var b=a.filter(this.options.ad.creative,function(a){return""!==a.url}),c=Math.max(window.devicePixelRatio||1,1);return a.reduce(b,function(a,b){return b.density<=c?b:a||b},{})},_getRenderDetails:function(){return a.extend({currentCreative:this._getCreative()},this.options.ad)},_getAppreciationText:function(){return this.$text=b('<div class="ad__text">TED Talks are free thanks to our partners &amp; advertisers</div>'),this.$text},_addAdClass:function(){this.element.addClass("ad")}})}),define("hbs/underscore",{}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("hbs!templates/sponsorshipBug",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<a class="sponsorship-bug__link" href="#" rel="nofollow" target="_blank" style="display:block"><img src="" alt=""></a>\n'},useData:!0});return b.registerPartial("templates/sponsorshipBug",c),c}),define("widgets/sponsorshipBug",["jquery","hbs!templates/sponsorshipBug","widgets/ad"],function(a,b){"use strict";a.widget("ted.sponsorshipBug",a.ted.ad,{blocked:function(){},refreshHtmlAd:function(){},refreshJsonAd:function(){return this.options.blocked?this.blocked():(this._rendered||(this.element.children().addClass("sponsorship-bug__prefill"),this.element.append(b()),this.$image=this.element.find("img"),this.$link=this.element.find("a.sponsorship-bug__link"),this._rendered=!0),void this._super())},_init:function(){this.element.closest("div.sponsorship-bug").addClass("sponsorship-bug--active"),this._super()}})}),define("lib/ads",["jquery","lodash","utils/query_param","exports","widgets/ad","widgets/sponsorshipBug"],function(a,b,c,d){"use strict";function e(a){var b=new Image;b.src=a}function f(b){var c=String(b.type),d=l[b.type];"master"===c?m.deferred.resolve(b):void 0===d?window.console&&console.log&&(console.log("Unknown ad type"),console.log(b)):a(d.id)[d.widget]({ad:b,mode:"json"})}function g(c){b.forEach(m.companionAdSlots,function(b){if(b.gptSlot.setTargeting(b.key,c.target),b.displayed){var e=a("#"+b.containerId);e.data("tedAd")?e.ad("destroy"):e.data("sponsorshipBug")&&e.sponsorshipBug("destroy"),d.refreshAd(b.gptSlot)}else d.displayAd(b.containerId);b.displayed=!0}),c.impression&&e(c.impression)}function h(a){return a.replace("{adUnit}",m.slot.adUnit)}function i(a){n.done(function(b){b.isMai||d.player.player("sendAds",{postroll:h(a.postrollURL),preroll:h(a.prerollURL)})})}function j(b){var c=d.player=b;if(c){var e=c.player("isMai"),h=d.playerMode=String(c.player("mode"));if(d.setMasterDeets({isMai:c.player("isMai"),maiAdUnitId:c.player("maiAdUnitId")}),e)c.on({playerad:function(a,b){f(b.ad)}}),m.deferred.done(g);else{m.deferred.done(g),c.on({playeradblock:function(){var b=l.bug;a(b.id)[b.widget]({blocked:!0})}});var j=!0;c.on({playertalk:function(a,b){var e=String(c.player("talks")[0].id),f=String(b.id);j&&e===f?(j=!1,"flash"===h&&m.deferred.done(i)):d.refreshMasterAd({targeting:b.targeting}),j=!1}})}}}function k(){b.forEach(m.slot.targeting,function(a,c){m.slot.gptSlot.setTargeting(c,b.isArray(a)?a.join(","):a)});var a=c("dfptest");a&&m.slot.gptSlot.setTargeting("dfptest",a)}var l={bug:{id:"#sponsorship-bug-placeholder",widget:"sponsorshipBug"},companion:{id:"#ad-unit",widget:"ad"},"companion-mobile":{id:"#ad-unit-mobile",widget:"ad"},devil:{id:"#devil-ad",widget:"ad"},onPage:{id:"#ad-unit",widget:"ad"}},m={companionAdSlots:[],deferred:a.Deferred(),slot:{adUnit:null,containerId:null,gptSlot:null,targeting:{}}};d._masterAd=m,d.player=null;var n=a.Deferred();window.googletag=window.googletag||{cmd:[]},d.slotRenderEndedHandler=function(c){if(c&&c.slot&&!c.isEmpty){var d,e="ad",f="tedAd",g=b.find(m.companionAdSlots,function(a){return a.gptSlot===c.slot}),h=g&&String(g.containerId);"ad-unit"===h&&(d=a("#ad-unit")),"sponsorship-bug-placeholder"===h&&(d=a("#sponsorship-bug-placeholder"),e="sponsorshipBug",f="tedSponsorshipBug");var i=c.slot.getSlotElementId&&c.slot.getSlotElementId();if(!g&&i&&(d=a("#"+i)),"master-gpt"!==h&&"master-gpt"!==i&&d&&d.length){var j=d.data(f);j||d[e]({mode:"html"})}}},d.displayMasterAd=function(a){n.done(function(c){c.isMai||(m.slot.containerId=a.containerId,m.slot.adUnit=c.adUnitId,window.googletag.cmd.push(function(){m.slot.gptSlot=googletag.defineOutOfPageSlot(m.slot.adUnit,m.slot.containerId).addService(googletag.pubads()),b.assign(m.slot.targeting,a.targeting),k(),d.displayAd(m.slot.containerId)}))})},d.refreshMasterAd=function(c){m.slot.gptSlot&&(m.deferred=a.Deferred(),m.deferred.done(g),"flash"===d.playerMode&&m.deferred.done(i),m.slot.gptSlot.clearTargeting(),b.forEach(m.companionAdSlots,function(a){a.gptSlot.clearTargeting()}),b.assign(m.slot.targeting,c.targeting),k(),d.refreshAd(m.slot.gptSlot))},d.displayAd=function(b){a(function(){window.googletag.cmd.push(function(){googletag.display(b)})})},d.refreshAd=function(a){window.googletag.cmd.push(function(){googletag.pubads().refresh([a])})},d.createStandardSlot=function(a){window.googletag.cmd.push(function(){var b=googletag.defineSlot(a.adUnitId,a.size,a.containerId).addService(googletag.pubads()),e=c("dfptest");e&&b.setTargeting("dfptest",e),d.displayAd(a.containerId)})},d.createCompanionSlot=function(a){n.done(function(b){window.googletag.cmd.push(function(){var c=googletag.defineSlot(b.adUnitId,a.size,a.containerId).addService(googletag.pubads());m.companionAdSlots.push({containerId:a.containerId,gptSlot:c,key:a.key})})})};var o={};d.setMasterDeets=function(b){a.extend(o,b),o.hasOwnProperty("isMai")&&o.hasOwnProperty("gptAdUnitId")&&o.hasOwnProperty("maiAdUnitId")&&n.resolve({isMai:o.isMai,adUnitId:o.isMai?o.maiAdUnitId:o.gptAdUnitId})},d.initPlayer=j,d.gptAd=function(a){f(a.ad)},window.googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",d.slotRenderEndedHandler)})}),define("hbs!apps/embeddable/templates/error",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){return"        Sorry:\n        we can't play video on this browser.\n        Please make sure it's up to date\n        and that Flash 11.1 or higher is installed.\n"},3:function(a,b,c,d){return"        We're sorry:\n        video playback cannot be initialized\n        on your browser at this time.\n"},5:function(a,b,c,d){return"        We're sorry:\n        video playback has been interrupted.\n        You may need to refresh the page\n        to resume.\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'\n<div class="Embeddable__error vc inverse">\n  <div class="vc__wrap">\n    <div class="Embeddable__error__message">\n'+(null!=(e=b["if"].call(a,null!=a?a.isClient:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b["if"].call(a,null!=a?a.isInit:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b["if"].call(a,null!=a?a.isFatal:a,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+'\n      <a href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'" target="_blank">Load this talk on ted.com</a>\n    </div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("apps/embeddable/templates/error",c),c}),define("apps/embeddable/models/talk",["lodash","Backbone"],function(a,b){"use strict";var c=b.Model.extend({toPlayer:function(){var b=this.toJSON();return{id:b.id,resources:{hls:{stream:b.resources.hls.stream,adUrl:b.resources.hls.adUrl},h264:[{file:b.resources.h264[0].file}]},duration:b.duration,introDuration:b.introDuration,adDuration:b.adDuration,postAdDuration:b.postAdDuration,nativeLanguage:b.nativeLanguage,languages:a.map(b.languages,function(a){return{langaugeName:a.languageName,languageCode:a.languageCode,isRtl:a.isRtl}})}}});return c}),define("apps/embeddable/collections/talks",["lodash","Backbone","apps/embeddable/models/talk"],function(a,b,c){"use strict";var d=b.Collection.extend({model:c,before:function(a){return this.at(this.indexOf(a)-1)},after:function(a){return this.at(this.indexOf(a)+1)},toPlayer:function(){return this.map(function(a){return a.toPlayer()})}});return d}),define("views/mixins/cached-find",["exports"],function(a){"use strict";a._findEls=null,a.find=function(a){if(this._findEls||(this._findEls={}),this._findEls[a])return this._findEls[a];var b=this.$el.find(a);return b.length&&(this._findEls[a]=b),b}}),define("apps/embeddable/views/base",["lodash","Backbone","views/mixins/cached-find"],function(a,b,c){"use strict";var d=b.View.extend({propsDefaults:null,stateDefaults:null,propsEvents:null,stateEvents:null,adoptView:function(b){a.extend(this.propsDefaults,b.prototype.propsDefaults),a.extend(this.stateDefaults,b.prototype.stateDefaults),a.extend(this.propsEvents,b.prototype.propsEvents),a.extend(this.stateEvents,b.prototype.stateEvents)},initialize:function(){this.initializeState(),this.initializeProps()},initializeProps:function(){this.props=this._eventModel(this.propsDefaults,this.propsEvents)},initializeState:function(){this.state=this._eventModel(this.stateDefaults,this.stateEvents)},toggleClass:function(a,b,c){this.find(a)[c?"addClass":"removeClass"](b)},_eventModel:function(c,d){if(!c)return!1;var e=new b.Model(c),f=this;return a.forOwn(d,function(b,c){a.isString(b)&&(b=f[b]);var d=c.split(":");"on"===d[0]&&(c="change:"+d[1],b=a.wrap(b,function(a,b,c){c&&a.call(f)})),f.listenTo(e,c,b)}),e}});return a.extend(d.prototype,c),d}),define("apps/embeddable/utils/toggle-class",[],function(){"use strict";return function(a,b){return function(c,d){this.toggleClass(a,b,d)}}}),define("apps/embeddable/utils/untoggle-class",[],function(){"use strict";return function(a,b){return function(c,d){this.toggleClass(a,b,!d)}}}),define("utils/formatDuration",[],function(){"use strict";function a(a){return(a>9?"":"0")+a}return function(b){var c=b%60|0,d=b/3600|0,e=b%3600/60|0;return(d?d+":"+a(e):e)+":"+a(c)}}),define("templates/helpers/icon",["Handlebars"],function(a){"use strict";function b(a,b,d){return a=c(a),b=c(b),d=c(d),'<i class="icon icon_'+a+" "+(d||"")+'">'+(b?"<span class=screen-reader-text>"+b+"</span>":"")+"</i>"}var c=a.Utils.escapeExpression;return a.registerHelper("icon",function(c,d,e){return new a.SafeString(b(c,d,e))}),b}),define("hbs!apps/embeddable/templates/controls",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="Embeddable__controls__bar">\n  <a class="Embeddable__button Embeddable__controls__unskip" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-unskip","Previous talk","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n  </a>\n\n  <a class="Embeddable__button Embeddable__controls__play" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-play","Play","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n  </a>\n\n  <a class="Embeddable__button Embeddable__controls__pause" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-pause","Pause","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n  </a>\n\n  <a class="Embeddable__button Embeddable__controls__skip" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-skip","Next talk","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n  </a>\n\n  <a class="Embeddable__button Embeddable__controls__volume" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-volume","Volume","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n  </a>\n\n  <span class="Embeddable__controls__timing">\n    <span class="Embeddable__controls__current">0:00</span>/<span class="Embeddable__controls__duration">0:00</span>\n  </span>\n\n  <div class="Embeddable__controls__secondary">\n    <a class="Embeddable__button Embeddable__controls__subtitles" href="#">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-subtitles","Subtitles","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="Embeddable__button Embeddable__controls__playlist" href="#">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-playlist","Show talks","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="Embeddable__button Embeddable__controls__fullscreen" href="#">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-fullscreen","Full screen","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'\n    </a>\n\n    <a class="Embeddable__button Embeddable__controls__smallscreen" href="#">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-fullscreen-exit","Exit full screen","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+"\n    </a>\n  </div>\n</div>\n"},useData:!0});return b.registerPartial("apps/embeddable/templates/controls",c),c}),define("apps/embeddable/views/controls",["./base","apps/embeddable/utils/toggle-class","apps/embeddable/utils/untoggle-class","utils/formatDuration","hbs!apps/embeddable/templates/controls"],function(a,b,c,d,e){"use strict";var f=a.extend({className:"Embeddable__controls",propsDefaults:{unskipEnabled:!1,playEnabled:!1,pauseEnabled:!1,skipEnabled:!1,volumeActive:!1,volumeEnabled:!1,volumeMuted:!1,timingEnabled:!0,subtitlesEnabled:!1,subtitlesActive:!1,subtitlesEffective:!1,playlistEnabled:!1,playlistActive:!1,fullscreenEnabled:!1,fullscreen:!1},propsEvents:{"change:unskipEnabled":"renderUnskip","change:playEnabled":"renderPlay","change:pauseEnabled":"renderPause","change:skipEnabled":"renderSkip","change:volumeEnabled":"renderVolume","change:volumeMuted":"renderVolume","change:volumeActive":b("a.Embeddable__controls__volume","Embeddable__button--active"),"change:timingEnabled":c("span.Embeddable__controls__timing","Embeddable__controls__timing--inapplicable"),"change:subtitlesEnabled":"renderSubtitles","change:subtitlesActive":b("a.Embeddable__controls__subtitles","Embeddable__button--active"),"change:subtitlesEffective":b("a.Embeddable__controls__subtitles","Embeddable__button--effective"),"change:playlistActive":b("a.Embeddable__controls__playlist","Embeddable__button--active"),"change:playlistEnabled":"renderPlaylist","change:fullscreenEnabled":"renderFullscreen","change:fullscreen":"renderFullscreen"},render:function(){return this.$el.html(e()),this.renderUnskip(),this.renderPlay(),this.renderPause(),this.renderSkip(),this.renderVolume(),this.renderSubtitles(),this.renderPlaylist(),this.renderFullscreen(),this},renderCurrent:function(a){this.find("span.Embeddable__controls__current").text(d(a))},renderDuration:function(a){this.find("span.Embeddable__controls__duration").text(d(a))},renderUnskip:c("a.Embeddable__controls__unskip","Embeddable__button--disabled"),renderPlay:c("a.Embeddable__controls__play","Embeddable__button--inapplicable"),renderPause:c("a.Embeddable__controls__pause","Embeddable__button--inapplicable"),renderSkip:c("a.Embeddable__controls__skip","Embeddable__button--disabled"),renderSubtitles:c("a.Embeddable__controls__subtitles","Embeddable__button--inapplicable"),renderPlaylist:c("a.Embeddable__controls__skip,a.Embeddable__controls__unskip,a.Embeddable__controls__playlist","Embeddable__button--inapplicable"),renderVolume:function(){var a=this.props.get("volumeEnabled"),b=this.props.get("volumeMuted");this.find("a.Embeddable__controls__volume")[a?"removeClass":"addClass"]("Embeddable__button--inapplicable")[b?"addClass":"removeClass"]("Embeddable__button--effective")},renderFullscreen:function(){var a=this.props.get("fullscreen"),b=this.props.get("fullscreenEnabled");this.$el[b&&a?"addClass":"removeClass"]("Embeddable__controls--fullscreen"),this.find("a.Embeddable__controls__fullscreen")[!b||a?"addClass":"removeClass"]("Embeddable__button--inapplicable"),this.find("a.Embeddable__controls__smallscreen")[b&&a?"removeClass":"addClass"]("Embeddable__button--inapplicable")}});return f}),define("apps/embeddable/views/play-button",["./base"],function(a){"use strict";var b=a.extend({className:"Embeddable__play-button g-button-play",propsDefaults:{enabled:!1,visible:!1},propsEvents:{"change:enabled":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__play-button--enabled")},"change:visible":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__play-button--visible")}}});return b}),define("utils/applyAll",["jquery"],function(a){"use strict";function b(c,d,e){var f,g;for(f=0,g=d.length;f<g;f++)a.isArray(d[f])?b(c,d[f],e):d[f].apply(c,e)}return b}),define("utils/throwError",[],function(){"use strict";return function(a){throw new Error("Error in TED: "+a)}}),define("lib/pubSub",["jquery","utils/applyAll","utils/throwError"],function(a,b,c){"use strict";function d(a){var d={publish:a.fire,subscribe:a.add,unsubscribe:a.remove},e=null;a.add(function(a){e=a}),d.read=function(){return e};var f;return d.publishUnique=function(){if(!window.JSON)return c("JSON object not available. You may need to shim it on this client."),!1;var b=Array.prototype.slice.call(arguments,0),d=JSON.stringify(b);d!==f&&(a.fire.apply(a,b),f=d)},d.once=function(){function c(){b(a,d,arguments),a.remove(c)}var d=arguments;return a.add(c)},d.future=function(){function c(){f&&b(a,e,arguments)}var d,e=arguments,f=!1;return d=a.add(c),f=!0,d},d}function e(b){var c,e=b&&f[b];return e||(c=a.Callbacks("memory"),e=d(c),b&&(f[b]=e)),e}var f={};return e._reset=function(){f={}},e}),define("lib/resize",["jquery","lodash","lib/pubSub"],function(a,b,c){"use strict";function d(a){for(var b,d=m;d--;)!b&&a>=l[d].at&&(b=l[d].its);c("sizeGroup").publishUnique(b)}function e(){var a=0,b=k;if(f=window.innerHeight,g=window.innerWidth||document.documentElement.clientWidth,j)a=i;else for(;b--;)!a&&g>=h[b]&&(a=h[b]);c("breakpoint").publishUnique(a),c("height").publishUnique(f),c("width").publishUnique(g)}var f,g,h=[320,480,600,768,1024,1200],i=1024,j=a("html").is(".oldie"),k=h.length,l=[{at:0,its:"oh"},{at:480,its:"xs"},{at:768,its:"sm"},{at:1024,its:"lg"}],m=l.length;return a(window).on("resize",b.throttle(e,100)),e(),c("breakpoint").subscribe(d),c}),define("apps/embeddable/views/expandable",["lodash","./base","lib/pubSub","lib/resize"],function(a,b,c){"use strict";var d=b.extend({className:"Embeddable__expandable",propsDefaults:{open:!1},propsEvents:{"change:open":function(a,b){this[b?"open":"close"]()}},open:function(){this._setCoords()},close:function(){this.$el.css("top","-100%")},anchorTo:function(a){this.$anchor=a,this._setCoords()},_setCoords:function(){var b=this.find("div.Embeddable__expandable__content");if(b.length&&this.$anchor&&this.props.get("open")){this._settedCoordsOnce||(this._setCoordsBound=a.bind(this._setCoords,this),c("height").future(this._setCoordsBound),c("width").future(this._setCoordsBound),this._settedCoordsOnce=!0);var d={},e=this.$anchor.offset(),f=e.left,g=e.top,h=b.outerHeight(),i=g-h;i<0?(d.top=0,d.height=g+"px"):(d.top=i,d.height="auto");var j=b.outerWidth(),k=c("width").read();k-f-j<0?(d.left="initial",d.right=0):(d.left=f,d.right="initial"),this.$el.css(d)}}});return d}),define("templates/helpers/formatDuration",["Handlebars","utils/formatDuration"],function(a,b){"use strict";a.registerHelper("formatDuration",b)}),define("hbs!templates/thumb",["hbs","hbs/handlebars","templates/helpers/formatDuration"],function(a,b){var c=b.template({1:function(a,b,c,d){return'    <span class="thumb__duration">\n      '+this.escapeExpression((b.formatDuration||a&&a.formatDuration||b.helperMissing).call(a,null!=a?a.playDuration:a,{name:"formatDuration",hash:{},data:d}))+"\n    </span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'\n<span class="thumb thumb--'+this.escapeExpression((f=null!=(f=b.ratio||(null!=a?a.ratio:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"ratio",hash:{},data:d}):f))+" "+this.escapeExpression((f=null!=(f=b.cropClass||(null!=a?a.cropClass:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"cropClass",hash:{},data:d}):f))+'">\n  <span class="thumb__sizer"><span class="thumb__tugger"><img src="'+this.escapeExpression((f=null!=(f=b.src||(null!=a?a.src:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"src",hash:{},data:d}):f))+'" class="thumb__image" alt=""><span class="thumb__aligner"></span></span></span>\n\n'+(null!=(e=b["if"].call(a,null!=a?a.playDuration:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</span>\n"},useData:!0});return b.registerPartial("templates/thumb",c),c}),define("templates/helpers/thumb",["Handlebars","hbs!templates/thumb"],function(a,b){"use strict";a.registerHelper("thumb",function(c,d,e){var f=!!(e&&e>0)&&e;return d=d||"video",new a.SafeString(b({cropClass:"video"===d?"thumb--crop-top":"",
src:c,ratio:d,playDuration:f,playIcon:!f}))})}),define("hbs!apps/embeddable/templates/playlist",["hbs","hbs/handlebars","templates/helpers/thumb"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'    <a class="undec Embeddable__playlist__talk" href="'+this.escapeExpression((e=null!=(e=b.canonical||(null!=a?a.canonical:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"canonical",hash:{},data:d}):e))+'" data-id="'+this.escapeExpression((e=null!=(e=b.id||(null!=a?a.id:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"id",hash:{},data:d}):e))+'">\n      <div class="media">\n        <div class="Embeddable__playlist__talk__image media__image media__image--thumb">\n          '+this.escapeExpression((b.thumb||a&&a.thumb||b.helperMissing).call(a,null!=a?a.thumb:a,null,null!=a?a.duration:a,{name:"thumb",hash:{},data:d}))+'\n        </div>\n\n        <div class="media__message">\n          <h4 class="Embeddable__playlist__talk__title">\n            '+this.escapeExpression(this.lambda(null!=a?a.speaker:a,a))+":\n            "+this.escapeExpression(this.lambda(null!=a?a.title:a,a))+"\n          </h4>\n        </div>\n      </div>\n    </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="Embeddable__expandable__content Embeddable__playlist__bar">\n'+(null!=(e=b.each.call(a,null!=a?a.talks:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</div>\n"},useData:!0});return b.registerPartial("apps/embeddable/templates/playlist",c),c}),define("apps/embeddable/views/playlist",["./expandable","hbs!apps/embeddable/templates/playlist"],function(a,b){"use strict";var c=a.extend({className:"Embeddable__expandable Embeddable__playlist",initialize:function(a){this.talks=a.talks,this.initializeState(),this.initializeProps()},render:function(){return this.$el.html(b({talks:this.talks.toJSON()})),this}});return c}),define("hbs!apps/embeddable/templates/subtitles",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'      <li class="Embeddable__subtitles__item">\n        <a class="checkable Embeddable__subtitles__language" href="#" data-code="'+this.escapeExpression((e=null!=(e=b.languageCode||(null!=a?a.languageCode:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageCode",hash:{},data:d}):e))+'">\n          <span class="checkable__label">\n            '+this.escapeExpression((e=null!=(e=b.languageName||(null!=a?a.languageName:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"languageName",hash:{},data:d}):e))+"\n          </span>\n        </a>\n      </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="Embeddable__expandable__content">\n  <ul class="sl">\n    <li class="Embeddable__subtitles__item">\n      <a class="checkable Embeddable__subtitles__language" href="#">\n        <span class="checkable__label">\n          Turn subtitles off\n        </span>\n      </a>\n    </li>\n\n'+(null!=(e=b.each.call(a,null!=a?a.languages:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</div>\n"},useData:!0});return b.registerPartial("apps/embeddable/templates/subtitles",c),c}),define("apps/embeddable/views/subtitles",["./expandable","hbs!apps/embeddable/templates/subtitles"],function(a,b){"use strict";var c=a.extend({className:"Embeddable__expandable Embeddable__subtitles",propsDefaults:{activeSubtitle:null,languages:[]},propsEvents:{"change:activeSubtitle":"renderActiveSubtitle","change:languages":"render"},initialize:function(){this.adoptView(a),this.initializeProps(),this.initializeState()},render:function(){var a=this.props.get("languages");return a&&a.length&&(this.$el.html(b({languages:a})),this.renderActiveSubtitle()),this},renderActiveSubtitle:function(){var a=this.props.get("activeSubtitle"),b="Embeddable__subtitles__language--active checkable--checked",c=this.find("a.Embeddable__subtitles__language");c.removeClass(b),a&&c.filter("[data-code="+a+"]").addClass(b)}});return c}),define("hbs!apps/embeddable/templates/volume",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="Embeddable__expandable__content Embeddable__volume__inner">\n  <div class="Embeddable__volume__meter"><div class="Embeddable__volume__meter__level"></div><div class="Embeddable__volume__slider"></div></div>\n\n  <a class="Embeddable__volume__unmute Embeddable__button Embeddable__button--effective" href="#">'+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-mute","Mute","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+'</a>\n  <a class="Embeddable__volume__mute Embeddable__button" href="#">'+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"control-mute","Mute","Embeddable__button__icon",{name:"icon",hash:{},data:d}))+"</a>\n</div>\n"},useData:!0});return b.registerPartial("apps/embeddable/templates/volume",c),c}),define("deferLink",["jquery"],function(a){"use strict";function b(a){return function(b){return c.call(this,b,a)}}function c(b,c){function d(){var a=+e.data(h)-1;e.data(h,a),a<=0&&!e.data(j)&&(e.removeData(i),k.location.href=l)}var e="A"===this.nodeName?a(this):a(b.target).closest("a"),l=e.attr("href"),m=e.attr("target"),n=e.length&&l&&1===b.which&&!b.metaKey&&!b.shiftKey,o=c;if(a.isFunction(c)&&(o=c.call(this,b),o===!1))return!1;n&&b.isDefaultPrevented()&&!e.data(h)&&(n=!1),n&&m&&"_self"!==m&&(n=!1),n&&g&&e.is("[download]")&&(n=!1),n&&e.hasClass(f)&&(n=!1);var p=+(e.data(h)||0);n&&(e.data(h,p+1),o.when?("resolved"===o.state()&&d(),o.done(d)):a.isNumeric(o)?k.setTimeout(d,o):(n=!1,e.data(h,p))),n&&!p&&(b.preventDefault(),e.data(i,!0))}function d(d){return d.when||a.isNumeric(d)||a.isFunction(d)?b(d):void c.call(this,d,e)}var e=50,f="no-defer",g="download"in document.createElement("a"),h="defer-link-pends",i="defer-link-preventable",j="defer-link-prevented",k=window,l=a.Event.prototype.preventDefault;return a.Event.prototype.preventDefault=function(){var b=a(this.target);return b.data(i)&&b.data(j,!0),l.apply(this,Array.prototype.slice.call(arguments))},d}),define("utils/ted",[],function(){"use strict";var a=function(){var a=window.navigator,b=a?a.userAgent.toLowerCase():"";if(b.indexOf("chrome")!==-1)return!1;var c=b.match(/macintosh.*os x.*applewebkit.*version\/([\d]+).*safari/);return!!c&&!(+c[1]<7)};return function(b){return window.TED?"playerPath"===b?a()?window.TED.playerPathLocal:window.TED.playerPathRemote:window.TED[b]:""}}),define("lib/browserDetect",["exports"],function(a){"use strict";function b(a){for(var b=0;b<a.length;b++){var c=a[b].string,e=a[b].prop;if(d=a[b].versionSearch||a[b].identity,c){if(c.indexOf(a[b].subString)!==-1)return a[b].identity}else if(e)return a[b].identity}}function c(a){var b=a.indexOf(d);if(b!==-1)return parseFloat(a.substring(b+d.length+1))}var d,e=window.navigator,f=[{string:e.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:e.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"}];a.browser=b(f)||"Unknown Browser",a.version=c(window.navigator.userAgent)||c(window.navigator.appVersion)||"Unknown Version"}),function(a){"use strict";var b=function(a,c,d){return 1===arguments.length?b.get(a):b.set(a,c,d)};b._document=document,b._navigator=navigator,b.defaults={path:"/"},b.get=function(a){return b._cachedDocumentCookie!==b._document.cookie&&b._renewCache(),b._cache[a]},b.set=function(c,d,e){return e=b._getExtendedOptions(e),e.expires=b._getExpiresDate(d===a?-1:e.expires),b._document.cookie=b._generateCookieString(c,d,e),b},b.expire=function(c,d){return b.set(c,a,d)},b._getExtendedOptions=function(c){return{path:c&&c.path||b.defaults.path,domain:c&&c.domain||b.defaults.domain,expires:c&&c.expires||b.defaults.expires,secure:c&&c.secure!==a?c.secure:b.defaults.secure}},b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},b._getExpiresDate=function(a,c){switch(c=c||new Date,typeof a){case"number":a=new Date(c.getTime()+1e3*a);break;case"string":a=new Date(a)}if(a&&!b._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},b._generateCookieString=function(a,b,c){a=encodeURIComponent(a),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toGMTString():"",d+=c.secure?";secure":""},b._getCookieObjectFromString=function(c){for(var d={},e=c?c.split("; "):[],f=0;f<e.length;f++){var g=b._getKeyValuePairFromCookieString(e[f]);d[g.key]===a&&(d[g.key]=g.value)}return d},b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=b<0?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},b._renewCache=function(){b._cache=b._getCookieObjectFromString(b._document.cookie),b._cachedDocumentCookie=b._document.cookie},b._areEnabled=function(){return b._navigator.cookieEnabled||"1"===b.set("cookies.js",1).get("cookies.js")},b.enabled=b._areEnabled(),"function"==typeof define&&define.amd?define("Cookies",[],function(){return b}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Cookies=b):window.Cookies=b}(),define("lib/currentUserId",["Cookies"],function(a){"use strict";var b="_ted_user_id";return{get:function(){return a.get(b)}}}),define("lib/errorCollector",["jquery","lodash","lib/browserDetect","lib/currentUserId","utils/ted","exports"],function(a,b,c,d,e,f){"use strict";f.post=b.throttle(function(b){a.post("https://error-collector.ted.com/",{message:b})},5e3),f.log=function(b,g){f.post(a.extend({message:b,context:"js",uri:window.location.href,client_name:c.browser,client_version:c.version,elapsed_seconds:Math.floor((+new Date-e("startTime"))/1e3),profile_id:d.get()||"N/A",user_agent:window.navigator?window.navigator.userAgent:"Unknown User Agent"},g||{})),console&&console.log&&console.error&&console.error(b)}}),define("lib/ga-cookie",["Cookies"],function(a){"use strict";var b="_ga",c={};return c.get=function(){return a.get(b)},c.getClientId=function(){var a=String(c.get()),b=a.split(".")[2]+"."+a.split(".")[3];return b.indexOf("undefined")===-1?b:void 0},c}),define("lib/ga",["jquery","lodash","deferLink","utils/ted","lib/errorCollector","lib/ga-cookie","lib/currentUserId","lib/pubSub","lib/resize"],function(a,b,c,d,e,f,g,h){"use strict";function i(){(o[o.GoogleAnalyticsObject]||a.noop).apply(o,n.slice.call(arguments))}function j(){var a=n.slice.call(arguments),d=this;return function(e){if(d.apply(i,a),b.has(e,"originalEvent")&&b.has(this,"nodeName")&&"click"===e.type)return c.call(this,e)}}function k(){var a,b=0;h("breakpoint").subscribe(function(c){i.setDimension("breakpoint",c),b++&&i.sendEvent("breakpoint","change",a+"|"+c,b),a=c})}function l(){var a=f.getClientId();a&&i.setDimension("gaClientId",a);var b=g.get();b&&i.setDimension("tedUserId",b),h("auth.login").subscribe(function(a){i.setDimension("tedUserId",a.id)})}function m(b){var c=a(this),d="ga-";b=a.extend(b||{},{category:c.data(d+"category"),action:c.data(d+"action"),label:c.data(d+"label")}),i.sendEvent(b.category,b.action,b.label)}var n=[],o=window;return b.assign(i,{send:b.partial(i,"send"),set:b.partial(i,"set"),sendEvent:b.partial(i,"send","event"),sendSocial:b.partial(i,"send","social"),sendNonInteraction:b.partialRight(b.partial(i,"send","event"),{nonInteraction:1})},function(a,b){return b.recall=j,b}),i.setDimension=function(a,b){var c=String(a);c.match(/^dimension\d+$/)||(c=(d("gaDimensions")||{})[c]),c?i.set(c,b):e.log('GA: missing dimension: "'+a+'"')},i.virtualPageview=function(a){i.set("page",a+(a.indexOf("?")===-1?"?":"&")+"vp"),i.send("pageview")},k(),l(),i.send("pageview"),a(function(){a(document).on("click","a.ga-link",c(function(){return m.call(this,{action:"click",category:"site.link",label:this.href}),50}))}),i}),define("jqueryui/mouse",["jquery"],function(a){return function(a,b){var c=!1;a(document).mouseup(function(){c=!1}),a.widget("ui.mouse",{version:"@VERSION",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=1===b.which,f=!("string"!=typeof this.options.cancel||!b.target.nodeName)&&a(b.target).closest(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(b))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(b)!==!1,!this._mouseStarted)?(b.preventDefault(),!0):(!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0))}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(a),a}),define("touchPunch",["jquery","jqueryui/mouse"],function(a,b){return function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind("touchstart",a.proxy(b,"_touchStart")).bind("touchmove",a.proxy(b,"_touchMove")).bind("touchend",a.proxy(b,"_touchEnd")),e.call(b)}}}(a),a}),define("widgets/slider",["jquery","jqueryui/widget","jqueryui/mouse","touchPunch"],function(a){"use strict";return a.widget("ted.slider",a.ui.mouse,{options:{distance:0,orientation:"horizontal",value:0,change:null,slide:null,start:null,stop:null},value:function(a){return arguments.length&&(this.options.value=a,this._refreshValue()),this.options.value},_change:function(a){this._trigger("change",a,this._getData({value:this.value()}))},_create:function(){this._detectOrientation(),this._mouseInit();var b=a("<div class=slider__progress></div>");this.progressElement=b,this.cursorElement=a("<div class=slider__cursor></div>").appendTo(this.progressElement),this.element.addClass("slider slider--"+this.orientation).append(this.progressElement)},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_getData:function(a){return a},_mouseCapture:function(a){var b,c;return this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),b={x:a.pageX,y:a.pageY},c=this._valueFromPosition(b),this._start(a),this._slide(a,c),!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._valueFromPosition(b);return this._slide(a,c),!1},_mouseStart:function(){return!0},_mouseStop:function(a){return this._mouseDrag(a),this._stop(a),this._change(a),!1},_refreshValue:function(){var a=this.value();this.progressElement.css("vertical"===this.orientation?"height":"width",100*a+"%")},_slide:function(a,b){this._trigger("slide",a,this._getData({value:b})),this.value(b)},_start:function(a){this.element.addClass("slider--active"),this._trigger("start",a)},_stop:function(a){this.element.removeClass("slider--active"),this._trigger("stop",a)},_valueFromPosition:function(a){var b,c,d;return"vertical"===this.orientation?(d=this.elementSize.height,c=a.y-this.elementOffset.top):(d=this.elementSize.width,c=a.x-this.elementOffset.left),b=c/d,b>1&&(b=1),b<0&&(b=0),"vertical"===this.orientation&&(b=1-b),b}}),function(b,c){return a(b).slider(c)}}),define("widgets/scrubber",["jquery","lib/ga","widgets/slider"],function(a,b){"use strict";var c="scrubber",d=c+"--active",e=c+"--hover",f=c+"__cursor",g=c+"__playhead",h=c+"__progress";return a.widget("ted.scrubber",a.ted.slider,{options:{duration:null,player:null},_isScrubbing:!1,_isSeeking:!1,_progress:0,_create:function(){this.options.player&&this._setPlayer(),this.playheadElement=a("<div class="+g+"></div>").prependTo(this.element),this._super(),this.element.addClass(c),this.cursorElement.addClass(f),this.progressElement.addClass(h),this._on(this._handleEvents)},_getData:function(b){return a.extend({cursor:b.value*this.options.duration,playhead:this._progress*this.options.duration,progress:this._progress,duration:this.options.duration},b)},_handleEvents:{mouseover:function(){this.element.addClass(e)},mouseout:function(){this.element.removeClass(e)},scrubberstart:function(){this.element.addClass(d),this._isScrubbing=!0},scrubberstop:function(){this.element.removeClass(d),this._isScrubbing=!1}},_setOption:function(a,b){this._super(a,b),"duration"===a&&this.progress(this._getData({value:this._progress}).playhead/b)},_setPlayer:function(){var c=this,d=a(this.options.player),e=d.player("talk");this.option("duration",e.duration),this._on({scrubberchange:function(a,c){d.player("seek",c.cursor),b.sendEvent("player","seek","scrubber",Math.round(c.cursor))}}),d.on("playertalk",function(a,b){c.option("duration",b.duration),c.progress(0)}).on("playerduration",function(a,b){c.option("duration",b.duration)}).on("playerseeking",function(){c._isSeeking=!0}).on("playerseeked",function(){c._isSeeking=!1}).on("playerprogress",function(a,b){c.progress(b.progress)})},isSeeking:function(a){return arguments.length&&(this._isSeeking=!!a),this._isScrubbing||this._isSeeking},progress:function(a){if(arguments.length){var b=100*a+"%";this.progressElement&&!this.isSeeking()&&this.progressElement.width(b),this.playheadElement&&this.playheadElement.width(b),this._progress=a,this._trigger("progress",null,this._getData({value:a}))}return this._progress}}),function(b,c){return a(b).scrubber(c)}}),define("apps/embeddable/views/volume",["./expandable","hbs!apps/embeddable/templates/volume","widgets/scrubber"],function(a,b){"use strict";var c=a.extend({className:"Embeddable__expandable Embeddable__volume",propsDefaults:{level:.5,muted:!1},propsEvents:{"change:level":"renderLevel","change:muted":"renderMuted"},initialize:function(){this.adoptView(a),this.initializeProps(),this.initializeState()},render:function(){return this.$el.html(b()),this.renderLevel(),this.find("div.Embeddable__volume__slider").scrubber({orientation:"vertical"}),this},renderLevel:function(){this.find("div.Embeddable__volume__meter__level").height(100*this.props.get("level")+"%")},renderMuted:function(){this.$el[this.props.get("muted")?"addClass":"removeClass"]("Embeddable__volume--muted")}});return c}),define("hbs!apps/embeddable/templates/scrubber",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="Embeddable__scrubber__bar">\n  <div class="Embeddable__scrubber__meter"><div class="Embeddable__scrubber__meter__progress"></div></div>\n\n  <div class="Embeddable__scrubber__slider"></div>\n</div>\n'},useData:!0});return b.registerPartial("apps/embeddable/templates/scrubber",c),c}),define("apps/embeddable/views/scrubber",["./base","hbs!apps/embeddable/templates/scrubber","widgets/scrubber"],function(a,b){"use strict";var c=a.extend({className:"Embeddable__scrubber",events:{scrubberchange:function(){this.find("div.Embeddable__scrubber__slider").scrubber("progress",0)}},propsDefaults:{enabled:!0,currentTime:0,duration:0,fullscreen:!1},propsEvents:{"change:enabled":"renderEnabled","change:currentTime":"renderTime","change:duration":"renderTime","change:fullscreen":"renderFullscreen"},render:function(){return this.$el.html(b()),this.renderEnabled(),this.renderFullscreen(),this.find("div.Embeddable__scrubber__slider").scrubber(),this},renderEnabled:function(){this.$el[this.props.get("enabled")?"addClass":"removeClass"]("Embeddable__scrubber--enabled")},renderFullscreen:function(){this.$el[this.props.get("fullscreen")?"addClass":"removeClass"]("Embeddable__scrubber--fullscreen")},renderTime:function(){this.find("div.Embeddable__scrubber__meter__progress").width(this.props.get("currentTime")/this.props.get("duration")*100+"%")}});return c}),define("apps/embeddable/views/chrome",["./base","./controls","./play-button","./playlist","./subtitles","./volume","./scrubber"],function(a,b,c,d,e,f,g){"use strict";var h=a.extend({className:"Embeddable__chrome",events:{"click a":function(a){a.preventDefault()},"click a.Embeddable__controls__pause":function(){this.props.get("paused")||this.state.set("pausePending",!0)},"click a.Embeddable__controls__play":function(){this.props.get("playing")||this.state.set("playPending",!0)},"click a.Embeddable__controls__skip":function(){var a=this.props.get("next");a&&(this.state.set("skipPending",!0),this.state.set("pendingTalk",a))},"click a.Embeddable__controls__unskip":function(){var a=this.props.get("prev");a&&(this.state.set("unskipPending",!0),this.state.set("pendingTalk",a))},"click a.Embeddable__controls__volume":function(){this.state.set("volumeOpen",!this.state.get("volumeOpen"))},"click a.Embeddable__controls__subtitles":function(){this.state.set("subtitlesOpen",!this.state.get("subtitlesOpen"))},"click a.Embeddable__controls__playlist":function(){this.state.set("playlistOpen",!this.state.get("playlistOpen"))},"click a.Embeddable__controls__fullscreen":function(){this.props.get("fullscreen")||this.state.set("fullscreenPending",!0)},"click a.Embeddable__controls__smallscreen":function(){this.props.get("fullscreen")&&this.state.set("smallscreenPending",!0)},"click div.Embeddable__play-button":function(){this.props.get("playing")||this.state.set("playPending",!0)},"click a.Embeddable__playlist__talk":function(a){var b=+$(a.target).closest("a.Embeddable__playlist__talk").data("id");this.state.set("pendingTalk",this.talks.get(b))},"click a.Embeddable__subtitles__language":function(a){var b=$(a.target).closest("a.Embeddable__subtitles__language").data("code");b?this.props.get("subtitle")===b?this.state.set("pendingSubtitle",!1):this.state.set("pendingSubtitle",b):this.props.get("subtitle")&&this.state.set("pendingSubtitle",!1)},"click a.Embeddable__volume__mute":function(){this.props.get("muted")||this.state.set("mutePending",!0)},"click a.Embeddable__volume__unmute":function(){this.props.get("muted")&&this.state.set("unmutePending",!0)},"scrubberslide div.Embeddable__volume__slider":function(a,b){this.state.set("pendingVolume",b.value)},"scrubberchange div.Embeddable__scrubber__slider":function(a,b){var c=this.props.get("duration");c&&this.state.set("pendingSeek",b.value*c)}},stateDefaults:{pausePending:!1,playPending:!1,pendingTalk:null,skipPending:!1,unskipPending:!1,volumeOpen:!1,pendingVolume:null,mutePending:!1,unmutePending:!1,subtitlesAvailable:!1,subtitlesOpen:!1,pendingSubtitle:null,playlistOpen:!1,fullscreenPending:!1,smallscreenPending:!1,pendingSeek:null},stateEvents:{"on:playPending":function(){this.playButton.props.set("visible",!1)},"change:pendingTalk":function(a,b){null!==b&&this.state.set("playlistOpen",!1)},"change:volumeOpen":function(a,b){this.volume.props.set("open",b),this.controls.props.set("volumeActive",b),b&&(this.state.set("subtitlesOpen",!1),this.state.set("playlistOpen",!1))},"change:pendingVolume":function(a,b){this.volume.props.set("level",b)},"change:subtitlesAvailable":"_checkSubtitles","change:subtitlesOpen":function(a,b){this.subtitles.props.set("open",b),this.controls.props.set("subtitlesActive",b),b&&(this.state.set("volumeOpen",!1),this.state.set("playlistOpen",!1))},"change:pendingSubtitle":function(a,b){null!==b&&this.state.set("subtitlesOpen",!1)},"change:playlistOpen":function(a,b){this.playlist.props.set("open",b),this.controls.props.set("playlistActive",b),b&&(this.state.set("volumeOpen",!1),this.state.set("subtitlesOpen",!1))}},propsDefaults:{enabled:!0,activated:!1,hovering:!1,playing:!1,paused:!1,duration:null,currentTime:null,talk:null,next:null,prev:null,volume:.5,canVolume:!1,muted:!1,subtitle:!1,canSubtitle:!1,fullscreen:!1,canFullscreen:!1,postrolling:!1,visible:!1},propsEvents:{"change:enabled":"_setActivation","change:activated":"_setActivation","change:visible":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__chrome--visible")},"change:playing":function(){this._checkPlayPause()},"on:playing":function(){this.state.set("playPending",!1),this.playButton.props.set("visible",!1)},"on:paused":function(){this.state.set("pausePending",!1),this.playButton.props.set("enabled",!0),this.playButton.props.set("visible",!0)},"change:duration":function(a,b){this.controls.renderDuration(b),this.scrubber.props.set("duration",b)},"change:currentTime":function(a,b){this.controls.renderCurrent(b),this.scrubber.props.set("currentTime",b)},"change:talk":function(a,b){this.state.set("pendingTalk",null),this.state.set("skipPending",!1),this.state.set("unskipPending",!1);var c=b.get("languages");this.subtitles.props.set("languages",c||[]),this.state.set("subtitlesAvailable",c&&c.length>0)},"change:next":"_checkSkip","change:prev":"_checkSkip","change:volume":function(a,b){this.volume.props.set("level",b)},"change:canVolume":function(a,b){this.controls.props.set("volumeEnabled",b)},"change:muted":function(a,b){this.state.set("mutePending",!1),this.state.set("unmutePending",!1),this.volume.props.set("muted",b),this.controls.props.set("volumeMuted",b)},"change:subtitle":function(a,b){this.subtitles.props.set("activeSubtitle",b?b:null),this.controls.props.set("subtitlesEffective",!!b),this.state.set("pendingSubtitle",null)},"change:canSubtitle":"_checkSubtitles","change:fullscreen":function(a,b){this.state.set("fullscreenPending",!1),this.state.set("smallscreenPending",!1),this.controls.props.set("fullscreen",b),this.scrubber.props.set("fullscreen",b)},"change:canFullscreen":function(a,b){this.controls.props.set("fullscreenEnabled",b)},"change:postrolling":function(a,b){this.scrubber.props.set("enabled",!b),this.controls.props.set("timingEnabled",!b),this._checkPlayPause(),this._checkPlaylist(),this._checkSkip(),this._checkSubtitles()}},initialize:function(a){this.talks=a.talks,this.scrubber=new g,this.controls=new b,this.playButton=new c,this.playlist=new d({talks:this.talks}),this.subtitles=new e,this.volume=new f,this.initializeState(),this.initializeProps(),this.listenTo(this.talks,"add",this._checkPlaylist),this.listenTo(this.talks,"all",this._checkPlaylist),this.listenTo(this.talks,"reset",this._checkPlaylist)},render:function(){this.$el.append(this.playButton.$el),this.playButton.render(),this.$el.append(this.controls.$el),this.controls.render(),this.$el.append(this.scrubber.$el),this.scrubber.render(),this.$el.append(this.volume.$el),this.volume.render(),this.$el.append(this.playlist.$el),this.playlist.render(),this.$el.append(this.subtitles.$el),this.subtitles.render(),this.volume.anchorTo(this.controls.find("a.Embeddable__controls__volume")),this.subtitles.anchorTo(this.controls.find("a.Embeddable__controls__subtitles")),this.playlist.anchorTo(this.controls.find("a.Embeddable__controls__playlist"))},_checkPlaylist:function(){var a=this.talks.length>1,b=!!this.props.get("postrolling");this.controls.props.set("playlistEnabled",!b&&a)},_checkPlayPause:function(){var a=!!this.props.get("playing"),b=!!this.props.get("postrolling");this.controls.props.set("playEnabled",!b&&!a),this.controls.props.set("pauseEnabled",!b&&a)},_checkSkip:function(){var a=!!this.props.get("next"),b=!!this.props.get("prev"),c=!!this.props.get("postrolling");this.controls.props.set("skipEnabled",!c&&a),this.controls.props.set("unskipEnabled",!c&&b)},_checkSubtitles:function(){this.controls.props.set("subtitlesEnabled",!this.props.get("postrolling")&&this.state.get("subtitlesAvailable")&&this.props.get("canSubtitle"))},_setActivation:function(){var a=this.props.get("enabled")&&this.props.get("activated");this.$el[a?"addClass":"removeClass"]("Embeddable__chrome--activated")}});return h}),define("utils/is_mobile",[],function(){"use strict";function a(){return a.isIOS()||a.isAndroid()}function b(b){return!!a.ua.match(b)}var c=/Android/g,d=/(iPad|iPhone|iPod)/g;return a.isIOS=function(){return b(d)},a.isAndroid=function(){return b(c)},a.ua=window.navigator&&window.navigator.userAgent||"",a}),define("hbs!apps/embeddable/templates/player",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div class="vc">\n  <div class="vc__wrap">\n    <div class="Embeddable__player__object"></div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("apps/embeddable/templates/player",c),c}),define("Modernizr",[],function(){"use strict";return window.Modernizr}),define("widgets/player/ga-tracker",["lodash","Modernizr","lib/ga"],function(a,b,c){"use strict";function d(a){this._data={currentPlayerTime:null,hasPlayed:!1,lastPlayedTalkId:null,lastChangedTalkId:null,lastLanguageCode:null,marks:null,markableProgress:[25,50,75,95],markableTimes:[],postRolling:!1},this._widget=a,this._resetMarks(),this._addHandlers()}return d.prototype._resetMarkableTimes=function(b){this._data.markableTimes=a.union([10,30,60,90],a.range(120,b+1,120))},d.prototype._resetMarks=function(){this._data.marks={times:{},progress:{},ads:{}}},d.prototype._incrementTalkViews=function(){var a=require("Cookies").get("__utma");if(a&&b.localstorage){var d=+a.split(".").pop(),e=window.localStorage,f="talkViews",g=(e.getItem(f)||"").split("|");2===g.length&&+g[0]===d?g[1]=+g[1]+1:g=[d,1],e.setItem(f,g.join("|")),c.set("metric1",g[1])}},d.prototype._onTalkChange=function(){this._data.postRolling=!1,this._resetMarks(),this._incrementTalkViews()},d.prototype._addHandlers=function(){
var a=this,b={playererror:function(a,b){var d=b.error,e="abortive"===d.severity;(e||"fatal"===d.severity)&&c.sendEvent("player",e?"error.abort":"error.fatal",d.message)},playerenterfullscreen:function(){c.sendEvent("player","enterFullScreen")},playerexitfullscreen:function(){c.sendEvent("player","exitFullScreen")},playerplay:function(){var b=a._widget.options.currentTalk.id;c.sendEvent("player","start",a._data.hasPlayed?"subsequent":"initial"),a._data.hasPlayed=!0,a._data.lastPlayedTalkId!==b&&(c.sendEvent("player.talk","start",b),a._data.lastPlayedTalkId=b)},playerplaybackrate:function(a,b){c.sendEvent("player","playbackRate",b.playbackRate),c.setDimension("playbackRate",b.playbackRate)},playerpause:function(){c.sendEvent("player","pause",Math.round(a._data.currentPlayerTime))},playerpopout:function(a,b){c.sendEvent("player","popOut",b.popOut?"on":"off")},playerready:function(){var b=a._widget.mode();c.sendEvent("player","initialize",b,{nonInteraction:1}),c.setDimension("playerMode",b)},playerrequestnext:function(){c.sendEvent("player","next",a._data.postRolling?"postroll":"talk")},playerrequestplay:function(){c.sendEvent("player","request",a._data.hasPlayed?"subsequent":"initial")},playerprogress:function(b,d){var e=100*d.progress,f=0,g=-1,h=a._data.markableProgress.length;if(!a._widget.player.postrolling)for(;a._data.marks&&++g<h&&f<e;)f=a._data.markableProgress[g],e>=f&&!a._data.marks.progress[f]&&(a._data.currentPlayerTime>a._widget.options.startTrackingAt&&c.sendEvent("player","progressPct",f+"%"),a._data.marks.progress[f]=!0)},playertalkcomplete:function(){a._data.marks&&!a._data.marks.progress[100]&&(c.sendEvent("player","progressPct","100%"),a._data.marks.progress[100]=!0,c.sendEvent("player.talk","complete",a._widget.options.currentTalk.id))},playercurrenttime:function(b,d){var e=d.currentTime,f=0,g=-1,h=a._data.markableTimes.length;if(a._data.currentPlayerTime=e,!a._widget.player.postrolling)for(;a._data.marks&&++g<h&&f<e;)f=a._data.markableTimes[g],e>=f&&!a._data.marks.times[f]&&(f>a._widget.options.startTrackingAt&&c.sendEvent("player","progressTime",f+" seconds"),a._data.marks.times[f]=!0)},playerprerollstart:function(){a._data.marks&&!a._data.marks.ads.prerollStart&&(c.sendEvent("player.preRoll","cardStart"),a._data.marks.ads.prerollStart=!0)},playerprerollblock:function(){a._data.marks&&!a._data.marks.ads.prerollBlock&&(c.sendEvent("player.preRoll","cardBlock"),a._data.marks.ads.prerollBlock=!0)},playerpostrollstart:function(){a._data.postRolling=!0,a._data.marks&&!a._data.marks.ads.postrollStart&&(c.sendEvent("player.postRoll","adStart"),a._data.marks.ads.postrollStart=!0)},playerpostrollcomplete:function(){a._data.postRolling=!1,a._data.marks&&!a._data.marks.ads.postrollComplete&&(c.sendEvent("player.postRoll","adComplete"),a._data.marks.ads.postrollStart=!0)},playeradblock:function(){c.sendEvent("player","adBlock")},playerduration:function(b,c){a._widget.player.postrolling||a._resetMarkableTimes(c.duration)},playersubtitle:function(b,d){var e=String(d.subtitle&&d.subtitle.languageCode);e!==a._data.lastLanguageCode&&(e?c.sendEvent("player.subtitle","setLanguage",e):c.sendEvent("player.subtitle","disable")),a._data.lastLanguageCode=e},playertalk:function(b,c){var d=c.id;a._data.lastChangedTalkId!==d&&(a._onTalkChange(),a._data.lastChangedTalkId=d)}};this._handlers=b,this._widget._on(b)},d}),define("widgets/player/ted-tracker",["jquery","lodash","lib/currentUserId","utils/ted"],function(a,b,c,d){"use strict";function e(a){var b=d("zone")||{};this._data={lastMetaTalkId:null,lastPlayTalkId:null,vmAPIKey:b.api_key||"unknown"},this._widget=a,this._addHandlers()}return e.prototype._sendVM=function(c){var d=b.extend({},c,{share_token:this._widget.options.shareToken});a.post("/talks/"+this._widget.talk().id+"/views",{view:d},null,"json")},e.prototype._recordViewID=function(){this._widget.options.recordInIdentity&&c.get()&&a.post("/talks/"+this._widget.talk().id+"/user_views",{},null,"json")},e.prototype._recordViewVM=function(){var a=this._widget.mode();if("hls"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_html5_hls"}),"hlsjs"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_html5_hlsjs"}),"flash"===a&&this._sendVM({apikey:this._data.vmAPIKey,format:"hls",quality:"variant",service:"ted_player_flash_hls"}),"h264"===a){var b=this._widget.options.currentTalk.resources.h264[0].bitrate;this._sendVM({apikey:this._data.vmAPIKey,format:"mp4",quality:b?b+"k":"variant",service:"ted_player_html5_mp4"})}},e.prototype._onTalkPlay=function(){this._recordViewID(),this._recordViewVM()},e.prototype._addHandlers=function(){var a=this,b={playerrequestplay:function(){a._widget._ytPlayer&&a._widget._ytPlayer.playVideo&&a._sendVM({apikey:"botw",service:"botw"})},playerplay:function(){var b=a._widget.options.currentTalk.id;a._data.lastPlayTalkId!==b&&(a._onTalkPlay(),a._data.lastPlayTalkId=b)}};this._handlers=b,this._widget._on(b)},e});var ns_=window.ns_=window.ns_||{};ns_.StreamSense=ns_.StreamSense||function(){function a(a,b){var d=a||"",e="undefined",f=k.comScore||k.sitestat||function(a){var b,d,f,g,h,j="comScore=",m=l.cookie,n="",o="indexOf",p="substring",r="length",s=c.browserAcceptsLargeURLs()?q.URL_LENGTH_LIMIT:q.RESTRICTED_URL_LENGTH_LIMIT,t="&ns_",u="&",v=k.encodeURIComponent||escape;if(m[o](j)+1)for(g=0,f=m.split(";"),h=f[r];g<h;g++)d=f[g][o](j),d+1&&(n=u+unescape(f[g][p](d+j[r])));a+=t+"_t="+ +new Date+t+"c="+(l.characterSet||l.defaultCharset||"")+n,a.length>s&&a.indexOf(u)>0&&(b=a.substr(0,s-8).lastIndexOf(u),a=(a.substring(0,b)+t+"cut="+v(a.substring(b+1))).substr(0,s)),i.httpGet(a),typeof ns_p===e&&(ns_p={src:a}),ns_p.lastMeasurement=a};if(typeof b!==e){var g=[],h=k.encodeURIComponent||escape;for(var j in b)b.hasOwnProperty(j)&&g.push(h(j)+"="+h(b[j]));/[\?\&]$/.test(d)||(d+="&"),d+=g.join("&")}return f(d)}function b(a,b){for(var d,e=k.encodeURIComponent||escape,f=[],g=q.LABELS_ORDER,h=a.split("?"),i=h[0],j=h[1],m=j.split("&"),n=0,o=m.length;n<o;n++){var p=m[n].split("="),r=unescape(p[0]),s=unescape(p[1]);r&&(b[r]=s)}for(var t={},n=0,o=g.length;n<o;n++){var u=g[n];if(b.hasOwnProperty(u)){var v=b[u];"undefined"!=typeof v&&null!=v&&(t[u]=!0,f.push(e(u)+"="+e(b[u])))}}for(var u in b)if(!t[u]&&b.hasOwnProperty(u)){var v=b[u];"undefined"!=typeof v&&null!=v&&f.push(e(u)+"="+e(b[u]))}d=i+"?"+f.join("&"),d=d+(d.indexOf("&c8=")<0?"&c8="+e(l.title):"")+(d.indexOf("&c7=")<0?"&c7="+e(l.URL):"")+(d.indexOf("&c9=")<0?"&c9="+e(l.referrer):"");var w=c.browserAcceptsLargeURLs()?q.URL_LENGTH_LIMIT:q.RESTRICTED_URL_LENGTH_LIMIT;if(d.length>w&&d.indexOf("&")>0){var x=d.substr(0,w-8).lastIndexOf("&");d=(d.substring(0,x)+"&ns_cut="+e(d.substring(x+1))).substr(0,w)}return d}var c=function(){var a={uid:function(){var a=1;return function(){return+new Date+"_"+a++}}(),filter:function(a,b){var c={};for(var d in b)b.hasOwnProperty(d)&&a(b[d])&&(c[d]=b[d]);return c},extend:function(a){var b,c=arguments.length;a=a||{};for(var d=1;d<c;d++)if(b=arguments[d])for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);return a},getString:function(a,b){var c=String(a);return null==a?b||"na":c},getLong:function(a,b){var c=Number(a);return null==a||isNaN(c)?b||0:c},getInteger:function(a,b){var c=Number(a);return null==a||isNaN(c)?b||0:c},getBoolean:function(a,b){var c="true"==String(a).toLowerCase();return null==a?b||!1:c},isNotEmpty:function(a){return"undefined"!=typeof a&&null!=a&&"undefined"!=typeof a.length&&a.length>0},indexOf:function(b,c){var d=-1;return a.forEach(c,function(a,c){a==b&&(d=c)}),d},forEach:function(a,b,c){try{if("function"==typeof b)if(c="undefined"!=typeof c?c:null,"number"!=typeof a.length||"undefined"==typeof a[0]){var d="undefined"!=typeof a.__proto__;for(var e in a)(!d||d&&"undefined"==typeof a.__proto__[e])&&"function"!=typeof a[e]&&b.call(c,a[e],e)}else for(var e=0,f=a.length;e<f;e++)b.call(c,a[e],e)}catch(g){}},regionMatches:function(a,b,c,d,e){if(b<0||d<0||b+e>a.length||d+e>c.length)return!1;for(;--e>=0;){var f=a.charAt(b++),g=c.charAt(d++);if(f!=g)return!1}return!0},size:function(a){var b,c=0;for(var b in a)a.hasOwnProperty(b)&&c++;return c},log:function(a,b){if("undefined"!=typeof b&&b){var c=new Date,d=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();console.log(d,a)}},isTrue:function(a){return"undefined"!=typeof a&&("string"==typeof a?(a=a.toLowerCase(),"true"===a||"1"===a||"on"===a):!!a)},toString:function(b){if("undefined"==typeof b)return"undefined";if("string"==typeof b)return b;if("[object Array]"===Object.prototype.toString.call(b))return b.join(",");if(a.size(b)>0){var c="";for(var d in b)b.hasOwnProperty(d)&&(c+=d+":"+b[d]+";");return c}return b.toString()},exists:function(a){return"undefined"!=typeof a&&null!=a},firstGreaterThan0:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];if(c>0)return c}return 0},cloneObject:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},safeGet:function(b,c){return c=a.exists(c)?c:"",a.exists(b)?b:c},getBrowserName:function(){var a,b,c=navigator.userAgent,d=navigator.appName;return(b=c.indexOf("Opera"))!=-1||(b=c.indexOf("OPR/"))!=-1?d="Opera":(b=c.indexOf("Android"))!=-1?d="Android":(b=c.indexOf("Chrome"))!=-1?d="Chrome":(b=c.indexOf("Safari"))!=-1?d="Safari":(b=c.indexOf("Firefox"))!=-1?d="Firefox":(b=c.indexOf("IEMobile"))!=-1?d="Internet Explorer Mobile":"Microsoft Internet Explorer"==d||"Netscape"==d?d="Internet Explorer":(a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))&&(d=c.substring(a,b),d.toLowerCase()==d.toUpperCase()&&(d=navigator.appName)),d},getBrowserFullVersion:function(){var a,b,c,d,e,f=navigator.userAgent,g=navigator.appName,h=""+parseFloat(navigator.appVersion);return(c=f.indexOf("Opera"))!=-1?(h=f.substring(c+6),(c=f.indexOf("Version"))!=-1&&(h=f.substring(c+8))):(c=f.indexOf("OPR/"))!=-1?h=f.substring(c+4):(c=f.indexOf("Android"))!=-1?h=f.substring(c+11):(c=f.indexOf("Chrome"))!=-1?h=f.substring(c+7):(c=f.indexOf("Safari"))!=-1?(h=f.substring(c+7),(c=f.indexOf("Version"))!=-1&&(h=f.substring(c+8))):(c=f.indexOf("Firefox"))!=-1?h=f.substring(c+8):"Microsoft Internet Explorer"==g?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=e.exec(f)&&(h=parseFloat(RegExp.$1))):"Netscape"==g?(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=e.exec(f)&&(h=parseFloat(RegExp.$1))):(b=f.lastIndexOf(" ")+1)<(c=f.lastIndexOf("/"))&&(h=f.substring(c+1)),h=h.toString(),(d=h.indexOf(";"))!=-1&&(h=h.substring(0,d)),(d=h.indexOf(" "))!=-1&&(h=h.substring(0,d)),(d=h.indexOf(")"))!=-1&&(h=h.substring(0,d)),a=parseInt(""+h,10),isNaN(a)&&(h=""+parseFloat(navigator.appVersion)),h},browserAcceptsLargeURLs:function(){return null===window.ActiveXObject||!0}};return a}(),d=function(){var a="cs_",b=function(){var b="undefined"!=typeof localStorage?localStorage:{};c.extend(this,{get:function(c){return b[a+c]},set:function(c,d){b[a+c]=d},has:function(c){return a+c in b},remove:function(c){delete b[a+c]},clear:function(){for(var a in b)b.hasOwnProperty(a)&&delete b[a]}})};return b}(),e=function(a,b){var c=new Image;c.onload=function(){b&&b(200)},c.onerror=function(){b&&b()},c.src=a},f=function(a,b,c){c&&setTimeout(c,0)},g=function(){return{dir:function(a){return null},append:function(a,b,c){},write:function(a,b,c){},deleteFile:function(a,b){return!1},read:function(a,b){return null}}}(),h=function(a,b){"undefined"!=typeof engine&&b&&setTimeout(b,0);var c=engine.createHttpClient(),d=c.createRequest("GET",a,null);d.start(),b&&setTimeout(b,0)},i=function(){var a={PLATFORM:"generic",httpGet:e,httpPost:f,Storage:d,IO:g,getCrossPublisherId:function(){return null},getAppName:function(){return Constants.UNKNOWN_VALUE},getAppVersion:function(a){return Constants.UNKNOWN_VALUE},getVisitorId:function(){return this.getDeviceName()+ +new Date+~~(1e3*Math.random())},getVisitorIdSuffix:function(){return"72"},getDeviceName:function(){return""},getPlatformVersion:function(){return""},getPlatformName:function(){return"js"},getRuntimeName:function(){return""},getRuntimeVersion:function(){return""},getResolution:function(){return""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:function(){return!0},autoSelect:function(){},isCrossPublisherIdChanged:function(){return!1}};return a}(),j=function(){function a(){return"undefined"!=typeof engine&&"undefined"!=typeof engine.stats}function b(){return c.isNotEmpty(engine.stats.device.id)?engine.stats.device.id:c.isNotEmpty(engine.stats.network.mac)?engine.stats.network.mac:null}function e(){if(null==i){var a=b();null!=a?(i=a,j="31",k=a):(i=+new Date+~~(1e3*Math.random()),j="72",k=null)}}var i=null,j=null,k=null;return{PLATFORM:"trilithium",httpGet:h,httpPost:f,Storage:d,IO:g,getCrossPublisherId:function(){return e(),k},getAppName:function(){return c.isNotEmpty(engine.stats.application.name)?engine.stats.application.name:Constants.UNKNOWN_VALUE},getAppVersion:function(a){return c.isNotEmpty(engine.stats.application.version)?engine.stats.application.version:Constants.UNKNOWN_VALUE},getVisitorId:function(){return e(),i},getVisitorIdSuffix:function(){return j},getDeviceName:function(){return c.safeGet(engine.stats.device.platform,"")},getPlatformVersion:function(){return c.safeGet(engine.stats.device.version,"")},getPlatformName:function(){return"js"},getRuntimeName:function(){return"trilithium"},getRuntimeVersion:function(){return""},getResolution:function(){return"undefined"!=typeof screen&&"undefined"!=typeof screen.height&&"undefined"!=typeof screen.width?screen.height+"x"+screen.width:""},getLanguage:function(){return""},getPackageName:function(){return""},isConnectionAvailable:function(){return!0},isCompatible:a}}();i.autoSelect=function(){j.isCompatible()&&c.extend(i,j)};var k,l,m="undefined"!=typeof window&&"undefined"!=typeof document;m?(k=window,l=document):(k={},l={location:{href:""},title:"",URL:"",referrer:"",cookie:""});var c=c||{};c.filterMap=function(a,b){for(var d in a)c.indexOf(d,b)==-1&&delete a[d]},c.getKeys=function(a,b){var c,d=[];for(c in a)(!b||b.test(c))&&a.hasOwnProperty(c)&&(d[d.length]=c);return d};var n=function(){var a=["play","pause","end","buffer","keep-alive","hb","custom","ad_play","ad_pause","ad_end","ad_click"];return{PLAY:0,PAUSE:1,END:2,BUFFER:3,KEEP_ALIVE:4,HEART_BEAT:5,CUSTOM:6,AD_PLAY:7,AD_PAUSE:8,AD_END:9,AD_CLICK:10,toString:function(b){return a[b]}}}(),o=function(){var a=[n.END,n.PLAY,n.PAUSE,n.BUFFER];return{IDLE:0,PLAYING:1,PAUSED:2,BUFFERING:3,toEventType:function(b){return a[b]}}}(),p={ADPLAY:n.AD_PLAY,ADPAUSE:n.AD_PAUSE,ADEND:n.AD_END,ADCLICK:n.AD_CLICK},q={STREAMSENSE_VERSION:"4.1412.05",DEFAULT_PLAYERNAME:"streamsense",DEFAULT_HEARTBEAT_INTERVAL:[{playingtime:6e4,interval:1e4},{playingtime:null,interval:6e4}],DEFAULT_KEEP_ALIVE_INTERVAL:12e5,DEFAULT_PAUSED_ON_BUFFERING_INTERVAL:500,C1_VALUE:"19",C10_VALUE:"js",NS_AP_C12M_VALUE:"1",NS_NC_VALUE:"1",PAGE_NAME_LABEL:"name",RESTRICTED_URL_LENGTH_LIMIT:2048,URL_LENGTH_LIMIT:4096,LABELS_ORDER:["c1","c2","ca2","cb2","cc2","cd2","ns_site","ca_ns_site","cb_ns_site","cc_ns_site","cd_ns_site","ns_vsite","ca_ns_vsite","cb_ns_vsite","cc_ns_vsite","cd_ns_vsite","ns_ap_an","ca_ns_ap_an","cb_ns_ap_an","cc_ns_ap_an","cd_ns_ap_an","ns_ap_pn","ns_ap_pv","c12","ca12","cb12","cc12","cd12","ns_ak","ns_ns_ap_hw","name","ns_ap_ni","ns_ap_ec","ns_ap_ev","ns_ap_device","ns_ap_id","ns_ap_csf","ns_ap_bi","ns_ap_pfm","ns_ap_pfv","ns_ap_ver","ca_ns_ap_ver","cb_ns_ap_ver","cc_ns_ap_ver","cd_ns_ap_ver","ns_ap_sv","ns_ap_cv","ns_type","ca_ns_type","cb_ns_type","cc_ns_type","cd_ns_type","ns_radio","ns_nc","ns_ap_ui","ca_ns_ap_ui","cb_ns_ap_ui","cc_ns_ap_ui","cd_ns_ap_ui","ns_ap_gs","ns_st_sv","ns_st_pv","ns_st_it","ns_st_id","ns_st_ec","ns_st_sp","ns_st_sq","ns_st_cn","ns_st_ev","ns_st_po","ns_st_cl","ns_st_el","ns_st_pb","ns_st_hc","ns_st_mp","ca_ns_st_mp","cb_ns_st_mp","cc_ns_st_mp","cd_ns_st_mp","ns_st_mv","ca_ns_st_mv","cb_ns_st_mv","cc_ns_st_mv","cd_ns_st_mv","ns_st_pn","ns_st_tp","ns_st_pt","ns_st_pa","ns_st_ad","ns_st_li","ns_st_ci","ns_ap_jb","ns_ap_res","ns_ap_c12m","ns_ap_install","ns_ap_updated","ns_ap_lastrun","ns_ap_cs","ns_ap_runs","ns_ap_usage","ns_ap_fg","ns_ap_ft","ns_ap_dft","ns_ap_bt","ns_ap_dbt","ns_ap_dit","ns_ap_as","ns_ap_das","ns_ap_it","ns_ap_uc","ns_ap_aus","ns_ap_daus","ns_ap_us","ns_ap_dus","ns_ap_ut","ns_ap_oc","ns_ap_uxc","ns_ap_uxs","ns_ap_lang","ns_ap_ar","ns_ap_miss","ns_ts","ns_st_ca","ns_st_cp","ns_st_er","ca_ns_st_er","cb_ns_st_er","cc_ns_st_er","cd_ns_st_er","ns_st_pe","ns_st_ui","ca_ns_st_ui","cb_ns_st_ui","cc_ns_st_ui","cd_ns_st_ui","ns_st_bc","ns_st_bt","ns_st_bp","ns_st_pc","ns_st_pp","ns_st_br","ns_st_ub","ns_st_vo","ns_st_ws","ns_st_pl","ns_st_pr","ns_st_ep","ns_st_ty","ns_st_ct","ns_st_cs","ns_st_ge","ns_st_st","ns_st_dt","ns_st_de","ns_st_pu","ns_st_cu","ns_st_fee","ns_ap_i1","ns_ap_i2","ns_ap_i3","ns_ap_i4","ns_ap_i5","ns_ap_i6","c3","ca3","cb3","cc3","cd3","c4","ca4","cb4","cc4","cd4","c5","ca5","cb5","cc5","cd5","c6","ca6","cb6","cc6","cd6","c10","c11","c13","c14","c15","c16","c7","c8","c9"]},r=function(){var a=function(){function a(a,b){var c=b[a];null!=c&&(d[a]=c)}var b,d,e=this,f=0,g=0,h=0,i=0,j=0,k=0;c.extend(this,{reset:function(a){null!=a&&a.length>0?c.filterMap(d,a):d={},d.hasOwnProperty("ns_st_cl")||(d.ns_st_cl="0"),d.hasOwnProperty("ns_st_pn")||(d.ns_st_pn="1"),d.hasOwnProperty("ns_st_tp")||(d.ns_st_tp="1"),e.setPauses(0),e.setStarts(0),e.setBufferingTime(0),e.setBufferingTimestamp(-1),e.setPlaybackTime(0),e.setPlaybackTimestamp(-1)},setLabels:function(a,b){null!=a&&c.extend(d,a),e.setRegisters(d,b)},getLabels:function(){return d},setLabel:function(a,b){var c={};c[a]=b,e.setLabels(c,null)},getLabel:function(a){return d[a]},getClipId:function(){return("undefined"==typeof b||null==b)&&e.setClipId("1"),b},setClipId:function(a){b=a},setRegisters:function(b,c){var d=b.ns_st_cn;null!=d&&(e.setClipId(d),delete b.ns_st_cn),d=b.ns_st_bt,null!=d&&(h=Number(d),delete b.ns_st_bt),a("ns_st_cl",b),a("ns_st_pn",b),a("ns_st_tp",b),a("ns_st_ub",b),a("ns_st_br",b),c!=o.PLAYING&&null!=c||(d=b.ns_st_sq,null!=d&&(g=Number(d),delete b.ns_st_sq)),c!=o.BUFFERING&&(d=b.ns_st_pt,null!=d&&(j=Number(d),delete b.ns_st_pt)),c!=o.PAUSED&&c!=o.IDLE&&null!=c||(d=b.ns_st_pc,null!=d&&(f=Number(d),delete b.ns_st_pc))},createLabels:function(a,b){var d=b||{};return d.ns_st_cn=e.getClipId(),d.ns_st_bt=String(e.getBufferingTime()),a!=n.PLAY&&null!=a||(d.ns_st_sq=String(g)),a!=n.PAUSE&&a!=n.END&&a!=n.KEEP_ALIVE&&a!=n.HEART_BEAT&&null!=a||(d.ns_st_pt=String(e.getPlaybackTime()),d.ns_st_pc=String(f)),c.extend(d,e.getLabels()),d},incrementPauses:function(){f++},incrementStarts:function(){g++},getBufferingTime:function(){var a=h;return i>=0&&(a+=+new Date-i),a},setBufferingTime:function(a){h=a},getPlaybackTime:function(){var a=j;return k>=0&&(a+=+new Date-k),a},setPlaybackTime:function(a){j=a},getPlaybackTimestamp:function(){return k},setPlaybackTimestamp:function(a){k=a},getBufferingTimestamp:function(){return i},setBufferingTimestamp:function(a){i=a},getPauses:function(){return f},setPauses:function(a){f=a},getStarts:function(){return g},setStarts:function(a){g=a}}),d={},e.reset()};return a}(),s=function(){var a=function(){var a,b,d=this,e=null,f=0,g=0,h=0,i=0,j=0,k=0,l=!1;c.extend(this,{reset:function(a){null!=a&&a.length>0?c.filterMap(b,a):b={},d.setPlaylistId(+new Date+"_"+k),d.setBufferingTime(0),d.setPlaybackTime(0),d.setPauses(0),d.setStarts(0),d.setRebufferCount(0),l=!1},setLabels:function(a,e){null!=a&&c.extend(b,a),d.setRegisters(b,e)},getLabels:function(){return b},setLabel:function(a,b){var c={};c[a]=b,d.setLabels(c,null)},getLabel:function(a){return b[a]},getClip:function(){return e},getPlaylistId:function(){return a},setPlaylistId:function(b){a=b},setRegisters:function(b,c){var d=b.ns_st_sp;null!=d&&(f=Number(d),delete b.ns_st_sp),d=b.ns_st_bc,null!=d&&(h=Number(d),delete b.ns_st_bc),d=b.ns_st_bp,null!=d&&(i=Number(d),delete b.ns_st_bp),d=b.ns_st_id,null!=d&&(a=d,delete b.ns_st_id),c!=o.BUFFERING&&(d=b.ns_st_pa,null!=d&&(j=Number(d),delete b.ns_st_pa)),c!=o.PAUSED&&c!=o.IDLE&&null!=c||(d=b.ns_st_pp,null!=d&&(g=Number(d),delete b.ns_st_pp))},createLabels:function(b,e){var i=e||{};return i.ns_st_bp=String(d.getBufferingTime()),i.ns_st_sp=String(f),i.ns_st_id=String(a),h>0&&(i.ns_st_bc=String(h)),b!=n.PAUSE&&b!=n.END&&b!=n.KEEP_ALIVE&&b!=n.HEART_BEAT&&null!=b||(i.ns_st_pa=String(d.getPlaybackTime()),i.ns_st_pp=String(g)),b!=n.PLAY&&null!=b||d.didFirstPlayOccurred()||(i.ns_st_pb="1",d.setFirstPlayOccurred(!0)),c.extend(i,d.getLabels()),i},incrementStarts:function(){f++},incrementPauses:function(){g++,e.incrementPauses()},setPlaylistCounter:function(a){k=a},incrementPlaylistCounter:function(){k++},addPlaybackTime:function(a){if(e.getPlaybackTimestamp()>=0){var b=a-e.getPlaybackTimestamp();e.setPlaybackTimestamp(-1),e.setPlaybackTime(e.getPlaybackTime()+b),d.setPlaybackTime(d.getPlaybackTime()+b)}},addBufferingTime:function(a){if(e.getBufferingTimestamp()>=0){var b=a-e.getBufferingTimestamp();e.setBufferingTimestamp(-1),e.setBufferingTime(e.getBufferingTime()+b),d.setBufferingTime(d.getBufferingTime()+b)}},getBufferingTime:function(){var a=i;return e.getBufferingTimestamp()>=0&&(a+=+new Date-e.getBufferingTimestamp()),a},setBufferingTime:function(a){i=a},getPlaybackTime:function(){var a=j;return e.getPlaybackTimestamp()>=0&&(a+=+new Date-e.getPlaybackTimestamp()),a},setPlaybackTime:function(a){j=a},getStarts:function(){return f},setStarts:function(a){f=a},getPauses:function(){return g},setPauses:function(a){g=a},getRebufferCount:function(){return h},incrementRebufferCount:function(){h++},setRebufferCount:function(a){h=a},didFirstPlayOccurred:function(){return l},setFirstPlayOccurred:function(a){l=a}}),e=new r,b={},d.reset()};return a}(),t=function(){var d=function(d,e){function f(a){var b=0;if(null!=ma)for(var c=0;c<ma.length;c++){var d=ma[c],e=d.playingtime;if(!e||a<e){b=d.interval;break}}return b}function g(){l();var a=f(ja.getClip().getPlaybackTime());if(a>0){var b=pa>0?pa:a;Z=setTimeout(k,b)}pa=0}function h(){l();var a=f(ja.getClip().getPlaybackTime());pa=a-ja.getClip().getPlaybackTime()%a,null!=Z&&l()}function j(){pa=0,ra=0,qa=0}function k(){qa++;var a=N(n.HEART_BEAT,null);B(a),pa=0,g()}function l(){null!=Z&&(clearTimeout(Z),Z=null)}function m(){r(),Y=setTimeout(p,na)}function p(){var a=N(n.KEEP_ALIVE,null);B(a),ia++,m()}function r(){null!=Y&&(clearTimeout(Y),Y=null)}function t(){v(),da.isPauseOnBufferingEnabled()&&G(o.PAUSED)&&(X=setTimeout(u,oa))}function u(){if($==o.PLAYING){ja.incrementRebufferCount(),ja.incrementPauses();var a=N(n.PAUSE,null);B(a),ia++,$=o.PAUSED}}function v(){null!=X&&(clearTimeout(X),X=null)}function w(a){return a==o.PLAYING||a==o.PAUSED}function x(){T&&(clearTimeout(T),T=null)}function y(a){return a==n.PLAY?o.PLAYING:a==n.PAUSE?o.PAUSED:a==n.BUFFER?o.BUFFERING:a==n.END?o.IDLE:null}function z(a,b,d){if(x(),d)T=setTimeout(function(a,b){return function(){z(a,b)}}(a,b),d);else if(J(a)){var e=L(),f=ga,g=I(b),h=f>=0?g-f:0;E(L(),b),F(a,b),M(L()),K(a);for(var i=0,j=ca.length;i<j;i++)ca[i](e,a,b,h);A(b),ja.setRegisters(b,a),ja.getClip().setRegisters(b,a);var k=N(o.toEventType(a),b);c.extend(k,b),G(V)&&(B(k),$=V,ia++)}}function A(a){var b=a.ns_st_mp;null!=b&&(_=b,delete a.ns_st_mp),b=a.ns_st_mv,null!=b&&(aa=b,delete a.ns_st_mv),b=a.ns_st_ec,null!=b&&(ia=Number(b),delete a.ns_st_ec)}function B(a,c){void 0===c&&(c=!0),c&&D(a);var d=da.getPixelURL();if(W){if(!C()){var e=ta.am,f=ta.et,g=e.newApplicationMeasurement(W,f.HIDDEN,a,d);W.getQueue().offer(g)}}else d&&i.httpGet(b(d,a))}function C(){var a=W.getAppContext(),b=W.getSalt(),c=W.getPixelURL();return null==a||null==b||0==b.length||null==c||0==c.length}function D(a){ba=N(null),c.extend(ba,a)}function E(a,b){var d=I(b);if(a==o.PLAYING)ja.addPlaybackTime(d),h(),r();else if(a==o.BUFFERING)ja.addBufferingTime(d),v();else if(a==o.IDLE){var e=c.getKeys(ja.getClip().getLabels());ja.getClip().reset(e)}}function F(a,b){var c=I(b),d=H(b);ha=d,a==o.PLAYING?(g(),m(),ja.getClip().setPlaybackTimestamp(c),G(a)&&(ja.getClip().incrementStarts(),ja.getStarts()<1&&ja.setStarts(1))):a==o.PAUSED?G(a)&&ja.incrementPauses():a==o.BUFFERING?(ja.getClip().setBufferingTimestamp(c),la&&t()):a==o.IDLE&&j()}function G(a){return(a!=o.PAUSED&&a!=o.IDLE||$!=o.IDLE&&null!=$)&&(a!=o.BUFFERING&&$!=a)}function H(a){var b=-1;return a.hasOwnProperty("ns_st_po")&&(b=c.getInteger(a.ns_st_po)),b}function I(a){var b=-1;return a.hasOwnProperty("ns_ts")&&(b=Number(a.ns_ts)),b}function J(a){return null!=a&&L()!=a}function K(a){V=a,ga=+new Date}function L(){return V}function M(a){U=a}function N(){var a,b;1==arguments.length?(a=o.toEventType(V),b=arguments[0]):(a=arguments[0],b=arguments[1]);var d={};if("undefined"!=typeof document){var e=document;d.c7=e.URL,d.c8=e.title,d.c9=e.referrer}return null!=b&&c.extend(d,b),d.hasOwnProperty("ns_ts")||(d.ns_ts=String(+new Date)),null!=a&&!d.hasOwnProperty("ns_st_ev")&&(d.ns_st_ev=n.toString(a)),da.isPersistentLabelsShared()&&W&&c.extend(d,W.getLabels()),c.extend(d,da.getLabels()),O(a,d),ja.createLabels(a,d),ja.getClip().createLabels(a,d),d.hasOwnProperty("ns_st_mp")||(d.ns_st_mp=_),d.hasOwnProperty("ns_st_mv")||(d.ns_st_mv=aa),d.hasOwnProperty("ns_st_ub")||(d.ns_st_ub="0"),d.hasOwnProperty("ns_st_br")||(d.ns_st_br="0"),d.hasOwnProperty("ns_st_pn")||(d.ns_st_pn="1"),d.hasOwnProperty("ns_st_tp")||(d.ns_st_tp="1"),d.hasOwnProperty("ns_st_it")||(d.ns_st_it="c"),d.ns_st_sv=q.STREAMSENSE_VERSION,d.ns_type="hidden",d}function O(a,b){var d=b||{};if(d.ns_st_ec=String(ia),!d.hasOwnProperty("ns_st_po")){var e=ha,f=I(d);(a==n.PLAY||a==n.KEEP_ALIVE||a==n.HEART_BEAT||null==a&&V==o.PLAYING)&&(e+=f-ja.getClip().getPlaybackTimestamp()),d.ns_st_po=c.getInteger(e)}return a==n.HEART_BEAT&&(d.ns_st_hc=String(qa)),d}function P(a){var b=I(a);b<0&&(a.ns_ts=String(+new Date))}function Q(a,b,c){b=b||{},b.ns_st_ad=1,a>=n.AD_PLAY&&a<=n.AD_CLICK&&da.notify(a,b,c)}function R(a,b){da.notify(n.CUSTOM,a,b)}var S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da=this,ea=500,fa=null,ga=0,ha=0,ia=0,ja=null,ka=!0,la=!0,ma=q.DEFAULT_HEARTBEAT_INTERVAL,na=q.DEFAULT_KEEP_ALIVE_INTERVAL,oa=q.DEFAULT_PAUSED_ON_BUFFERING_INTERVAL,pa=0,qa=0,ra=0,sa=!1,ta={};i.autoSelect(),c.extend(this,{reset:function(a){ja.reset(a),ja.setPlaylistCounter(0),ja.setPlaylistId(+new Date+"_1"),ja.getClip().reset(a),null==a||a.isEmpty()?S={}:c.filterMap(S,a),ia=1,qa=0,h(),j(),r(),v(),x(),V=o.IDLE,U=null,ga=-1,$=null,_=q.DEFAULT_PLAYERNAME,aa=q.STREAMSENSE_VERSION,ba=null},setPauseOnBufferingInterval:function(a){oa=a},getPauseOnBufferingInterval:function(){return oa},setKeepAliveInterval:function(a){na=a},getKeepAliveInterval:function(){return na},setHeartbeatIntervals:function(a){ma=a},notify:function(){var a,b,d,e;b=arguments[0],3==arguments.length?(d=arguments[1],e=arguments[2]):(d={},e=arguments[1]),a=y(b);var f=c.extend({},d);if(P(f),f.hasOwnProperty("ns_st_po")||(f.ns_st_po=c.getInteger(e).toString()),b==n.PLAY||b==n.PAUSE||b==n.BUFFER||b==n.END)da.isPausePlaySwitchDelayEnabled()&&w(V)&&w(a)&&(V!=o.PLAYING||a!=o.PAUSED||T)?z(a,f,ea):z(a,f);else{var g=N(b,f);c.extend(g,f),B(g,!1),ia++}},getLabels:function(){return S},getState:function(){return V},setLabels:function(a){null!=a&&(null==S?S=a:c.extend(S,a))},getLabel:function(a){return S[a]},setLabel:function(a,b){null==b?delete S[a]:S[a]=b},setPixelURL:function(a){if(null==a||0==a.length)return null;var b=decodeURIComponent||unescape,c=a.indexOf("?");if(c>=0){if(c<a.length-1){for(var d=a.substring(c+1).split("&"),e=0,f=d.length;e<f;e++){var g=d[e],h=g.split("=");2==h.length?da.setLabel(h[0],b(h[1])):1==h.length&&da.setLabel(q.PAGE_NAME_LABEL,b(h[0]))}a=a.substring(0,c+1)}}else a+="?";return fa=a},getPixelURL:function(){return fa?fa:"undefined"!=typeof ns_p&&"string"==typeof ns_p.src?fa=ns_p.src.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):"string"==typeof ns_pixelUrl?fa=ns_pixelUrl.replace(/&amp;/,"&").replace(/&ns__t=\d+/,""):null},isPersistentLabelsShared:function(){return ka},setPersistentLabelsShared:function(a){ka=a},isPauseOnBufferingEnabled:function(){return la},setPauseOnBufferingEnabled:function(a){la=a},isPausePlaySwitchDelayEnabled:function(){return sa},setPausePlaySwitchDelayEnabled:function(a){sa=a},setPausePlaySwitchDelay:function(a){a&&a>0&&(ea=a)},getPausePlaySwitchDelay:function(){return ea},setClip:function(a,b){var c=!1;return V==o.IDLE&&(ja.getClip().reset(),ja.getClip().setLabels(a,null),b&&ja.incrementStarts(),c=!0),c},setPlaylist:function(a){var b=!1;return V==o.IDLE&&(ja.incrementPlaylistCounter(),ja.reset(),ja.getClip().reset(),ja.setLabels(a,null),b=!0),b},importState:function(a){reset();var b=c.extend({},a);ja.setRegisters(b,null),ja.getClip().setRegisters(b,null),A(b),ia++},exportState:function(){return ba},getVersion:function(){return q.STREAMSENSE_VERSION},addListener:function(a){ca.push(a)},removeListener:function(a){ca.splice(c.indexOf(a,ca),1)},getClip:function(){return ja.getClip()},getPlaylist:function(){return ja}}),c.extend(this,{adNotify:Q,customNotify:R,viewNotify:function(b,c){b=b||da.getPixelURL(),b&&a(b,c)}}),ns_.comScore&&(ta=ns_.comScore.exports,W=ta.c()),S={},ia=1,V=o.IDLE,ja=new s,X=null,la=!0,Z=null,qa=0,j(),Y=null,T=null,sa=!1,$=null,ha=0,ca=[],da.reset(),d&&da.setLabels(d),e&&da.setPixelURL(e)};return function(a){function b(a,b){return w[y]||e(a,b)}function d(){y=-1;for(var a=0;a<=x;a++)if(w.hasOwnProperty(a)){y=a;break}return ns_.StreamSense.activeIndex=y,y}function e(a,b){return a=a||null,b=b||null,a&&"object"==typeof a&&(b=a,a=null),w[++x]=new ns_.StreamSense(b,a),d(),w[x]}function f(){var a=!1,b=y;if("number"==typeof arguments[0]&&isFinite(arguments[0]))b=arguments[0];else if(arguments[0]instanceof ns_.StreamSense)for(var c in w)if(w[c]===arguments[0]){b=c;break}return w.hasOwnProperty(b)&&(a=w[b],delete w[b],a.reset(),d()),a}function g(a){return a=a||{},b().setPlaylist(a),b().getPlaylist()}function h(a,c,d){return a=a||{},"number"==typeof c&&(a.ns_st_cn=c),b().setClip(a,d),b().getClip()}function i(a,c,d){return"undefined"!=typeof a&&(d=d||null,c=c||{},b().notify(a,c,d))}function j(a){"undefined"!=typeof a&&b().setLabels(a)}function k(){return b().getLabels()}function l(a){"undefined"!=typeof a&&b().getPlaylist().setLabels(a)}function m(){return b().getPlaylist().getLabels()}function n(a){"undefined"!=typeof a&&b().getClip().setLabels(a)}function o(){return b().getClip().getLabels()}function p(a){return b().reset(a||{})}function q(a){return b().getPlaylist().reset(a||{})}function r(a){return b().getClip().reset(a||{})}function s(a){return a=a||{},b().viewNotify(null,a)}function t(a,c){return arguments.length>2&&(a=arguments[1],c=arguments[2]),a=a||{},"number"==typeof c&&(a.ns_st_po=c),b().customNotify(a,c)}function u(){return b().exportState()}function v(a){b().importState(a)}var w={},x=-1,y=-1;c.extend(a,{activeIndex:y,newInstance:e,"new":e,destroyInstance:f,destroy:f,newPlaylist:g,newClip:h,notify:i,setLabels:j,getLabels:k,setPlaylistLabels:l,getPlaylistLabels:m,setClipLabels:n,getClipLabels:o,resetInstance:p,resetPlaylist:q,resetClip:r,viewEvent:s,customEvent:t,exportState:u,importState:v})}(d),d}();return t.AdEvents=p,t.PlayerEvents=n,ns_.StreamingTag=ns_.StreamingTag||function(){var a=function(){var a=function(a){function b(){if(!ns_.comScore&&c.exists(a))if(u=c.isTrue(a.debug),c.exists(a.customerC2)){var b=a.secure?"https://sb":"http"+("s"==document.location.href.charAt(4)?"s://sb":"://b");s.setPixelURL(b+".scorecardresearch.com/p?c1=2"),s.setLabel("c2",a.customerC2)}else s.setPixelURL(""),u&&console.log("Warning: customerC2 is not provided (or incorrect) in the StreamingTag configuration.");s.setLabel("ns_st_it","r")}function d(a){return c.exists(a)||(a={}),c.exists(a.ns_st_ci)||(a.ns_st_ci="0"),c.exists(a.c3)||(a.c3="*null"),c.exists(a.c4)||(a.c4="*null"),c.exists(a.c6)||(a.c6="*null"),a}function e(a){return m>0&&a>=m?p+=a-m:p=0,p}function f(a){s.getState()!=o.IDLE&&s.getState()!=o.PAUSED?s.notify(n.END,e(a)):s.getState()==o.PAUSED&&s.notify(n.END,p);
}function g(a){return h("ns_st_ci",q,a)&&h("c3",q,a)&&h("c4",q,a)&&h("c6",q,a)}function h(a,b,d){if(c.exists(a)&&c.exists(b)&&c.exists(d)){var e=b[a],f=d[a];return c.exists(e)&&c.exists(f)&&e===f}return!1}function i(a,b){f(a),l++;var d={ns_st_cn:l,ns_st_pn:"1",ns_st_tp:"0"};c.extend(d,b),s.setClip(d),q=b,m=a,p=0,s.notify(n.PLAY,p)}function j(a){var b=+new Date;f(b),l++,a=d(a);var e={ns_st_cn:l,ns_st_pn:"1",ns_st_tp:"1",ns_st_ad:"1"};c.extend(e,a),s.setClip(e),p=0,s.notify(n.PLAY,p),m=b,r=!1}function k(a,b){var c=+new Date;a=d(a),w==v.None&&(w=b),r&&w==b&&g(a)?(s.getClip().setLabels(a),s.getState()!=o.PLAYING&&(m=c,s.notify(n.PLAY,p))):i(c,a),r=!0,w=b}var l=0,m=0,p=0,q=null,r=!1,s=new t,u=!1,v={None:0,AudioContent:1,VideoContent:2},w=v.None;c.extend(this,{playAdvertisement:function(){u&&console&&console.warn("Calling deprecated function 'playAdvertisement'. Please call 'playVideoAdvertisement' or 'playAudioAdvertisement' functions instead.");var a={ns_st_ct:"va"};j(a)},playVideoAdvertisement:function(a){var b={ns_st_ct:"va"};a&&c.extend(b,a),j(b)},playAudioAdvertisement:function(a){var b={ns_st_ct:"aa"};a&&c.extend(b,a),j(b)},playContentPart:function(a){u&&console&&console.warn("Calling deprecated function 'playContentPart'. Please call 'playVideoContentPart' or 'playAudioContentPart' functions instead.");var b={ns_st_ct:"vc"};a&&c.extend(b,a),k(b,v.VideoContent)},playVideoContentPart:function(a){var b={ns_st_ct:"vc"};a&&c.extend(b,a),k(b,v.VideoContent)},playAudioContentPart:function(a){var b={ns_st_ct:"ac"};a&&c.extend(b,a),k(b,v.AudioContent)},stop:function(){var a=+new Date;s.notify(n.PAUSE,e(a))}}),b()};return function(a){}(a),a}();return a}(),t}(),define("vendor/stream_sense",[],function(){"use strict";return window.ns_}),define("lib/videoMetrix",["lodash","utils/ted","vendor/stream_sense","exports"],function(a,b,c,d){"use strict";d.init=function(a){this._init(),this._setContext(a)},d.start=function(){this._play()},d.stop=function(){this._tag&&this._tag.stop()},d.startAd=function(){this._asset.isInAd=!0,this._play()},d.stopAd=function(){this._asset.isInAd=!1,this._play()},d._meta=null,d._asset=null,d._tag=null,d._init=a.once(function(){d._tag=new c.StreamingTag({customerC2:b("csClientId")})}),d._setContext=function(a){var b={};a.talkId&&(b.ns_st_ci=a.talkId),this._meta=b,this._asset={isInAd:!1,isVideo:!0}},d._reset=function(){d._meta=null,d._asset=null,d._tag=null},d._play=function(){this._tag&&(this._asset.isInAd?this._asset.isVideo?this._tag.playVideoAdvertisement():this._tag.playAudioAdvertisement():this._asset.isVideo?this._tag.playVideoContentPart(this._meta):this._tag.playAudioContentPart(this._meta))}}),define("widgets/player/cs-tracker",["jquery","utils/ted","lib/videoMetrix"],function(a,b,c){"use strict";function d(b){b._isInternal&&(this._data={lastMetaTalkId:null,lastPlayTalkId:null},this._widget=b,this._addHandlers(),a(window).unload(function(){c.stop()}))}return d.prototype._sendViewBeacon=function(a){var c=window.COMSCORE;c&&c.beacon&&c.beacon({c1:"1",c2:b("csClientId"),c5:"02",c6:a})},d.prototype._sendPostrollBeacon=function(){var a=window.COMSCORE;a&&a.beacon&&a.beacon({c1:"1",c2:b("csClientId"),c5:"10"})},d.prototype._onTalkPlay=function(a){this._sendViewBeacon(a)},d.prototype._addHandlers=function(){var a=this,b={playertalk:function(a,b){c.init({talkId:b.id})},playerplay:function(){var b=a._widget.options.currentTalk.id;a._data.lastPlayTalkId!==b&&(a._onTalkPlay(b),a._data.lastPlayTalkId=b),c.start()},playerpause:function(){c.stop()},playercomplete:function(){c.stop()},playerprerollstart:function(){c.startAd()},playerprerollcomplete:function(){c.stopAd()},playerpostrollstart:function(){a._sendPostrollBeacon(),c.startAd()},playerpostrollcomplete:function(){c.stopAd()}};this._handlers=b,this._widget._on(b)},d}),define("lib/abby",["utils/ted","exports"],function(a,b){"use strict";b.getTests=function(){var b=a("abby");return b&&b.tests||{}},b.getVariation=function(a){return b.getTests()[a]},b.isVariation=function(a,c){return b.getVariation(a)===c}}),define("utils/f",[],function(){"use strict";var a=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a[b].apply(a,c)}};return a.create=function(a){return function(){var b=arguments,c=function(){return a.apply(this,b)};return c.prototype=a.prototype,new c}},a.get=function(a){return function(b){return b.get&&"function"==typeof b.get?b.get(a):b[a]&&"function"==typeof b[a]?b[a].call(b):b[a]}},a.splat=function(){var b=Array.prototype.slice.call(arguments);return function(c){for(var d=[],e=0;e<b.length;e++)d.push(a.get(b[e]).call(c));return d}},a.send=function(a){var b=Array.prototype.slice.call(arguments,1);return function(c){return c[a].apply(c,b)}},a.and=function(){var a=Array.prototype.slice.call(arguments);return function(b){for(var c=!0,d=0;d<a.length;d++)c=c&&a[d].call(null,b);return c}},a.not=function(a){return function(){return!a.apply(null,arguments)}},a.ascending=function(a,b){return a-b},a.descending=function(a,b){return b-a},a.truthy=function(a){return!!a},a.falsey=a.not(a.truthy),a}),define("player/topicFactory",["jquery"],function(a){"use strict";function b(c,d,e){var f,g;for(f=0,g=d.length;f<g;f++)a.isArray(d[f])?b(c,d[f],e):d[f].apply(c,e)}return function(c){var d={};return function(e){var f,g=e&&d[e];if(!g){f=a.Callbacks(c&&c.hasOwnProperty(e)?c[e]:"memory"),g={publish:f.fire,subscribe:f.add,unsubscribe:f.remove,once:function(){function a(){b(f,c,arguments),f.remove(a)}var c=arguments;return f.add(a)},publishUnique:function(){var a;return!!window.JSON&&function(){var b=Array.prototype.slice.call(arguments,0),c=JSON.stringify(b);c!==a&&(f.fire.apply(f,b),a=c)}}()};var h=null;f.add(function(a){h=a}),g.read=function(){return h},e&&(d[e]=g)}return g}}}),define("player/getFlashVars",["jquery"],function(a){"use strict";function b(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}return function(a){a.options;return b({serviceHost:"https://www.ted.com",volume:a.config.get("volume"),autoplay:0,fullscreenEnabled:a.canFullScreen?0:1})}}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define("ted-master-ad-interface",["exports"],b):b(a.mai=a.mai||{})}(this,function(a){"use strict";function b(a){if(a&&"undefined"!=typeof Image){var b=new Image;b.src=a}}function c(a,b){var c=new XMLHttpRequest;if("withCredentials"in c)c.open(a,b,!0);else{if("undefined"==typeof XDomainRequest)throw new Error("No CORS/XHR support");c=new XDomainRequest,c.open(a,b)}return c}function d(a){return new Promise(function(b,d){var e=void 0,f=setTimeout(function(){d(new Error("Request timed out"))},5e3);try{e=c("GET",a,!0)}catch(g){d(g)}e.onreadystatechange=function(){4===e.readyState&&(clearTimeout(f),200===e.status?b(e):d(new Error("HTTP status: "+e.status+"; message: "+e.statusText)))},e.send()})}function e(a){return new Promise(function(b,c){d(a).then(function(a){try{var d=JSON.parse(a.response);b(d)}catch(e){c(new Error("JSON response could not be parsed"))}})["catch"](c)})}function f(a){return new Promise(function(b,c){d(a).then(function(a){var d=void 0,e=void 0;try{"undefined"!=typeof DOMParser?(d=new DOMParser,e=d.parseFromString(a.responseText,"text/xml")):"undefined"!=typeof ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(a.responseText)):c(new Error("XML parsing unavailable"))}catch(f){e=void 0}e?b(e):c(new Error("XML response could not be parsed"))})["catch"](c)})}function g(a){return String(a).replace(/[!\+#\*~;\^\(\)<>\[\]]/g,"-")}function h(a){return g(a).replace(" ","-")}function i(){return 999999*Math.random()|0}function j(a){return a.map(function(a){return a[0]+"x"+a[1]}).join("|")}function k(a){return Object.getOwnPropertyNames(a).map(function(b){return p(h(b))+"="+p(g(a[b]))}).join("&")}function l(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];["adUnitId","sizes"].forEach(function(b){if(!a[b])throw new Error("'"+b+"' is a required option")});var b={iu:a.adUnitId,sz:j(a.sizes)};if(a.targeting){var c=k(a.targeting);c&&(b.t=c)}return b}function m(a){var b=Object.getOwnPropertyNames(a).map(function(b){return p(b)+"="+p(a[b])});return b.push("c="+i()),"https://pubads.g.doubleclick.net/gampad/adx?"+b.join("&")}function n(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return m(l(a))}function o(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=new A(a,c);return d.loadMaster(b).then(function(){return Promise.all([d.loadPreroll(),d.loadPostroll()])}).then(function(){return d.getData()})}var p=encodeURIComponent,q=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},r=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),s=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},t=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},u=function(){function a(b){q(this,a),b.ad&&(this.lineItemId=b.ad.lineItemId,this.creativeId=b.ad.creativeId,this.prerollUrl=b.ad.prerollURL,this.postrollUrl=b.ad.postrollURL,this.companionTargetingValue=b.ad.target,this.impressionUrl=b.ad.impression)}return r(a,null,[{key:"fromUrl",value:function(c){return e(c).then(function(b){return new a(b)}).then(function(a){return b(a.impressionUrl),a})}},{key:"fromOptions",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b={sizes:[[2,2]]},c=n(Object.assign(b,a));return this.fromUrl(c+"&unviewed_position_start=1")}}]),a}(),v=function(){function a(b){q(this,a);var c=b.preroll;c&&(this.impressions=a.getImpressions(c),this.hlsParamValue=c.ios_preroll)}return r(a,null,[{key:"getImpressions",value:function(a){var b=[];return a.impression&&b.push(a.impression),a.third_party_impressions&&a.third_party_impressions.length>0&&(b=b.concat(a.third_party_impressions)),b}},{key:"fromUrl",value:function(b){return e(b).then(function(b){return new a(b)})}}]),a}(),w=function(){function a(){q(this,a)}return r(a,null,[{key:"fromUrl",value:function(){return new Promise(function(b){var c=new a;b(c)})}}]),a}(),x=function(){function a(){q(this,a)}return r(a,[{key:"getXmlEls",value:function(a,b){return Array.from(b.getElementsByTagName(a))}},{key:"getXmlAttr",value:function(a,b){return(Array.from(a.attributes).find(function(a){return a.name===b})||{}).value}},{key:"getXmlText",value:function(a){var b=a&&a.childNodes&&a.childNodes[0];return b?b.nodeValue:""}}]),a}(),y=function(a){function b(a){q(this,b);var c=t(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.q0Impressions=[],c.q1Impressions=[],c.q2Impressions=[],c.q3Impressions=[],c.q4Impressions=[];var d=c.getXmlEls("Linear",a)[0];if(!d)return t(c);var e=c.getXmlText(c.getXmlEls("Impression",a)[0]);e&&c.q0Impressions.push(e),c.getXmlEls("Tracking",d).forEach(function(a){var b=c.getXmlAttr(a,"event"),d=c.getXmlText(a);switch(b){case"start":case"creativeView":c.q0Impressions.push(d);break;case"firstQuartile":c.q1Impressions.push(d);break;case"midpoint":c.q2Impressions.push(d);break;case"thirdQuartile":c.q3Impressions.push(d);break;case"complete":c.q4Impressions.push(d)}});var f=c.getXmlText(c.getXmlEls("AdParameters",d)[0]),g=f.match(/postroll=([^&]+)/);return g&&(c.hlsParamValue=g[1]),c}return s(b,a),r(b,null,[{key:"fromUrl",value:function(a){return f(a).then(function(a){return new b(a)})}}]),b}(x),z=encodeURIComponent,A=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];q(this,a),this.adUnitId=b,this.postrollType=c.postrollType||"stitched",this.master={},this.preroll={},this.postroll={}}return r(a,[{key:"getHlsParams",value:function(){var a=[],b=this.postroll,c=this.preroll;return c.hlsParamValue&&a.push("preroll="+z(c.hlsParamValue)),b.hlsParamValue&&a.push("postroll="+z(b.hlsParamValue)),a.join("&")}},{key:"getPostrollConstructor",value:function(){switch(this.postrollType){case"ima":return w;case"stitched":return y;default:throw new Error("Unrecognized postroll type: "+this.postrollType)}}},{key:"getData",value:function(){var a=this.master,b=this.preroll,c=this.postroll;return{lineItemId:a.lineItemId,creativeId:a.creativeId,prerollUrl:this.addAdUnitToUrl(a.prerollUrl),prerollImpressions:[].concat(b.impressions||[]),postrollType:this.postrollType,postrollUrl:this.addAdUnitToUrl(a.postrollUrl),postrollQ0Impressions:[].concat(c.q0Impressions||[]),postrollQ1Impressions:[].concat(c.q1Impressions||[]),postrollQ2Impressions:[].concat(c.q2Impressions||[]),postrollQ3Impressions:[].concat(c.q3Impressions||[]),postrollQ4Impressions:[].concat(c.q4Impressions||[]),companionTargetingValue:a.companionTargetingValue,hlsParams:this.getHlsParams()}}},{key:"addAdUnitToUrl",value:function(a){return a.replace("{adUnit}",this.adUnitId)}},{key:"loadMaster",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return u.fromOptions({adUnitId:this.adUnitId,targeting:b}).then(function(b){return a.master=b,a})}},{key:"loadPreroll",value:function(){var a=this,b=this.addAdUnitToUrl(this.master.prerollUrl);return v.fromUrl(b).then(function(b){return a.preroll=b,a})["catch"](function(){return a})}},{key:"loadPostroll",value:function(){var a=this,b=this.addAdUnitToUrl(this.master.postrollUrl),c=this.getPostrollConstructor();return c.fromUrl(b).then(function(b){return a.postroll=b,a})["catch"](function(){return a})}}]),a}();a.loadAd=o,a["default"]=o,Object.defineProperty(a,"__esModule",{value:!0})}),define("player/handleError",["jquery"],function(a){"use strict";var b=window.console;return function(c){b&&b.log&&b.log("Player error:\n"+(c?c.stack||c.message||"unknown":"unknown")),a.post("https://error-collector.ted.com/",{message:c})}}),define("player/hlsVastParser",["jquery","./topicFactory","./handleError"],function(a,b,c){"use strict";function d(a){this.vast=a,this.topic=b({companion:void 0}),this.loadCompanions()}function e(a){this.vastData=a,this.url=this.vastData.find("IFrameResource").text()}a.extend(d.prototype,{loadCompanions:function(){var a=this;this.preroll=new e(this.vast.find("Companion[width=6][height=7]")),this.companion=new e(this.vast.find("Companion[width=6][height=8]")),this.companion.load(function(b){b&&a.topic("companion").publish(b)})},sponsor:function(){var a={},b=this.vast.find("AdParameters").text().split("=");return a[b[0]]=b[1],a},prerollUrl:function(){return[this.preroll.url]},impressionUrl:function(){return[this.vast.find("Impression").text()]},clickUrl:function(){return this.vast.find("ClickThrough").text()}});var f=["start","firstQuartile","midpoint","thirdQuartile","complete","mute","unmute","rewind","pause","resume","fullscreen","creativeView"];return f.forEach&&f.forEach(function(b){d.prototype[b+"Url"]=function(){return a.makeArray(this.vast.find("Linear Tracking[event="+b+"]").map(function(b,c){return a(c).text()}))}}),a.extend(e.prototype,{load:function(b){var d=this;return""==this.url?b():void a.getJSON(this.url).done(function(a){d.ad=a.companion?{type:"companion-mobile",dimensions:{width:320,height:50},hasDisplay:!0,houseAd:!1,creative:[{density:1,url:a.companion.creative.standard},{density:2,url:a.companion.creative.standard_2x}],impression:null,thirdPartyImpressions:a.companion.impression,click:a.companion.click,lineItemId:null,creativeId:null}:a.ad,b(d.ad)}).fail(function(a,b,e){c({context:"hls",error:"Error retrieving companion ad",status:b,url:d.url})})}}),d}),define("player/hlsInitTalk",["jquery","ted-master-ad-interface","./hlsVastParser","./handleError"],function(a,b,c,d){"use strict";function e(b){var d=new a.Deferred,e=d.promise();return b=b.replace("%5Bcorrelator%5D",Math.random().toFixed(12).substr(2)),a.ajax({url:b,timeout:2e3}).then(function(b){d.resolve(new c(a(b)))},function(a,b,c){d.reject(b,c)}),e}function f(a,b,c){c&&(b+=(b.indexOf("?")===-1?"?":"&")+c),a._setSource(b)}return function(c,g){var h,i=new a.Deferred,j=i.promise(),k={};try{h=c.currentTalk.resources.hls.stream}catch(l){return c.throwError({type:"init",message:"Missing HLS stream resource.",severity:"fatal"}),i.reject(),j}if(c.options.mai){var m,n=c.currentTalk.resources.hls,o={postrollType:c.options.maiPostrollType},p=n.maiTargeting||{};try{m=c.options.maiAdUnitId}catch(l){return c.throwError({type:"init",message:"Missing MAI ad unit ID.",severity:"fatal"}),i.reject(),j}return c.maiAd=void 0,b.loadAd(m,p,o).then(function(a){c.maiAd=a,c.topic("ad").publish({type:"master",target:a.companionTargetingValue}),f(c,h,a.hlsParams),i.resolve()})["catch"](function(a){d({context:"hls",error:"Error retrieving MAI ad",message:"MAI: "+a.message,status:"MAI: "+a.message}),f(c,h),i.resolve()}),j}var q;try{q=c.currentTalk.resources.hls.adUrl}catch(l){return c.throwError({type:"init",message:"Missing HLS stream resource.",severity:"fatal"}),i.reject(),j}return e(q).done(function(b){c.vastAd=b,a.extend(k,b.sponsor())}).fail(function(a,b){d({context:"hls",error:"Error retrieving VAST ad",status:a,url:c.currentTalk.resources.hls.adUrl})}).always(function(){f(c,h,a.param(k)),i.resolve()}),j}}),define("player/replaceElement",["jquery","./getFlashVars","./hlsInitTalk","swfobject"],function(a,b,c){"use strict";function d(a){return a.id||(a.id="ted-player-"+i++),a.id}function e(a){var c={bgcolor:"#000000",quality:"high",wmode:"opaque",allowscriptaccess:"always",allowfullscreen:"true"},e=a.options,f=d(e.el);if("OBJECT"!==e.el.nodeName){var g=b(a),h=e.attrs;c.flashvars=g,h.data=e.swf,swfobject.createSWF(h,c,f)}a.el=document.getElementById(f),a.topic("ready.dom").publish()}function f(b){var c,e=b.options,f=a("<video>"),g=d(e.el);b.currentTalk=e.talks[0],c=b.currentTalk.resources.h264[0].file,f.attr(e.attrs),b.options.shareToken&&(c=c+"&share_token="+b.options.shareToken),f.attr("preload","none"),f.attr("src",c),f.attr("id",g),a(e.el).replaceWith(f),b.el=f[0],b.topic("ready.dom").publish()}function g(b){var e=b.options,f=a("<video>"),g=d(e.el);b.currentTalk=e.talks[0],f.attr(e.attrs),f.attr("id",g),c(b,f).always(function(){a(e.el).replaceWith(f),b.el=f[0],b.topic("ready.dom").publish()})}function h(b){var e=b.options,f=a("<video>"),g=d(e.el);b.currentTalk=e.talks[0],f.attr(e.attrs),f.attr("id",g),a(e.el).replaceWith(f),b.el=f[0],c(b,f).always(function(){b.topic("ready.dom").publish()})}var i=Math.floor(9999*Math.random()),j={flash:e,h264:f,hls:g,hlsjs:h};return function(a){return j[a.mode]?j[a.mode](a):void a.throwError({type:"init",message:"Cannot replace element for unrecognized player mode: "+a.mode,severity:"fatal"})}}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("hlsjs",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Hls=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a){for(var b,c=Object.keys(f),h=0,i=c.length;h<i;h++){var j=c[h],k=f[j].exports;if(k===a||k["default"]===a){b=j;break}}if(!b){b=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var l={},h=0,i=c.length;h<i;h++){var j=c[h];l[j]=j}e[b]=[Function(["require","module","exports"],"("+a+")(self)"),l]}var m=Math.floor(Math.pow(16,8)*Math.random()).toString(16),n={};n[b]=b,e[m]=[Function(["require"],"var f = require("+g(b)+");(f.default ? f.default : f)(self);"),n];var o="("+d+")({"+Object.keys(e).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(m)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(p.createObjectURL(new Blob([o],{type:"text/javascript"})))}},{}],3:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(28),n=d(m),o=a(24),p=a(43),q=a(8),r=d(q),s=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].FRAG_LOADING,j["default"].FRAG_LOADED,j["default"].ERROR));return c.lastLoadedFragLevel=0,c._autoLevelCapping=-1,c._nextAutoLevel=-1,c.hls=a,c.onCheck=c.abandonRulesCheck.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.clearTimer(),l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this.bwEstimator=new r["default"](c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}}},{key:"abandonRulesCheck",value:function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader;if(!d||d.stats&&d.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();var e=d.stats;if(b&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var f=performance.now()-e.trequest,g=Math.abs(b.playbackRate);if(f>500*c.duration/g){var h=a.levels,i=Math.max(1,e.bw?e.bw/8:1e3*e.loaded/f),k=e.total?e.total:Math.max(e.loaded,Math.round(c.duration*h[c.level].bitrate/8)),l=b.currentTime,m=(k-e.loaded)/i,o=(n["default"].bufferInfo(b,l,a.config.maxBufferHole).end-l)/g;if(o<2*c.duration/g&&m>o){var q=void 0,r=void 0;for(r=c.level-1;r>=0&&(q=c.duration*h[r].bitrate/(6.4*i),p.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+r+"] :"+m.toFixed(1)+"/"+o.toFixed(1)+"/"+q.toFixed(1)),!(q<o));r--);q<m&&(r=Math.max(0,r),a.nextLoadLevel=r,this.bwEstimator.sample(f,e.loaded),p.logger.warn("loading too slow, abort fragment loading and switch to level "+r),c.loader.abort(),this.clearTimer(),a.trigger(j["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:e}))}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if("main"===b.type){var c=a.stats;if(void 0===c.aborted&&1===b.loadCounter){var d=c.tload-c.trequest;this.bwEstimator.sample(d,c.loaded),b.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1}}},{key:"onError",value:function(a){switch(a.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(a,b,c,d,e,f,g,h){for(var i=d;i>=0;i--){var j=h[i],k=j.details,l=k?k.totalduration/k.fragments.length:b,m=void 0;m=i<=a?f*c:g*c;var n=h[i].bitrate,o=n*l/m;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+i+"/"+Math.round(m)+"/"+n+"/"+l+"/"+e+"/"+o),m>n&&(!o||o<e))return i}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping=a}},{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this.bwEstimator;if(!(a===-1||b&&b.canEstimate()))return Math.min(a,this.maxAutoLevel);var c=this.nextABRAutoLevel;return a!==-1&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}},{key:"maxAutoLevel",get:function(){var a,b=this.hls.levels,c=this._autoLevelCapping;return a=c===-1&&b&&b.length?b.length-1:c}},{key:"nextABRAutoLevel",get:function(){var a=this.hls,b=this.maxAutoLevel,c=a.levels,d=a.config,e=a.media,f=this.lastLoadedFragLevel,g=this.fragCurrent?this.fragCurrent.duration:0,h=e?e.currentTime:0,i=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,j=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,k=(n["default"].bufferInfo(e,h,d.maxBufferHole).end-h)/i,l=this.findBestLevel(f,g,j,b,k,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(l>=0)return l;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var m=d.maxStarvationDelay;if(0===k){var o=this.bitrateTestDelay;o&&(m-=o,p.logger.trace("bitrate test took "+Math.round(1e3*o)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"))}return l=this.findBestLevel(f,g,j,b,k+m,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c),Math.max(l,0)}}]),b}(l["default"]);c["default"]=s},{24:24,25:25,26:26,28:28,43:43,8:8}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(39),j=d(i),k=a(28),l=d(k),m=a(20),n=d(m),o=a(26),p=d(o),q=a(25),r=d(q),s=a(29),t=d(s),u=a(45),v=d(u),w=a(24),x=a(43),y={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,p["default"].MEDIA_ATTACHED,p["default"].MEDIA_DETACHING,p["default"].AUDIO_TRACKS_UPDATED,p["default"].AUDIO_TRACK_SWITCH,p["default"].AUDIO_TRACK_LOADED,p["default"].KEY_LOADED,p["default"].FRAG_LOADED,p["default"].FRAG_PARSING_INIT_SEGMENT,p["default"].FRAG_PARSING_DATA,p["default"].FRAG_PARSED,p["default"].ERROR,p["default"].BUFFER_CREATED,p["default"].BUFFER_APPENDED,p["default"].BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r["default"].prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){if(this.tracks){var b=this.media,c=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b&&c?(x.logger.log("configure startPosition @"+c),this.state=y.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,
this.state=y.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c,d=this.hls,e=d.config;switch(this.state){case y.ERROR:case y.PAUSED:break;case y.STARTING:this.state=y.WAITING_TRACK,this.loadedmetadata=!1;break;case y.IDLE:if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;a=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var f=this.mediaBuffer?this.mediaBuffer:this.media,g=l["default"].bufferInfo(f,a,e.maxBufferHole),h=g.len,i=g.end,k=this.fragPrevious,m=e.maxMaxBufferLength;if(h<m&&this.trackId<this.tracks.length){if(c=this.tracks[this.trackId].details,"undefined"==typeof c){this.state=y.WAITING_TRACK;break}if(!c.live&&k&&k.sn===c.endSN&&(!this.media.seeking||this.media.duration-i<k.duration/2)){this.hls.trigger(p["default"].BUFFER_EOS,{type:"audio"}),this.state=y.ENDED;break}var n=c.fragments,o=n.length,q=n[0].start,r=n[o-1].start+n[o-1].duration,s=void 0;if(i<q?s=n[0]:!function(){var a=void 0,b=e.maxFragLookUpTolerance;i<r?(i>r-b&&(b=0),a=j["default"].search(n,function(a){return a.start+a.duration-b<=i?1:a.start-b>i?-1:0})):a=n[o-1],a&&(s=a,q=a.start,k&&s.level===k.level&&s.sn===k.sn&&(s.sn<c.endSN?(s=n[s.sn+1-c.startSN],x.logger.log("SN just loaded, load next one: "+s.sn)):s=null))}(),s)if(null!=s.decryptdata.uri&&null==s.decryptdata.key)x.logger.log("Loading key for "+s.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+this.trackId),this.state=y.KEY_LOADING,d.trigger(p["default"].KEY_LOADING,{frag:s});else{if(x.logger.log("Loading "+s.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+this.trackId+", currentTime:"+a+",bufferEnd:"+i.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,s.loadCounter){s.loadCounter++;var t=e.fragLoadingLoopThreshold;if(s.loadCounter>t&&Math.abs(this.fragLoadIdx-s.loadIdx)<t)return void d.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:s})}else s.loadCounter=1;s.loadIdx=this.fragLoadIdx,this.fragCurrent=s,this.startFragRequested=!0,d.trigger(p["default"].FRAG_LOADING,{frag:s}),this.state=y.FRAG_LOADING}}break;case y.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var u=performance.now(),v=this.retryDate;f=this.media;var z=f&&f.seeking;(!v||u>=v||z)&&(x.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===y.ENDED&&(this.state=y.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){x.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitch",value:function(a){var b=!!a.url;this.trackId=a.id,this.state=y.IDLE,this.fragCurrent=null,this.state=y.PAUSED,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration;if(x.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.PTSKnown=!1,d.details=b,!this.startFragRequested){if(this.startPosition===-1){var f=b.startTimeOffset;isNaN(f)?this.startPosition=0:(x.logger.log("start time offset found in playlist, adjust startPosition to "+f),this.startPosition=f)}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_TRACK&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent;if(this.state===y.FRAG_LOADING&&b&&"audio"===a.frag.type&&a.frag.level===b.level&&a.frag.sn===b.sn){this.state=y.PARSING,this.stats=a.stats;var c=this.tracks[this.trackId],d=c.details,e=d.totalduration,f=b.start,g=b.level,h=b.sn,i=this.config.defaultAudioCodec||c.audioCodec;this.pendingAppending=0,this.demuxer||(this.demuxer=new n["default"](this.hls,"audio")),x.logger.log("Demuxing "+h+" of ["+d.startSN+" ,"+d.endSN+"],track "+g),this.demuxer.push(a.payload,i,null,f,b.cc,g,h,e,b.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent;if(b&&"audio"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING){var c=a.tracks,d=void 0;if(d=c.audio){d.levelCodec="mp4a.40.2",d.id=a.id,this.hls.trigger(p["default"].BUFFER_CODECS,c),x.logger.log("audio track:audio,container:"+d.container+",codecs[level/parsed]=["+d.levelCodec+"/"+d.codec+"]");var e=d.initSegment;e&&(this.pendingAppending++,this.hls.trigger(p["default"].BUFFER_APPENDING,{type:"audio",data:e,parent:"audio",content:"initSegment"})),this.tick()}}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent;if(c&&"audio"===a.id&&a.sn===c.sn&&a.level===c.level&&this.state===y.PARSING){var d=this.tracks[this.trackId],e=this.fragCurrent;x.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),t["default"].updateFragPTSDTS(d.details,e.sn,a.startPTS,a.endPTS),[a.data1,a.data2].forEach(function(c){c&&(b.pendingAppending++,b.hls.trigger(p["default"].BUFFER_APPENDING,{type:a.type,data:c,parent:"audio",content:"data"}))}),this.nextLoadPosition=a.endPTS,this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent;b&&"audio"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if("audio"===a.parent)switch(this.state){case y.PARSING:case y.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===y.PARSED&&0===this.pendingAppending){var a=this.fragCurrent,b=this.stats;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var c=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("audio buffered : "+v["default"].toString(c.buffered)),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);x.logger.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(p["default"].ERROR,a),this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case w.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==y.ERROR&&(this.state=a.fatal?y.ERROR:y.IDLE,x.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null,this.tick()}}]),b}(r["default"]);c["default"]=z},{20:20,24:24,25:25,26:26,28:28,29:29,39:39,43:43,45:45}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(43),n=function(a){function b(a){return e(this,b),f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MANIFEST_LOADING,j["default"].MANIFEST_LOADED,j["default"].AUDIO_TRACK_LOADED))}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(j["default"].AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a["default"]?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(m.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(a){a.id<this.tracks.length&&(m.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("switching to audioTrack "+a);var b=this.tracks[a],c=b.type,d=b.url;this.hls.trigger(j["default"].AUDIO_TRACK_SWITCH,{id:a,type:c,url:d});var e=b.details;!d||void 0!==e&&e.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(j["default"].AUDIO_TRACK_LOADING,{url:d,id:a}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.trackId===a&&void 0!==this.tracks[a].details||this.setAudioTrackInternal(a)}}]),b}(l["default"]);c["default"]=n},{25:25,26:26,43:43}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(43),n=a(24),o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MEDIA_ATTACHING,j["default"].MEDIA_DETACHING,j["default"].MANIFEST_PARSED,j["default"].BUFFER_RESET,j["default"].BUFFER_APPENDING,j["default"].BUFFER_CODECS,j["default"].BUFFER_EOS,j["default"].BUFFER_FLUSHING,j["default"].LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onManifestParsed",value:function(a){var b=a.audio,c=a.video,d=0;(b||c)&&(d=(b?1:0)+(c?1:0),m.logger.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d}},{key:"onMediaAttaching",value:function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c)}}},{key:"onMediaDetaching",value:function(){m.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){m.logger.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(j["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){m.logger.log("media source opened"),this.hls.trigger(j["default"].MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var a=this.pendingTracks,b=Object.keys(a).length;!b||this.sourceBufferNb!==b&&0!==this.sourceBufferNb||(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){m.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){m.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1,this.hls.trigger(j["default"].BUFFER_APPENDED,{parent:this.parent}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(a){m.logger.error("sourceBuffer error:"+a),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;m.logger.log("creating sourceBuffer with mimeType:"+g);try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),e.buffer=h}catch(i){m.logger.error("error while trying to add sourceBuffer:"+i.message),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:i,mimeType:g})}}this.hls.trigger(j["default"].BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())}},{key:"onBufferAppendFail",value:function(a){m.logger.error("sourceBuffer error:"+a.event),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,m.logger.log(d+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){if(!a[c].ended)return;if(a[c].updating)return void(this._needsEos=!0)}m.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),b.endOfStream(),this._needsEos=!1}},{key:"onBufferFlushing",value:function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){if(null!==this._levelDuration){var a=this.media,b=this.mediaSource,c=this.sourceBuffer;if(a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(var d in c)if(c[d].updating)return;null===this._msDuration&&(this._msDuration=b.duration),this._levelDuration>this._msDuration&&(m.logger.log("Updating mediasource duration to "+this._levelDuration),b.duration=this._levelDuration,this._msDuration=this._levelDuration)}}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;for(var d in c)b+=c[d].buffered.length;this.appended=b,this.hls.trigger(j["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void m.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type;b[e]?(b[e].ended=!1,this.parent=d.parent,b[e].appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(f){m.logger.error("error while trying to append buffer:"+f.message),c.unshift(d);var g={type:n.ErrorTypes.MEDIA_ERROR};if(22===f.code)return this.segments=[],g.details=n.ErrorDetails.BUFFER_FULL_ERROR,void a.trigger(j["default"].ERROR,g);if(this.appendError?this.appendError++:this.appendError=1,g.details=n.ErrorDetails.BUFFER_APPEND_ERROR,g.frag=this.fragCurrent,this.appendError>a.config.appendErrorMaxRetry)return m.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],g.fatal=!0,void a.trigger(j["default"].ERROR,g);g.fatal=!1,a.trigger(j["default"].ERROR,g)}}}}},{key:"flushBuffer",value:function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(m.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return m.logger.warn("cannot flush, sb updating in progress"),!1;for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,m.logger.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}}else m.logger.warn("abort flushing too many retries");m.logger.log("buffer flushed")}return!0}}]),b}(l["default"]);c["default"]=o},{24:24,25:25,26:26,43:43}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=function(a){function b(a){return e(this,b),f(this,Object.getPrototypeOf(b).call(this,a,j["default"].FPS_DROP_LEVEL_CAPPING,j["default"].MEDIA_ATTACHING,j["default"].MANIFEST_PARSED))}return g(b,a),h(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(a){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(a.droppedLevel)||this.restrictedLevels.push(a.droppedLevel)}},{key:"onMediaAttaching",value:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null}},{key:"onManifestParsed",value:function(a){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,this.hls.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var a=this.levels?this.levels.length:0;a&&(this.hls.autoLevelCapping=this.getMaxLevel(a-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(a){var b=0,c=void 0,d=void 0,e=this.mediaWidth,f=this.mediaHeight,g=0,h=0;for(c=0;c<=a&&(d=this.levels[c],!this.isLevelRestricted(c))&&(b=c,g=d.width,h=d.height,!(e<=g||f<=h));c++);return b}},{key:"isLevelRestricted",value:function(a){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(a)===-1)}},{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a}},{key:"mediaWidth",get:function(){var a=void 0;return this.media&&(a=this.media.width||this.media.clientWidth||this.media.offsetWidth,a*=this.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0;return this.media&&(a=this.media.height||this.media.clientHeight||this.media.offsetHeight,a*=this.contentScaleFactor),a}}]),b}(l["default"]);c["default"]=m},{25:25,26:26}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(42),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.hls=b,this.defaultEstimate_=f,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new h["default"](c),this.fast_=new h["default"](d)}return f(a,[{key:"sample",value:function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)}},{key:"canEstimate",value:function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}();c["default"]=i},{42:42}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(43),n=function(a){function b(a){return e(this,b),f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MEDIA_ATTACHING))}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(a){this.hls.config.capLevelOnFPSDrop&&(this.video=a.media instanceof HTMLVideoElement?a.media:null,"function"==typeof this.video.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),this.hls.config.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e;if(this.hls.trigger(j["default"].FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>this.hls.config.fpsDroppedMonitoringThreshold*g){var i=this.hls.currentLevel;m.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(this.hls.autoLevelCapping===-1||this.hls.autoLevelCapping>=i)&&(i-=1,this.hls.trigger(j["default"].FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:this.hls.currentLevel}),this.hls.autoLevelCapping=i,this.hls.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}}},{key:"checkFPSInterval",value:function(){if(this.video)if(this.isVideoPlaybackQualityAvailable){var a=this.video.getVideoPlaybackQuality();this.checkFPS(this.video,a.totalVideoFrames,a.droppedVideoFrames)}else this.checkFPS(this.video,this.video.webkitDecodedFrameCount,this.video.webkitDroppedFrameCount)}}]),b}(l["default"]);c["default"]=n},{25:25,26:26,43:43}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(43),n=a(24),o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MANIFEST_LOADED,j["default"].LEVEL_LOADED,j["default"].ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=c._autoLevelCapping=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(a){var b,c,d=[],e=[],f={},g=!1,h=!1,i=this.hls;if(a.levels.forEach(function(a){a.videoCodec&&(g=!0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(h=!0);var b=f[a.bitrate];void 0===b?(f[a.bitrate]=d.length,a.url=[a.url],a.urlId=0,d.push(a)):d[b].url.push(a.url)}),g&&h?d.forEach(function(a){a.videoCodec&&e.push(a)}):e=d,e=e.filter(function(a){var b=function(a){return MediaSource.isTypeSupported("audio/mp4;codecs="+a)},c=function(a){return MediaSource.isTypeSupported("video/mp4;codecs="+a)},d=a.audioCodec,e=a.videoCodec;return(!d||b(d))&&(!e||c(e))}),e.length){for(b=e[0].bitrate,e.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=e,c=0;c<e.length;c++)if(e[c].bitrate===b){this._firstLevel=c,m.logger.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+b);break}i.trigger(j["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:a.stats,audio:h,video:g})}else i.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(a){var b=this._levels;if(a>=0&&a<b.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level=a,m.logger.log("switching to level "+a),this.hls.trigger(j["default"].LEVEL_SWITCH,{level:a});var c=b[a],d=c.details;if(!d||d.live===!0&&performance.now()-d.tload>1e3){m.logger.log("(re)loading playlist for level "+a);var e=c.urlId;this.hls.trigger(j["default"].LEVEL_LOADING,{url:c.url[e],level:a,id:e})}}else this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(a){if(!a.fatal){var b=a.details,c=this.hls,d=void 0,e=void 0,f=!1;switch(b){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:d=a.frag.level;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=a.context.level,f=!0}if(void 0!==d)if(e=this._levels[d],e.urlId<e.url.length-1)e.urlId++,e.details=void 0,m.logger.warn("level controller,"+b+" for level "+d+": switching to redundant stream id "+e.urlId);else{
var g=this._manualLevel===-1&&d;g?(m.logger.warn("level controller,"+b+": emergency switch-down for next fragment"),c.abrController.nextAutoLevel=0):e&&e.details&&e.details.live?(m.logger.warn("level controller,"+b+" on live stream, discard"),f&&(this._level=void 0)):b!==n.ErrorDetails.FRAG_LOAD_ERROR&&b!==n.ErrorDetails.FRAG_LOAD_TIMEOUT&&b!==n.ErrorDetails.FRAG_LOOP_LOADING_ERROR&&(m.logger.error("cannot recover "+b+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),a.fatal=!0,c.trigger(j["default"].ERROR,a))}}}},{key:"onLevelLoaded",value:function(a){if(a.level===this._level){var b=a.details;if(b.live){var c=1e3*(b.averagetargetduration?b.averagetargetduration:b.targetduration),d=this._levels[a.level],e=d.details;e&&b.endSN===e.endSN&&(c/=2,m.logger.log("same live playlist, reload twice faster")),c-=performance.now()-a.stats.trequest,c=Math.max(1e3,Math.round(c)),m.logger.log("live playlist, reload in "+c+" ms"),this.timer=setTimeout(this.ontick,c)}else this.timer=null}}},{key:"tick",value:function(){var a=this._level;if(void 0!==a&&this.canload){var b=this._levels[a],c=b.urlId;this.hls.trigger(j["default"].LEVEL_LOADING,{url:b.url[c],level:a,id:c})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&b.length>a&&(this._level===a&&void 0!==b[a].details||this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(a){this.level=a,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=a)}}]),b}(l["default"]);c["default"]=o},{24:24,25:25,26:26,43:43}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(39),j=d(i),k=a(28),l=d(k),m=a(20),n=d(m),o=a(26),p=d(o),q=a(25),r=d(q),s=a(29),t=d(s),u=a(45),v=d(u),w=a(24),x=a(43),y={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,p["default"].MEDIA_ATTACHED,p["default"].MEDIA_DETACHING,p["default"].MANIFEST_LOADING,p["default"].MANIFEST_PARSED,p["default"].LEVEL_LOADED,p["default"].KEY_LOADED,p["default"].FRAG_LOADED,p["default"].FRAG_LOAD_EMERGENCY_ABORTED,p["default"].FRAG_PARSING_INIT_SEGMENT,p["default"].FRAG_PARSING_DATA,p["default"].FRAG_PARSED,p["default"].ERROR,p["default"].AUDIO_TRACK_SWITCH,p["default"].BUFFER_CREATED,p["default"].BUFFER_APPENDED,p["default"].BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r["default"].prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var b=this.media,c=this.lastCurrentTime;this.stopLoad(),this.demuxer=new n["default"](this.hls,"main"),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,b&&c>0?(x.logger.log("configure startPosition @"+c),this.lastPaused||(x.logger.log("resuming video"),b.play())):this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=this.startFragRequested?y.IDLE:y.STARTING,this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else x.logger.warn("cannot start loading as manifest not parsed yet"),this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case y.STARTING:var a=this.hls,b=a.startLevel;b===-1&&(b=0,this.fragBitrateTest=!0),this.level=a.nextLoadLevel=b,this.state=y.WAITING_LEVEL,this.loadedmetadata=!1;break;case y.IDLE:if(!this._doTickIdle())return;break;case y.WAITING_LEVEL:var c=this.levels[this.level];c&&c.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var d=performance.now(),e=this.retryDate;(!e||d>=e||this.media&&this.media.seeking)&&(x.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.PAUSED:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var a=this.hls,b=a.config,c=this.media;if(!c&&(this.startFragRequested||!b.startFragPrefetch))return!0;var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=void 0;f=this.levels[e].hasOwnProperty("bitrate")?Math.max(8*b.maxBufferSize/this.levels[e].bitrate,b.maxBufferLength):b.maxBufferLength,f=Math.min(f,b.maxMaxBufferLength);var g=l["default"].bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),h=g.len;if(h>=f)return!0;x.logger.trace("buffer length of "+h.toFixed(3)+" is below max of "+f.toFixed(3)+". checking for more payload ..."),a.nextLoadLevel=e,this.level=e;var i=this.levels[e].details;if("undefined"==typeof i||i.live&&this.levelLastLoaded!==e)return this.state=y.WAITING_LEVEL,!0;var j=this.fragPrevious;if(!i.live&&j&&j.sn===i.endSN&&(!c.seeking||c.duration-g.end<=j.duration/2)){var k={};return this.altAudio&&(k.type="video"),this.hls.trigger(p["default"].BUFFER_EOS,k),this.state=y.ENDED,!0}return this._fetchPayloadOrEos({pos:d,bufferInfo:g,levelDetails:i})}},{key:"_fetchPayloadOrEos",value:function(a){var b=a.pos,c=a.bufferInfo,d=a.levelDetails,e=this.fragPrevious,f=this.level,g=d.fragments,h=g.length;if(0===h)return!1;var i=g[0].start,j=g[h-1].start+g[h-1].duration,k=c.end,l=void 0;if(d.live){if(l=this._ensureFragmentAtLivePoint({levelDetails:d,bufferEnd:k,start:i,end:j,fragPrevious:e,fragments:g,fragLen:h}),null===l)return!1}else k<i&&(l=g[0]);return l||(l=this._findFragment({start:i,fragPrevious:e,fragLen:h,fragments:g,bufferEnd:k,end:j,levelDetails:d})),!l||this._loadFragmentOrKey({frag:l,level:f,levelDetails:d,pos:b,bufferEnd:k})}},{key:"_ensureFragmentAtLivePoint",value:function(a){var b=a.levelDetails,c=a.bufferEnd,d=a.start,e=a.end,f=a.fragPrevious,g=a.fragments,h=a.fragLen,i=this.hls.config,j=this.media,k=void 0,l=void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*b.targetduration;if(c<Math.max(d,e-l)){var m=this.liveSyncPosition=this.computeLivePosition(d,b);x.logger.log("buffer end: "+c+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),c=m,j&&j.readyState&&j.duration>m&&(j.currentTime=m)}if(b.PTSKnown&&c>e&&j&&j.readyState)return null;if(this.startFragRequested&&!b.PTSKnown){if(f){var n=f.sn+1;n>=b.startSN&&n<=b.endSN&&(k=g[n-b.startSN],x.logger.log("live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=g[Math.min(h-1,Math.round(h/2))],x.logger.log("live playlist, switching playlist, unknown, load middle frag : "+k.sn))}return k}},{key:"_findFragment",value:function(a){var b=a.start,c=a.fragPrevious,d=a.fragLen,e=a.fragments,f=a.bufferEnd,g=a.end,h=a.levelDetails,i=this.hls.config,k=void 0,l=void 0,m=i.maxFragLookUpTolerance;if(f<g?(f>g-m&&(m=0),l=j["default"].search(e,function(a){return a.start+a.duration-m<=f?1:a.start-m>f&&a.start?-1:0})):l=e[d-1],l&&(k=l,b=l.start,c&&k.level===c.level&&k.sn===c.sn))if(k.sn<h.endSN){var n=c.deltaPTS,o=k.sn-h.startSN;n&&n>i.maxBufferHole&&c.dropped&&o?(k=e[o-1],x.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),c.loadCounter--):(k=e[o+1],x.logger.log("SN just loaded, load next one: "+k.sn))}else k=null;return k}},{key:"_loadFragmentOrKey",value:function(a){var b=a.frag,c=a.level,d=a.levelDetails,e=a.pos,f=a.bufferEnd,g=this.hls,h=g.config;if(null==b.decryptdata.uri||null!=b.decryptdata.key){if(x.logger.log("Loading "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c+", currentTime:"+e+",bufferEnd:"+f.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,b.loadCounter){b.loadCounter++;var i=h.fragLoadingLoopThreshold;if(b.loadCounter>i&&Math.abs(this.fragLoadIdx-b.loadIdx)<i)return g.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:b}),!1}else b.loadCounter=1;return b.loadIdx=this.fragLoadIdx,this.fragCurrent=b,this.startFragRequested=!0,b.autoLevel=g.autoLevelEnabled,b.bitrateTest=this.fragBitrateTest,g.trigger(p["default"].FRAG_LOADING,{frag:b}),this.state=y.FRAG_LOADING,!0}x.logger.log("Loading key for "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c),this.state=y.KEY_LOADING,g.trigger(p["default"].KEY_LOADING,{frag:b})}},{key:"getBufferRange",value:function(a){var b,c,d=this.bufferRange;if(d)for(b=d.length-1;b>=0;b--)if(c=d[b],a>=c.start&&a<=c.end)return c;return null}},{key:"followingBufferRange",value:function(a){return a?this.getBufferRange(a.end+.5):null}},{key:"isBuffered",value:function(a){var b=this.media;if(b)for(var c=b.buffered,d=0;d<c.length;d++)if(a>=c.start(d)&&a<=c.end(d))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),this.isBuffered(b)?a=this.getBufferRange(b):this.isBuffered(b+.1)&&(a=this.getBufferRange(b+.1)),a)){var d=a.frag;d!==this.fragPlaying&&(this.fragPlaying=d,this.hls.trigger(p["default"].FRAG_CHANGED,{frag:d}))}}},{key:"immediateLevelSwitch",value:function(){if(x.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.state=y.PAUSED,this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,this.isBuffered(a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,c=this.getBufferRange(a.currentTime),c&&c.start>1&&(this.state=y.PAUSED,this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:c.start-1})),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferRange(a.currentTime+b),d&&(d=this.followingBufferRange(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.state=y.PAUSED,this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:d.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,b=a?a.currentTime:void 0;if(x.logger.log("media seeking to "+b),this.state===y.FRAG_LOADING){var c=l["default"].bufferInfo(a,b,this.config.maxBufferHole),d=this.fragCurrent;if(0===c.len&&d){var e=this.config.maxFragLookUpTolerance,f=d.start-e,g=d.start+d.duration+e;b<f||b>g?(d.loader&&(x.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):x.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===y.ENDED&&(this.state=y.IDLE);a&&(this.lastCurrentTime=b),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){x.logger.log("media seeked to "+this.media.currentTime),this.tick()}},{key:"onMediaEnded",value:function(){x.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){x.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p["default"].BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(b.indexOf("mp4a.40.2")!==-1&&(c=!0),b.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&x.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var e=this.config;e.autoStartLoad&&this.hls.startLoad(e.startPosition)}},{key:"onLevelLoaded",value:function(a){var b=a.details,c=a.level,d=this.levels[c],e=b.totalduration,f=0;if(x.logger.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),this.levelLastLoaded=c,b.live){var g=d.details;g&&b.fragments.length>0?(t["default"].mergeDetails(g,b),f=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(f,g),b.PTSKnown?x.logger.log("live playlist sliding:"+f.toFixed(3)):x.logger.log("live playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,this.hls.trigger(p["default"].LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var h=b.startTimeOffset;isNaN(h)?b.live?(this.startPosition=this.computeLivePosition(f,b),x.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(h<0&&(x.logger.log("negative start time offset "+h+", count from end of last fragment"),h=f+e+h),x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats;if(x.logger.log("Loaded  "+b.sn+" of level "+b.level),this.fragBitrateTest=!1,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=y.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=y.PARSING,this.stats=d;var e=this.levels[this.level],f=e.details,g=f.totalduration,h=void 0!==b.startDTS?b.startDTS:b.start,i=b.level,j=b.sn,k=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),void 0===k&&(k=this.lastAudioCodec),k&&(k=k.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,x.logger.log("Demuxing "+j+" of ["+f.startSN+" ,"+f.endSN+"],level "+i+", cc "+b.cc);var l=this.demuxer;l||(l=this.demuxer=new n["default"](this.hls,"main")),l.push(a.payload,k,e.videoCodec,h,b.cc,i,j,g,b.decryptdata)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent;if(b&&"main"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING){var c,d,e=a.tracks;if(e.audio&&this.altAudio&&delete e.audio,d=e.audio){var f=this.levels[this.level].audioCodec,g=navigator.userAgent.toLowerCase();f&&this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),f=f.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==d.metadata.channelCount&&g.indexOf("firefox")===-1&&(f="mp4a.40.5"),g.indexOf("android")!==-1&&(f="mp4a.40.2",x.logger.log("Android: force audio codec to"+f)),d.levelCodec=f,d.id=a.id}if(d=e.video,d&&(d.levelCodec=this.levels[this.level].videoCodec,d.id=a.id),a.unique){var h={codec:"",levelCodec:""};for(c in a.tracks)d=e[c],h.container=d.container,h.codec&&(h.codec+=",",h.levelCodec+=","),d.codec&&(h.codec+=d.codec),d.levelCodec&&(h.levelCodec+=d.levelCodec);e={audiovideo:h}}this.hls.trigger(p["default"].BUFFER_CODECS,e);for(c in e){d=e[c],x.logger.log("main track:"+c+",container:"+d.container+",codecs[level/parsed]=["+d.levelCodec+"/"+d.codec+"]");var i=d.initSegment;i&&(this.pendingAppending++,this.hls.trigger(p["default"].BUFFER_APPENDING,{type:c,data:i,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent;if(c&&"main"===a.id&&a.sn===c.sn&&a.level===c.level&&("audio"!==a.type||"AUDIO"!==this.audioTrackType)&&this.state===y.PARSING){var d=this.levels[this.level],e=this.fragCurrent;x.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0));var f=t["default"].updateFragPTSDTS(d.details,e.sn,a.startPTS,a.endPTS,a.startDTS,a.endDTS),g=this.hls;g.trigger(p["default"].LEVEL_PTS_UPDATED,{details:d.details,level:this.level,drift:f}),"video"===a.type&&(e.dropped=a.dropped),[a.data1,a.data2].forEach(function(c){c&&(b.pendingAppending++,g.trigger(p["default"].BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.nextLoadPosition=a.endPTS,this.bufferRange.push({type:a.type,start:a.startPTS,end:a.endPTS,frag:e}),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent;b&&"main"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitch",value:function(a){var b=!!a.url;if(b)this.videoBuffer&&this.mediaBuffer!==this.videoBuffer&&(x.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=this.videoBuffer);else if(this.mediaBuffer!==this.media){x.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var c=this.fragCurrent;c.loader&&(x.logger.log("switching to main audio track, cancel main fragment load"),c.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE}this.altAudio=b}},{key:"onBufferCreated",value:function(a){var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(x.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if("main"===a.parent)switch(this.state){case y.PARSING:case y.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===y.PARSED&&0===this.pendingAppending){var a=this.fragCurrent,b=this.stats;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*b.total/(b.tbuffered-b.tfirst)),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"main"});var c=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("main buffered : "+v["default"].toString(c.buffered)),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=this.media,d=c&&this.isBuffered(c.currentTime)&&this.isBuffered(c.currentTime+.4);switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var e=this.fragLoadError;e?e++:e=1;var f=this.config;if(e<=f.fragLoadingMaxRetry||d){this.fragLoadError=e,b.loadCounter=0;var g=Math.min(Math.pow(2,e-1)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);x.logger.warn("mediaController: frag loading failed, retry in "+g+" ms"),this.retryDate=performance.now()+g,this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(p["default"].ERROR,a),this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(d?(this._reduceMaxMaxBufferLength(b.duration),this.state=y.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.hls.trigger(p["default"].ERROR,a),this.state=y.ERROR));break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==y.ERROR&&(this.state=a.fatal?y.ERROR:y.IDLE,x.logger.warn("mediaController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case w.ErrorDetails.BUFFER_FULL_ERROR:this.state!==y.PARSING&&this.state!==y.PARSED||(d?(this._reduceMaxMaxBufferLength(b.duration),this.state=y.IDLE):(x.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.state=y.PAUSED,this.hls.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})))}}}},{key:"_reduceMaxMaxBufferLength",value:function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,x.logger.warn("reduce max buffer length to "+b.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*b.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var a=this.media;if(a&&a.readyState){var b=a.currentTime,c=a.buffered;if(!this.loadedmetadata&&c.length){this.loadedmetadata=!0;var d=this.startPosition,e=this.isBuffered(d);b===d&&e||(x.logger.log("target start position:"+d),e||(d=c.start(0),x.logger.log("target start position not buffered, seek to buffered.start(0) "+d)),x.logger.log("adjust currentTime from "+b+" to "+d),a.currentTime=d)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var f=l["default"].bufferInfo(a,b,0),g=!(a.paused||a.ended||0===a.buffered.length),h=.4,i=b>a.playbackRate*this.lastCurrentTime;if(this.stalled&&i&&(this.stalled=!1,x.logger.log("playback not stuck anymore @"+b)),g&&f.len<=h&&(i?(h=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,x.logger.log("playback seems stuck @"+b),this.hls.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),f.len<=h)){var j=f.nextStart,k=j-b;if(j&&k<this.config.maxSeekHole&&k>0){x.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+j+" + nudge "+this.seekHoleNudgeDuration);var m=j+this.seekHoleNudgeDuration-a.currentTime;a.currentTime=j+this.seekHoleNudgeDuration,this.hls.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:m})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1),this.tick()}},{key:"onBufferFlushed",value:function(){var a,b,c=[];for(b=0;b<this.bufferRange.length;b++)a=this.bufferRange[b],this.isBuffered((a.start+a.end)/2)&&c.push(a);this.bufferRange=c,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("engine state transition from "+b+" to "+a),this.hls.trigger(p["default"].STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){if(this.media){var a=this.getBufferRange(this.media.currentTime);if(a)return a.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferRange;return a?a.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(r["default"]);c["default"]=z},{20:20,24:24,25:25,26:26,28:28,29:29,39:39,43:43,45:45}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(40),n=d(m),o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MEDIA_ATTACHING,j["default"].MEDIA_DETACHING,j["default"].FRAG_PARSING_USERDATA,j["default"].MANIFEST_LOADING,j["default"].FRAG_LOADED,j["default"].LEVEL_SWITCH));if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.config.enableCEA708Captions){var d=c,g={newCue:function(a,b,c){if(!d.textTrack1){var e=d.getExistingTrack("1");if(e){d.textTrack1=e,d.clearCurrentCues(d.textTrack1);var f=new window.Event("addtrack");f.track=d.textTrack1,d.media.dispatchEvent(f)}else d.textTrack1=d.createTextTrack("captions","English","en"),d.textTrack1.textTrack1=!0}d.Cues.newCue(d.textTrack1,a,b,c)}},h={newCue:function(a,b,c){if(!d.textTrack2){var e=d.getExistingTrack("2");if(e){d.textTrack2=e,d.clearCurrentCues(d.textTrack2);var f=new window.Event("addtrack");f.track=d.textTrack2,d.media.dispatchEvent(f)}else d.textTrack2=d.createTextTrack("captions","Spanish","es"),d.textTrack2.textTrack2=!0}d.Cues.newCue(d.textTrack2,a,b,c)}};c.cea608Parser=new n["default"](0,g,h)}return c}return g(b,a),h(b,[{key:"clearCurrentCues",value:function(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}},{key:"getExistingTrack",value:function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null}},{key:"createTextTrack",value:function(a,b,c){if(this.media)return this.media.addTextTrack(a,b,c)}},{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(a){this.media=a.media}},{key:"onMediaDetaching",value:function(){}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(a){if("main"===a.frag.type){var b=a.frag.start;b<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=b}}},{key:"onFragParsingUserdata",value:function(a){if(this.enabled)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}}},{key:"extractCea608Data",value:function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;j<g;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,0===c&&0===d||e&&0===f&&(i.push(c),i.push(d));return i}}]),b}(l["default"]);c["default"]=o},{25:25,26:26,40:40}],13:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var c,e,f,g,h,i=this._tables[0][4],j=this._tables[1],k=b.length,l=1;if(4!==k&&6!==k&&8!==k)throw new Error("Invalid aes key size="+k);for(g=b.slice(0),h=[],this._key=[g,h],c=k;c<4*k+28;c++)f=g[c-1],(c%k===0||8===k&&c%k===4)&&(f=i[f>>>24]<<24^i[f>>16&255]<<16^i[f>>8&255]<<8^i[255&f],c%k===0&&(f=f<<8^f>>>24^l<<24,l=l<<1^283*(l>>7))),g[c]=g[c-k]^f;for(e=0;c;e++,c--)f=g[3&e?c:c-4],c<=4||e<4?h[e]=f:h[e]=j[0][i[f>>>24]]^j[1][i[f>>16&255]]^j[2][i[f>>8&255]]^j[3][i[255&f]]}return e(a,[{key:"_precompute",value:function(){var a,b,c,d,e,f,g,h,i,j=this._tables[0],k=this._tables[1],l=j[4],m=k[4],n=[],o=[];for(a=0;a<256;a++)o[(n[a]=a<<1^283*(a>>7))^a]=a;for(b=c=0;!l[b];b^=d||1,c=o[c]||1)for(g=c^c<<1^c<<2^c<<3^c<<4,g=g>>8^255&g^99,l[b]=g,m[g]=b,f=n[e=n[d=n[b]]],i=16843009*f^65537*e^257*d^16843008*b,h=257*n[g]^16843008*g,a=0;a<4;a++)j[a][b]=h=h<<24^h>>>8,k[a][g]=i=i<<24^i>>>8;for(a=0;a<5;a++)j[a]=j[a].slice(0),k[a]=k[a].slice(0)}},{key:"decrypt",value:function(a,b,c,d,e,f){var g,h,i,j,k=this._key[1],l=a^k[0],m=d^k[1],n=c^k[2],o=b^k[3],p=k.length/4-2,q=4,r=this._tables[1],s=r[0],t=r[1],u=r[2],v=r[3],w=r[4];for(j=0;j<p;j++)g=s[l>>>24]^t[m>>16&255]^u[n>>8&255]^v[255&o]^k[q],h=s[m>>>24]^t[n>>16&255]^u[o>>8&255]^v[255&l]^k[q+1],
i=s[n>>>24]^t[o>>16&255]^u[l>>8&255]^v[255&m]^k[q+2],o=s[o>>>24]^t[l>>16&255]^u[m>>8&255]^v[255&n]^k[q+3],q+=4,l=g,m=h,n=i;for(j=0;j<4;j++)e[(3&-j)+f]=w[l>>>24]<<24^w[m>>16&255]<<16^w[n>>8&255]<<8^w[255&o]^k[q++],g=l,l=m,m=n,n=o,o=g}}]),a}();c["default"]=f},{}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(13),h=d(g),i=function(){function a(b,c){e(this,a),this.key=b,this.iv=c}return f(a,[{key:"ntoh",value:function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24}},{key:"doDecrypt",value:function(a,b,c){var d,e,f,g,i,j,k,l,m,n=new Int32Array(a.buffer,a.byteOffset,a.byteLength>>2),o=new h["default"](Array.prototype.slice.call(b)),p=new Uint8Array(a.byteLength),q=new Int32Array(p.buffer);for(d=~~c[0],e=~~c[1],f=~~c[2],g=~~c[3],m=0;m<n.length;m+=4)i=~~this.ntoh(n[m]),j=~~this.ntoh(n[m+1]),k=~~this.ntoh(n[m+2]),l=~~this.ntoh(n[m+3]),o.decrypt(i,j,k,l,q,m),q[m]=this.ntoh(q[m]^d),q[m+1]=this.ntoh(q[m+1]^e),q[m+2]=this.ntoh(q[m+2]^f),q[m+3]=this.ntoh(q[m+3]^g),d=i,e=j,f=k,g=l;return p}},{key:"localDecrypt",value:function(a,b,c,d){var e=this.doDecrypt(a,b,c);d.set(e,a.byteOffset)}},{key:"decrypt",value:function(a){var b=32e3,c=new Int32Array(a),d=new Uint8Array(a.byteLength),e=0,f=this.key,g=this.iv;for(this.localDecrypt(c.subarray(e,e+b),f,g,d),e=b;e<c.length;e+=b)g=new Uint32Array([this.ntoh(c[e-4]),this.ntoh(c[e-3]),this.ntoh(c[e-2]),this.ntoh(c[e-1])]),this.localDecrypt(c.subarray(e,e+b),f,g,d);return d}}]),a}();c["default"]=i},{13:13}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(14),h=d(g),i=a(24),j=a(43),k=function(){function a(b){e(this,a),this.hls=b;try{var c=window?window.crypto:crypto;this.subtle=c.subtle||c.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(d){this.disableWebCrypto=!0}}return f(a,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(a,b,c,d){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(a,b,c,d):this.decryptByWebCrypto(a,b,c,d)}},{key:"decryptByWebCrypto",value:function(a,b,c,d){var e=this;j.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",b,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(f){e.subtle.decrypt({name:"AES-CBC",iv:c.buffer},f,a).then(d)["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)})})["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)})}},{key:"decryptBySoftware",value:function(a,b,c,d){j.logger.log("decrypting by JavaScript Implementation");var e=new DataView(b.buffer),f=new Uint32Array([e.getUint32(0),e.getUint32(4),e.getUint32(8),e.getUint32(12)]);e=new DataView(c.buffer);var g=new Uint32Array([e.getUint32(0),e.getUint32(4),e.getUint32(8),e.getUint32(12)]),i=new h["default"](f,g);d(i.decrypt(a).buffer)}},{key:"onWebCryptoError",value:function(a,b,c,d,e){this.hls.config.enableSoftwareAES?(j.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(b,c,d,e)):(j.logger.error("decrypting error : "+a.message),this.hls.trigger(Event.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))}}]),a}();c["default"]=k},{14:14,24:24,43:43}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(17),h=d(g),i=a(43),j=a(22),k=d(j),l=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.id=c,this.remuxerClass=d,this.config=f,this.remuxer=new this.remuxerClass(b,c,f),this.insertDiscontinuity()}return f(a,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}},{key:"push",value:function(a,b,c,d,e,f,g,j){var l,m,n,o,p,q,r,s,t,u,v=new k["default"](a),w=90*v.timeStamp,x=!1;for(e!==this.lastCC?(i.logger.log(this.id+" discontinuity detected"),this.lastCC=e,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):f!==this.lastLevel?(i.logger.log("audio track switch detected"),this.lastLevel=f,this.remuxer.switchLevel(),this.insertDiscontinuity()):g===this.lastSN+1&&(x=!0),l=this._aacTrack,this.lastSN=g,this.lastLevel=f,q=v.length,t=a.length;q<t-1&&(255!==a[q]||240!==(240&a[q+1]));q++);for(l.audiosamplerate||(m=h["default"].getAudioConfig(this.observer,a,q,b),l.config=m.config,l.audiosamplerate=m.samplerate,l.channelCount=m.channelCount,l.codec=m.codec,l.duration=j,i.logger.log("parsed codec:"+l.codec+",rate:"+m.samplerate+",nb channel:"+m.channelCount)),p=0,o=9216e4/l.audiosamplerate;q+5<t&&(r=1&a[q+1]?7:9,n=(3&a[q+3])<<11|a[q+4]<<3|(224&a[q+5])>>>5,n-=r,n>0&&q+r+n<=t);)for(s=w+p*o,u={unit:a.subarray(q+r,q+r+n),pts:s,dts:s},l.samples.push(u),l.len+=n,q+=n+r,p++;q<t-1&&(255!==a[q]||240!==(240&a[q+1]));q++);this.remuxer.remux(f,g,this._aacTrack,{samples:[]},{samples:[{pts:w,dts:w,unit:v.payload}]},{samples:[]},d,x)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=new k["default"](a);if(d.hasTimeStamp)for(b=d.length,c=a.length;b<c-1;b++)if(255===a[b]&&240===(240&a[b+1]))return!0;return!1}}]),a}();c["default"]=l},{17:17,22:22,43:43}],17:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=a(24),h=function(){function a(){d(this,a)}return e(a,null,[{key:"getAudioConfig",value:function(a,b,c,d){var e,h,i,j,k,l=navigator.userAgent.toLowerCase(),m=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=((192&b[c+2])>>>6)+1,h=(60&b[c+2])>>>2,h>m.length-1?void a.trigger(Event.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}):(j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,f.logger.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+h+"["+m[h]+"Hz],channelConfig:"+j),/firefox|OPR/i.test(l)?h>=6?(e=5,k=new Array(4),i=h-3):(e=2,k=new Array(2),i=h):l.indexOf("android")!==-1?(e=2,k=new Array(2),i=h):(e=5,k=new Array(4),d&&(d.indexOf("mp4a.40.29")!==-1||d.indexOf("mp4a.40.5")!==-1)||!d&&h>=6?i=h-3:((d&&d.indexOf("mp4a.40.2")!==-1&&h>=6&&1===j||!d&&1===j)&&(e=2,k=new Array(2)),i=h)),k[0]=e<<3,k[0]|=(14&h)>>1,k[1]|=(1&h)<<7,k[1]|=j<<3,5===e&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:m[h],channelCount:j,codec:"mp4a.40."+e})}}]),a}();c["default"]=h},{24:24,43:43}],18:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(26),h=d(g),i=a(24),j=a(16),k=d(j),l=a(23),m=d(l),n=a(36),o=d(n),p=a(37),q=d(p),r=function(){function a(b,c,d){var f=arguments.length<=3||void 0===arguments[3]?null:arguments[3];e(this,a),this.hls=b,this.id=c,this.config=this.hls.config||f,this.typeSupported=d}return f(a,[{key:"destroy",value:function(){var a=this.demuxer;a&&a.destroy()}},{key:"push",value:function(a,b,c,d,e,f,g,j){var l=this.demuxer;if(!l){var n=this.hls,p=this.id;if(m["default"].probe(a))l=this.typeSupported.mp2t===!0?new m["default"](n,p,q["default"],this.config):new m["default"](n,p,o["default"],this.config);else{if(!k["default"].probe(a))return void n.trigger(h["default"].ERROR,{type:i.ErrorTypes.MEDIA_ERROR,id:p,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});l=new k["default"](n,p,o["default"],this.config)}this.demuxer=l}l.push(a,b,c,d,e,f,g,j)}}]),a}();c["default"]=r},{16:16,23:23,24:24,26:26,36:36,37:37}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a(18),f=d(e),g=a(26),h=d(g),i=a(43),j=a(1),k=d(j),l=function(a){var b=new k["default"];b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))},a.addEventListener("message",function(c){var d=c.data;switch(d.cmd){case"init":var e=JSON.parse(d.config);a.demuxer=new f["default"](b,d.id,d.typeSupported,e);try{(0,i.enableLogs)(e.debug)}catch(g){console.warn("demuxerWorker: unable to enable logs")}break;case"demux":a.demuxer.push(new Uint8Array(d.data),d.audioCodec,d.videoCodec,d.timeOffset,d.cc,d.level,d.sn,d.duration)}});var c=function(b,c){a.postMessage({event:b,data:c})};b.on(h["default"].FRAG_PARSING_INIT_SEGMENT,c),b.on(h["default"].FRAG_PARSED,c),b.on(h["default"].ERROR,c),b.on(h["default"].FRAG_PARSING_METADATA,c),b.on(h["default"].FRAG_PARSING_USERDATA,c),b.on(h["default"].FRAG_PARSING_DATA,function(b,c){var d=c.data1.buffer,e=c.data2.buffer;delete c.data1,delete c.data2,a.postMessage({event:b,data:c,data1:d,data2:e},[d,e])})};c["default"]=l},{1:1,18:18,26:26,43:43}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(26),h=d(g),i=a(18),j=d(i),k=a(19),l=d(k),m=a(43),n=a(15),o=d(n),p=a(24),q=function(){function b(c,d){e(this,b),this.hls=c,this.id=d;var f={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:c.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(c.config.enableWorker&&"undefined"!=typeof Worker){m.logger.log("demuxing in webworker");try{var g=a(2),i=this.w=g(l["default"]);this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(a){c.trigger(h["default"].ERROR,{type:p.ErrorTypes.OTHER_ERROR,details:p.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},i.postMessage({cmd:"init",typeSupported:f,id:d,config:JSON.stringify(c.config)})}catch(k){m.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new j["default"](c,d,f)}}else this.demuxer=new j["default"](c,d,f);this.demuxInitialized=!0}return f(b,[{key:"destroy",value:function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.decrypter;c&&(c.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(a,b,c,d,e,f,g,h){var i=this.w;if(i)i.postMessage({cmd:"demux",data:a,audioCodec:b,videoCodec:c,timeOffset:d,cc:e,level:f,sn:g,duration:h},[a]);else{var j=this.demuxer;j&&j.push(new Uint8Array(a),b,c,d,e,f,g,h)}}},{key:"push",value:function(a,b,c,d,e,f,g,h,i){if(a.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){null==this.decrypter&&(this.decrypter=new o["default"](this.hls));var j=this;this.decrypter.decrypt(a,i.key,i.iv,function(a){j.pushDecrypted(a,b,c,d,e,f,g,h)})}else this.pushDecrypted(a,b,c,d,e,f,g,h)}},{key:"onWorkerMessage",value:function(a){var b=a.data,c=this.hls;switch(b.event){case h["default"].FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data.data2=new Uint8Array(b.data2);default:c.trigger(b.event,b.data)}}}]),b}();c["default"]=q},{15:15,18:18,19:19,2:2,24:24,26:26,43:43}],21:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=function(){function a(b){d(this,a),this.data=b,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return e(a,[{key:"loadWord",value:function(){var a=this.data.byteLength-this.bytesAvailable,b=new Uint8Array(4),c=Math.min(4,this.bytesAvailable);if(0===c)throw new Error("no bytes available");b.set(this.data.subarray(a,a+c)),this.word=new DataView(b.buffer).getUint32(0),this.bitsAvailable=8*c,this.bytesAvailable-=c}},{key:"skipBits",value:function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)}},{key:"readBits",value:function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&f.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c}},{key:"skipLZ",value:function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var a=this.skipLZ();return this.readBits(a+1)-1}},{key:"readEG",value:function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var b,c,d=8,e=8;for(b=0;b<a;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e}},{key:"readSPS",value:function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=1;if(this.readUByte(),a=this.readUByte(),b=this.readBits(5),this.skipBits(3),c=this.readUByte(),this.skipUEG(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var o=this.readUEG();if(3===o&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(h=3!==o?8:12,i=0;i<h;i++)this.readBoolean()&&(i<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var p=this.readUEG();if(0===p)this.readUEG();else if(1===p)for(this.skipBits(1),this.skipEG(),this.skipEG(),d=this.readUEG(),i=0;i<d;i++)this.skipEG();if(this.skipUEG(),this.skipBits(1),e=this.readUEG(),f=this.readUEG(),g=this.readBits(1),0===g&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(j=this.readUEG(),k=this.readUEG(),l=this.readUEG(),m=this.readUEG()),this.readBoolean()&&this.readBoolean()){var q=void 0,r=this.readUByte();switch(r){case 1:q=[1,1];break;case 2:q=[12,11];break;case 3:q=[10,11];break;case 4:q=[16,11];break;case 5:q=[40,33];break;case 6:q=[24,11];break;case 7:q=[20,11];break;case 8:q=[32,11];break;case 9:q=[80,33];break;case 10:q=[18,11];break;case 11:q=[15,11];break;case 12:q=[64,33];break;case 13:q=[160,99];break;case 14:q=[4,3];break;case 15:q=[3,2];break;case 16:q=[2,1];break;case 255:q=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}q&&(n=q[0]/q[1])}return{width:Math.ceil((16*(e+1)-2*j-2*k)*n),height:(2-g)*(f+1)*16-(g?2:4)*(l+m)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}();c["default"]=g},{43:43}],22:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=function(){function a(b){d(this,a),this._hasTimeStamp=!1;for(var c,e,g,h,i,j,k,l,m=0;;)if(k=this.readUTF(b,m,3),m+=3,"ID3"===k)m+=3,c=127&b[m++],e=127&b[m++],g=127&b[m++],h=127&b[m++],i=(c<<21)+(e<<14)+(g<<7)+h,j=m+i,this._parseID3Frames(b,m,j),m=j;else{if("3DI"!==k)return m-=3,l=m,void(l&&(this.hasTimeStamp||f.logger.warn("ID3 tag found, but no timestamp"),this._length=l,this._payload=b.subarray(0,l)));m+=7,f.logger.log("3DI footer found, end: "+m)}}return e(a,[{key:"readUTF",value:function(a,b,c){var d="",e=b,f=b+c;do d+=String.fromCharCode(a[e++]);while(e<f);return d}},{key:"_parseID3Frames",value:function(a,b,c){for(var d,e,g,h,i;b+8<=c;)switch(d=this.readUTF(a,b,4),b+=4,e=a[b++]<<24+a[b++]<<16+a[b++]<<8+a[b++],h=a[b++]<<8+a[b++],g=b,d){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(a,b,44)){b+=44,b+=4;var j=1&a[b++];this._hasTimeStamp=!0,i=((a[b++]<<23)+(a[b++]<<15)+(a[b++]<<7)+a[b++])/45,j&&(i+=47721858.84),i=Math.round(i),f.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),a}();c["default"]=g},{43:43}],23:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(17),h=d(g),i=a(26),j=d(i),k=a(21),l=d(k),m=a(43),n=a(24),o=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.id=c,this.remuxerClass=d,this.config=f,this.lastCC=0,this.remuxer=new this.remuxerClass(b,c,f)}return f(a,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(a,b,c,d,e,f,g,h){var i,k,l,o,p,q,r=a.length,s=this.remuxer.passthrough,t=!1;this.audioCodec=b,this.videoCodec=c,this._duration=h,this.contiguous=!1,e!==this.lastCC&&(m.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=e),f!==this.lastLevel?(m.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=f):g===this.lastSN+1&&(this.contiguous=!0),this.lastSN=g;var u=this.pmtParsed,v=this._avcTrack,w=this._aacTrack,x=this._id3Track,y=v.id,z=w.id,A=x.id,B=this._pmtId,C=v.pesData,D=w.pesData,E=x.pesData,F=this._parsePAT,G=this._parsePMT,H=this._parsePES,I=this._parseAVCPES.bind(this),J=this._parseAACPES.bind(this),K=this._parseID3PES.bind(this);for(r-=r%188,i=0;i<r;i+=188)if(71===a[i]){if(k=!!(64&a[i+1]),l=((31&a[i+1])<<8)+a[i+2],o=(48&a[i+3])>>4,o>1){if(p=i+5+a[i+4],p===i+188)continue}else p=i+4;switch(l){case y:if(k){if(C&&(q=H(C))&&(I(q,!1),s&&v.codec&&(z===-1||w.codec)))return void this.remux(f,g,a,d);C={data:[],size:0}}C&&(C.data.push(a.subarray(p,i+188)),C.size+=i+188-p);break;case z:if(k){if(D&&(q=H(D))&&(J(q),s&&w.codec&&(y===-1||v.codec)))return void this.remux(f,g,a,d);D={data:[],size:0}}D&&(D.data.push(a.subarray(p,i+188)),D.size+=i+188-p);break;case A:k&&(E&&(q=H(E))&&K(q),E={data:[],size:0}),E&&(E.data.push(a.subarray(p,i+188)),E.size+=i+188-p);break;case 0:k&&(p+=a[p]+1),B=this._pmtId=F(a,p);break;case B:k&&(p+=a[p]+1);var L=G(a,p);y=v.id=L.avc,z=w.id=L.aac,A=x.id=L.id3,t&&!u&&(m.logger.log("reparse from beginning"),t=!1,i=-188),u=this.pmtParsed=!0;break;case 17:case 8191:break;default:t=!0}}else this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});C&&(q=H(C))?(I(q,!0),v.pesData=null):v.pesData=C,D&&(q=H(D))?(J(q),w.pesData=null):(D&&D.size&&m.logger.log("last AAC PES packet truncated,might overlap between fragments"),w.pesData=D),E&&(q=H(E))?(K(q),x.pesData=null):x.pesData=E,this.remux(f,g,null,d)}},{key:"remux",value:function(a,b,c,d){var e=this._avcTrack,f=e.samples,g=f.reduce(function(a,b){var c=b.units.units.reduce(function(a,b){return{len:a.len+b.data.length,nbNalu:a.nbNalu+1}},{len:0,nbNalu:0});return b.length=c.len,{len:a.len+c.len,nbNalu:a.nbNalu+c.nbNalu}},{len:0,nbNalu:0});e.len=g.len,e.nbNalu=g.nbNalu,this.remuxer.remux(a,b,this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,d,this.contiguous,c)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(a,b){return(31&a[b+10])<<8|a[b+11]}},{key:"_parsePMT",value:function(a,b){var c,d,e,f,g={aac:-1,avc:-1,id3:-1};for(c=(15&a[b+1])<<8|a[b+2],d=b+3+c-4,e=(15&a[b+10])<<8|a[b+11],b+=12+e;b<d;){switch(f=(31&a[b+1])<<8|a[b+2],a[b]){case 15:g.aac===-1&&(g.aac=f);break;case 21:g.id3===-1&&(g.id3=f);break;case 27:g.avc===-1&&(g.avc=f);break;case 36:m.logger.warn("HEVC stream type found, not supported for now");break;default:m.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return g}},{key:"_parsePES",value:function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e!==a.size-6)return null;for(c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);l.length;){b=l.shift();var n=b.byteLength;if(j){if(j>n){j-=n;continue}b=b.subarray(j),n-=j,j=0}g.set(b,k),k+=n}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null}},{key:"pushAccesUnit",value:function(a,b){a.units.units.length&&(!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(b.samples.length||this.contiguous)?b.samples.push(a):b.dropped++),a.debug.length&&m.logger.log(a.pts+"/"+a.dts+":"+a.debug+","+a.units.length)}},{key:"_parseAVCPES",value:function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample;a.data=null,h.forEach(function(b){switch(b.type){case 1:d=!0,i&&j&&(j.debug+="NDR ");break;case 5:d=!0,j||(j=f.avcSample=f._createAVCSample(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new l["default"](f.discardEPB(b.data)),c.readUByte();for(var h=0,k=0,m=!1,n=0;!m&&c.bytesAvailable>1;){h=0;do n=c.readUByte(),h+=n;while(255===n);k=0;do n=c.readUByte(),k+=n;while(255===n);if(4===h&&0!==c.bytesAvailable){m=!0;var o=c.readUByte();if(181===o){var p=c.readUShort();if(49===p){var q=c.readUInt();if(1195456820===q){var r=c.readUByte();if(3===r){var s=c.readUByte(),t=c.readUByte(),u=31&s,v=[s,t];for(e=0;e<u;e++)v.push(c.readUByte()),v.push(c.readUByte()),v.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:v})}}}}}else if(k<c.bytesAvailable)for(e=0;e<k;e++)c.readUByte()}break;case 7:if(d=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new l["default"](b.data);var w=c.readSPS();g.width=w.width,g.height=w.height,g.sps=[b.data],g.duration=f._duration;var x=b.data.subarray(1,4),y="avc1.";for(e=0;e<3;e++){var z=x[e].toString(16);z.length<2&&(z="0"+z),y+=z}g.codec=y}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,j&&f.pushAccesUnit(j,g),j=f.avcSample=f._createAVCSample(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var A=j.units;A.units.push(b)}}),b&&j&&(this.pushAccesUnit(j,g),this.avcSample=null)}},{key:"_createAVCSample",value:function(a,b,c,d){return{key:a,pts:b,dts:c,units:{units:[],length:0},debug:d}}},{key:"_insertSampleInOrder",value:function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}},{key:"_getLastNalUnit",value:function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units.units;b=e[e.length-1]}return b}},{key:"_parseAVCNALu",value:function(a){for(var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;g<h;)switch(b=a[g++],j){case 0:0===b&&(j=1);break;case 1:j=0===b?2:0;break;case 2:case 3:if(0===b)j=3;else if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&g<=4-k&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}g<h?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;break;case-1:m=0,f=31&b,j=0}if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l}},{key:"discardEPB",value:function(a){for(var b,c,d=a.byteLength,e=[],f=1;f<d-2;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;f<b;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c}},{key:"_parseAACPES",value:function(a){var b,c,d,e,f,g,i,k,l,o=this._aacTrack,p=a.data,q=a.pts,r=0,s=this.aacOverFlow,t=this.aacLastPTS;if(s){var u=new Uint8Array(s.byteLength+p.byteLength);u.set(s,0),u.set(p,s.byteLength),p=u}for(f=r,k=p.length;f<k-1&&(255!==p[f]||240!==(240&p[f+1]));f++);if(f){var v,w;if(f<k-1?(v="AAC PES did not start with ADTS header,offset:"+f,w=!1):(v="no ADTS header found in AAC PES",w=!0),m.logger.warn("parsing error:"+v),this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:v}),w)return}if(o.audiosamplerate||(b=h["default"].getAudioConfig(this.observer,p,f,this.audioCodec),o.config=b.config,o.audiosamplerate=b.samplerate,o.channelCount=b.channelCount,o.codec=b.codec,o.duration=this._duration,m.logger.log("parsed codec:"+o.codec+",rate:"+b.samplerate+",nb channel:"+b.channelCount)),e=0,d=9216e4/o.audiosamplerate,s&&t){var x=t+d;Math.abs(x-q)>1&&(m.logger.log("AAC: align PTS for overlapping frames by "+Math.round((x-q)/90)),q=x)}for(;f+5<k&&(g=1&p[f+1]?7:9,c=(3&p[f+3])<<11|p[f+4]<<3|(224&p[f+5])>>>5,c-=g,c>0&&f+g+c<=k);)for(i=q+e*d,l={unit:p.subarray(f+g,f+g+c),pts:i,dts:i},o.samples.push(l),o.len+=c,f+=c+g,e++;f<k-1&&(255!==p[f]||240!==(240&p[f+1]));f++);s=f<k?p.subarray(f,k):null,this.aacOverFlow=s,this.aacLastPTS=i}},{key:"_parseID3PES",value:function(a){this._id3Track.samples.push(a)}}],[{key:"probe",value:function(a){return a.length>=564&&71===a[0]&&71===a[188]&&71===a[376]}}]),a}();c["default"]=o},{17:17,21:21,24:24,26:26,43:43}],24:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],25:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a(43),i=a(24),j=a(26),k=d(j),l=function(){function a(b){e(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return g(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===f(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(a,b){this.onEventGeneric(a,b)}},{key:"onEventGeneric",value:function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b);
};try{c.call(this,a,b).call()}catch(d){h.logger.error("internal error happened while processing "+a+":"+d.message),this.hls.trigger(k["default"].ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:d})}}}]),a}();c["default"]=l},{24:24,26:26,43:43}],26:[function(a,b,c){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],27:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"getSilentFrame",value:function(a){return 1===a?new Uint8Array([0,200,0,128,35,128]):2===a?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===a?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===a?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===a?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===a?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),a}();c["default"]=f},{}],28:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"bufferInfo",value:function(a,b,c){if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&b<m)e=l,f=m,d=f-b;else if(b+c<l){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}}]),a}();c["default"]=f},{}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=function(){function a(){d(this,a)}return e(a,null,[{key:"mergeDetails",value:function(b,c){var d,e=Math.max(b.startSN,c.startSN)-c.startSN,g=Math.min(b.endSN,c.endSN)-c.startSN,h=c.startSN-b.startSN,i=b.fragments,j=c.fragments,k=0;if(g<e)return void(c.PTSKnown=!1);for(var l=e;l<=g;l++){var m=i[h+l],n=j[l];n&&m&&(k=m.cc-n.cc,isNaN(m.startPTS)||(n.start=n.startPTS=m.startPTS,n.endPTS=m.endPTS,n.duration=m.duration,d=n))}if(k)for(f.logger.log("discontinuity sliding from playlist, take drift into account"),l=0;l<j.length;l++)j[l].cc+=k;if(d)a.updateFragPTSDTS(c,d.sn,d.startPTS,d.endPTS,d.startDTS,d.endDTS);else if(h>=0&&h<i.length){var o=i[h].start;for(l=0;l<j.length;l++)j[l].start+=o}c.PTSKnown=b.PTSKnown}},{key:"updateFragPTSDTS",value:function(b,c,d,e,f,g){var h,i,j,k;if(c<b.startSN||c>b.endSN)return 0;if(h=c-b.startSN,i=b.fragments,j=i[h],!isNaN(j.startPTS)){var l=Math.abs(j.startPTS-d);isNaN(j.deltaPTS)?j.deltaPTS=l:j.deltaPTS=Math.max(l,j.deltaPTS),d=Math.min(d,j.startPTS),e=Math.max(e,j.endPTS),f=Math.min(f,j.startDTS),g=Math.max(g,j.endDTS)}var m=d-j.start;for(j.start=j.startPTS=d,j.endPTS=e,j.startDTS=f,j.endDTS=g,j.duration=e-d,k=h;k>0;k--)a.updatePTS(i,k,k-1);for(k=h;k<i.length-1;k++)a.updatePTS(i,k,k+1);return b.PTSKnown=!0,m}},{key:"updatePTS",value:function(a,b,c){var d=a[b],e=a[c],g=e.startPTS;isNaN(g)?c>b?e.start=d.start+d.duration:e.start=d.start-e.duration:c>b?(d.duration=g-d.start,d.duration<0&&f.logger.error("negative duration computed for frag "+d.sn+",level "+d.level+", there should be some duration drift between playlist and fragment!")):(e.duration=d.start-g,e.duration<0&&f.logger.error("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"))}}]),a}();c["default"]=g},{43:43}],30:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(26),h=d(g),i=a(24),j=a(34),k=d(j),l=a(32),m=d(l),n=a(3),o=d(n),p=a(6),q=d(p),r=a(7),s=d(r),t=a(4),u=d(t),v=a(11),w=d(v),x=a(10),y=d(x),z=a(12),A=d(z),B=a(9),C=d(B),D=a(5),E=d(D),F=a(43),G=a(47),H=d(G),I=a(1),J=d(I),K=a(33),L=d(K),M=a(41),N=d(M),O=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e(this,a);var c=a.DefaultConfig;if((b.liveSyncDurationCount||b.liveMaxLatencyDurationCount)&&(b.liveSyncDuration||b.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var d in c)d in b||(b[d]=c[d]);if(void 0!==b.liveMaxLatencyDurationCount&&b.liveMaxLatencyDurationCount<=b.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==b.liveMaxLatencyDuration&&(b.liveMaxLatencyDuration<=b.liveSyncDuration||void 0===b.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,F.enableLogs)(b.debug),this.config=b;var f=this.observer=new J["default"];f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))},this.on=f.on.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f),this.playlistLoader=new k["default"](this),this.fragmentLoader=new m["default"](this),this.levelController=new y["default"](this),this.abrController=new b.abrController(this),this.bufferController=new b.bufferController(this),this.capLevelController=new b.capLevelController(this),this.fpsController=new b.fpsController(this),this.streamController=new b.streamController(this),this.audioStreamController=new b.audioStreamController(this),this.timelineController=new b.timelineController(this),this.audioTrackController=new E["default"](this),this.keyLoader=new L["default"](this)}return f(a,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.5"}},{key:"Events",get:function(){return h["default"]}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig||(a.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:H["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:o["default"],bufferController:q["default"],capLevelController:s["default"],fpsController:C["default"],streamController:w["default"],audioStreamController:u["default"],timelineController:A["default"],cueHandler:N["default"],enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.8,abrBandWidthUpFactor:.7,maxStarvationDelay:4}),a.defaultConfig},set:function(b){a.defaultConfig=b}}]),f(a,[{key:"destroy",value:function(){F.logger.log("destroy"),this.trigger(h["default"].DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(a){F.logger.log("attachMedia"),this.media=a,this.trigger(h["default"].MEDIA_ATTACHING,{media:a})}},{key:"detachMedia",value:function(){F.logger.log("detachMedia"),this.trigger(h["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(a){F.logger.log("loadSource:"+a),this.url=a,this.trigger(h["default"].MANIFEST_LOADING,{url:a})}},{key:"startLoad",value:function(){var a=arguments.length<=0||void 0===arguments[0]?-1:arguments[0];F.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(a),this.audioStreamController.startLoad(a)}},{key:"stopLoad",value:function(){F.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){F.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){F.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){F.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){F.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){F.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(a){F.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){F.logger.log("set startLevel:"+a),this.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(a){F.logger.log("set autoLevelCapping:"+a),this.abrController.autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(a){this.audioTrackController.audioTrack=a}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),a}();c["default"]=O},{1:1,10:10,11:11,12:12,24:24,26:26,3:3,32:32,33:33,34:34,4:4,41:41,43:43,47:47,5:5,6:6,7:7,9:9}],31:[function(a,b,c){"use strict";b.exports=a(30)["default"]},{30:30}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(24),n=a(43),o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].FRAG_LOADING));return c.loaders={},c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(n.logger.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=c.frag;e.loader=void 0,this.loaders[e.type]=void 0,this.hls.trigger(j["default"].FRAG_LOADED,{payload:d,frag:e,stats:b})}},{key:"loaderror",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag})}},{key:"loadprogress",value:function(a,b,c){var d=b.frag;d.loaded=a.loaded,this.hls.trigger(j["default"].FRAG_LOAD_PROGRESS,{frag:d,stats:a})}}]),b}(l["default"]);c["default"]=o},{24:24,25:25,26:26,43:43}],33:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(24),n=a(43),o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(n.logger.warn("abort previous fragment loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,k=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,k)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(j["default"].KEY_LOADED,{frag:b}))}},{key:"loadsuccess",value:function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[c.type]=void 0,this.hls.trigger(j["default"].KEY_LOADED,{frag:d})}},{key:"loaderror",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})}}]),b}(l["default"]);c["default"]=o},{24:24,25:25,26:26,43:43}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(26),j=d(i),k=a(25),l=d(k),m=a(24),n=a(46),o=d(n),p=a(38),q=d(p),r=a(43),s=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a,j["default"].MANIFEST_LOADING,j["default"].LEVEL_LOADING,j["default"].AUDIO_TRACK_LOADING));return c.loaders={},c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(a){this.load(a.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})}},{key:"onAudioTrackLoading",value:function(a){this.load(a.url,{type:"audioTrack",id:a.id})}},{key:"load",value:function(a,b){var c,d,e,f,g=this.hls.config;"manifest"===b.type?(c=g.manifestLoadingMaxRetry,d=g.manifestLoadingTimeOut,e=g.manifestLoadingRetryDelay,f=g.manifestLoadingMaxRetryTimeOut):(c=g.levelLoadingMaxRetry,d=g.levelLoadingTimeOut,e=g.levelLoadingRetryDelay,f=g.levelLoadingMaxRetryTimeOut);var h=this.loaders[b.type];if(h){var i=h.context;if(i&&i.url===a)return void r.logger.warn("playlist request ongoing");r.logger.warn("abort previous loader for type:"+b.type),h.abort()}h=this.loaders[b.type]=b.loader="undefined"!=typeof g.pLoader?new g.pLoader(g):new g.loader(g),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:d,maxRetry:c,retryDelay:e,maxRetryDelay:f},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},h.load(b,j,k)}},{key:"resolve",value:function(a,b){return o["default"].buildAbsoluteURL(b,a)}},{key:"parseMasterPlaylist",value:function(a,b){for(var c=[],d=void 0,e=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(d=e.exec(a));){var f={},g=f.attrs=new q["default"](d[1]);f.url=this.resolve(d[2],b);var h=g.decimalResolution("RESOLUTION");h&&(f.width=h.width,f.height=h.height),f.bitrate=g.decimalInteger("AVERAGE-BANDWIDTH")||g.decimalInteger("BANDWIDTH"),f.name=g.NAME;var i=g.CODECS;if(i){i=i.split(",");for(var j=0;j<i.length;j++){var k=i[j];k.indexOf("avc1")!==-1?f.videoCodec=this.avc1toavcoti(k):f.audioCodec=k}}c.push(f)}return c}},{key:"parseMasterPlaylistMedia",value:function(a,b,c){for(var d=void 0,e=[],f=/#EXT-X-MEDIA:(.*)/g;null!=(d=f.exec(a));){var g={},h=new q["default"](d[1]);h.TYPE===c&&(g.groupId=h["GROUP-ID"],g.name=h.NAME,g.type=c,g["default"]="YES"===h.DEFAULT,g.autoselect="YES"===h.AUTOSELECT,g.forced="YES"===h.FORCED,h.URI&&(g.url=this.resolve(h.URI,b)),g.lang=h.LANGUAGE,g.name||(g.name=g.lang),e.push(g))}return e}},{key:"createInitializationVector",value:function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=this.cloneObj(a),c.iv=this.createInitializationVector(b)),c}},{key:"avc1toavcoti",value:function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b}},{key:"cloneObj",value:function(a){return JSON.parse(JSON.stringify(a))}},{key:"parseLevelPlaylist",value:function(a,b,c,d){var e,f,g,h=0,i=0,j={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},k={method:null,key:null,iv:null,uri:null},l=0,m=null,n=null,o=null,p=null,s=null,t=null,u=[];for(g=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF):(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE):(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g;null!==(f=g.exec(a));)switch(f.shift(),f=f.filter(function(a){return void 0!==a}),f[0]){case"PLAYLIST-TYPE":j.type=f[1].toUpperCase();break;case"MEDIA-SEQUENCE":h=j.startSN=parseInt(f[1]);break;case"TARGETDURATION":j.targetduration=parseFloat(f[1]);break;case"VERSION":j.version=parseInt(f[1]);break;case"EXTM3U":break;case"ENDLIST":j.live=!1;break;case"DIS":l++,u.push(f);break;case"BYTERANGE":var v=f[1].split("@");t=1===v.length?s:parseInt(v[1]),s=parseInt(v[0])+t;break;case"INF":o=parseFloat(f[1]),p=f[2]?f[2]:null,u.push(f);break;case"":if(!isNaN(o)){var w=h++;e=this.fragmentDecryptdataFromLevelkey(k,w);var x=f[1]?this.resolve(f[1],b):null;n={url:x,type:d,duration:o,title:p,start:i,sn:w,level:c,cc:l,decryptdata:e,programDateTime:m,tagList:u},null!==t&&(n.byteRangeStartOffset=t,n.byteRangeEndOffset=s),j.fragments.push(n),i+=o,o=null,p=null,t=null,m=null,u=[]}break;case"KEY":var y=f[1],z=new q["default"](y),A=z.enumeratedString("METHOD"),B=z.URI,C=z.hexadecimalInteger("IV");A&&(k={method:null,key:null,iv:null,uri:null},B&&"AES-128"===A&&(k.method=A,k.uri=this.resolve(B,b),k.key=null,k.iv=C));break;case"START":var D=f[1],E=new q["default"](D),F=E.decimalFloatingPoint("TIME-OFFSET");isNaN(F)||(j.startTimeOffset=F);break;case"PROGRAM-DATE-TIME":m=new Date(Date.parse(f[1])),u.push(f);break;case"#":f.shift(),u.push(f);break;default:r.logger.warn("line parsed but not handled: "+f)}return n&&!n.url&&(j.fragments.pop(),i-=n.duration),j.totalduration=i,j.averagetargetduration=i/j.fragments.length,j.endSN=h-1,j}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=a.url,f=c.type,g=c.id,h=c.level,i=this.hls;if(this.loaders[f]=void 0,void 0!==e&&0!==e.indexOf("data:")||(e=c.url),b.tload=performance.now(),0===d.indexOf("#EXTM3U"))if(d.indexOf("#EXTINF:")>0){var k="audioTrack"!==f,l=this.parseLevelPlaylist(d,e,(k?h:g)||0,k?"main":"audio");l.tload=b.tload,"manifest"===f&&i.trigger(j["default"].MANIFEST_LOADED,{levels:[{url:e,details:l}],url:e,stats:b}),b.tparsed=performance.now(),k?i.trigger(j["default"].LEVEL_LOADED,{details:l,level:h||0,id:g||0,stats:b}):i.trigger(j["default"].AUDIO_TRACK_LOADED,{details:l,id:g,stats:b})}else{var n=this.parseMasterPlaylist(d,e);if(n.length){var o=this.parseMasterPlaylistMedia(d,e,"AUDIO");if(o.length){var p=!1;o.forEach(function(a){a.url||(p=!0)}),p===!1&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(r.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),o.unshift({type:"main",name:"main"}))}i.trigger(j["default"].MANIFEST_LOADED,{levels:n,audioTracks:o,url:e,stats:b})}else i.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no level found in manifest"})}else i.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=m.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=m.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=m.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,response:a,context:b})}},{key:"loadtimeout",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=m.ErrorDetails.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=m.ErrorDetails.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=m.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,context:b})}}]),b}(l["default"]);c["default"]=s},{24:24,25:25,26:26,38:38,43:43,46:46}],35:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"init",value:function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))}},{key:"box",value:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;e<f;e++)b.set(c[e],d),d+=c[e].byteLength;return b}},{key:"hdlr",value:function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])}},{key:"mdat",value:function(b){return a.box(a.types.mdat,b)}},{key:"mdhd",value:function(b,c){return c*=b,a.box(a.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24,c>>16&255,c>>8&255,255&c,85,196,0,0]))}},{key:"mdia",value:function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))}},{key:"mfhd",value:function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))}},{key:"minf",value:function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))}},{key:"moof",value:function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))}},{key:"moov",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))}},{key:"mvex",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))}},{key:"mvhd",value:function(b,c){c*=b;var d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24&255,c>>16&255,c>>8&255,255&c,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);
return a.box(a.types.mvhd,d)}},{key:"sdtp",value:function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)}},{key:"stbl",value:function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height;return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))}},{key:"mp4a",value:function(b){var c=b.audiosamplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))}},{key:"stsd",value:function(b){return"audio"===b.type?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))}},{key:"tkhd",value:function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,f=b.height;return a.box(a.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,f>>8&255,255&f,0,0]))}},{key:"traf",value:function(b,c){var d=a.sdtp(b),e=b.id;return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c])),a.trun(b,d.length+16+16+8+16+8+8),d)}},{key:"trak",value:function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))}},{key:"trex",value:function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)}},{key:"initSegment",value:function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c}}]),a}();c["default"]=f},{}],36:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(27),h=d(g),i=a(26),j=d(i),k=a(43),l=a(35),m=d(l),n=a(24);a(44);var o=function(){function a(b,c,d){e(this,a),this.observer=b,this.id=c,this.config=d,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return f(a,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f,g,h){if(this.level=a,this.sn=b,this.ISGenerated||this.generateIS(c,d,g),this.ISGenerated)if(c.samples.length){var i=this.remuxAudio(c,g,h);if(d.samples.length){var k=void 0;i&&(k=i.endPTS-i.startPTS),this.remuxVideo(d,g,h,k)}}else{var l=void 0;d.samples.length&&(l=this.remuxVideo(d,g,h)),l&&c.codec&&this.remuxEmptyAudio(c,g,h,l)}e.samples.length&&this.remuxID3(e,g),f.samples.length&&this.remuxText(f,g),this.observer.trigger(j["default"].FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(a,b,c){var d,e,f=this.observer,g=a.samples,h=b.samples,i=this.PES_TIMESCALE,l={},o={id:this.id,level:this.level,sn:this.sn,tracks:l,unique:!1},p=void 0===this._initPTS;p&&(d=e=1/0),a.config&&g.length&&(a.timescale=a.audiosamplerate,a.timescale*a.duration>Math.pow(2,32)&&!function(){var b=function c(a,b){return b?c(b,a%b):a};a.timescale=a.audiosamplerate/b(a.audiosamplerate,1024)}(),k.logger.log("audio mp4 timescale :"+a.timescale),l.audio={container:"audio/mp4",codec:a.codec,initSegment:m["default"].initSegment([a]),metadata:{channelCount:a.channelCount}},p&&(d=e=g[0].pts-i*c)),b.sps&&b.pps&&h.length&&(b.timescale=this.MP4_TIMESCALE,l.video={container:"video/mp4",codec:b.codec,initSegment:m["default"].initSegment([b]),metadata:{width:b.width,height:b.height}},p&&(d=Math.min(d,h[0].pts-i*c),e=Math.min(e,h[0].dts-i*c))),Object.keys(l).length?(f.trigger(j["default"].FRAG_PARSING_INIT_SEGMENT,o),this.ISGenerated=!0,p&&(this._initPTS=d,this._initDTS=e)):f.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,b,c,d){var e,f,g,h,i,l,n,o,p=8,q=this.PES_TIMESCALE,r=this.PES2MP4SCALEFACTOR,s=a.samples,t=[],u=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(u<0){k.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(u/90)+" ms to overcome this issue");for(var v=0;v<s.length;v++)s[v].dts+=u}var w=void 0;w=c?this.nextAvcDts:b*q;var x=s[0];i=Math.max(this._PTSNormalize(x.dts-this._initDTS,w),0),h=Math.max(this._PTSNormalize(x.pts-this._initDTS,w),0);var y=Math.round((i-w)/90);c&&y&&(y>1?k.logger.log("AVC:"+y+" ms hole between fragments detected,filling it"):y<-1&&k.logger.log("AVC:"+-y+" ms overlapping between fragments detected"),i=w,s[0].dts=i+this._initDTS,h=Math.max(h-y,w),s[0].pts=h+this._initDTS,k.logger.log("Video/PTS/DTS adjusted: "+h+"/"+i+",delta:"+y)),l=i,x=s[s.length-1],o=Math.max(this._PTSNormalize(x.dts-this._initDTS,w),0),n=Math.max(this._PTSNormalize(x.pts-this._initDTS,w),0),n=Math.max(n,o);var z=navigator.vendor,A=navigator.userAgent,B=z&&z.indexOf("Apple")>-1&&A&&!A.match("CriOS");B&&(e=Math.round((o-i)/(r*(s.length-1))));for(var C=0;C<s.length;C++){var D=s[C];B?D.dts=i+C*r*e:(D.dts=Math.max(this._PTSNormalize(D.dts-this._initDTS,w),i),D.dts=Math.round(D.dts/r)*r),D.pts=Math.max(this._PTSNormalize(D.pts-this._initDTS,w),D.dts),D.pts=Math.round(D.pts/r)*r}f=new Uint8Array(a.len+4*a.nbNalu+8);var E=new DataView(f.buffer);E.setUint32(0,f.byteLength),f.set(m["default"].types.mdat,4);for(var F=0;F<s.length;F++){for(var G=s[F],H=0,I=void 0;G.units.units.length;){var J=G.units.units.shift();E.setUint32(p,J.data.byteLength),p+=4,f.set(J.data,p),p+=J.data.byteLength,H+=4+J.data.byteLength}if(B)I=Math.max(0,e*Math.round((G.pts-G.dts)/(r*e)));else{if(F<s.length-1)e=s[F+1].dts-G.dts;else{var K=this.config,L=G.dts-s[F>0?F-1:F].dts;if(K.stretchShortVideoTrack){var M=K.maxBufferHole,N=K.maxSeekHole,O=Math.floor(Math.min(M,N)*q),P=(d?h+d*q:this.nextAacPts)-G.pts;P>O?(e=P-L,e<0&&(e=L),k.logger.log("It is approximately "+P/90+" ms to the next segment; using duration "+e/90+" ms for the last video frame.")):e=L}else e=L}e/=r,I=Math.round((G.pts-G.dts)/r)}t.push({size:H,duration:e,cts:I,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1}})}this.nextAvcDts=o+e*r;var Q=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var R=t[0].flags;R.dependsOn=2,R.isNonSync=0}a.samples=t,g=m["default"].moof(a.sequenceNumber++,i/r,a),a.samples=[];var S={id:this.id,level:this.level,sn:this.sn,data1:g,data2:f,startPTS:h/q,endPTS:(n+r*e)/q,startDTS:i/q,endDTS:this.nextAvcDts/q,type:"video",nb:t.length,dropped:Q};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,S),S}},{key:"remuxAudio",value:function(a,b,c){var d,e,f,g,i,l,n,o,p,q,r,s,t,u,v,w=this.PES_TIMESCALE,x=a.timescale,y=w/x,z=1024*a.timescale/a.audiosamplerate,A=8,B=[],C=[];a.samples.sort(function(a,b){return a.pts-b.pts}),C=a.samples,c|=C.length&&this.nextAacPts&&Math.abs(b-this.nextAacPts/w)<.1;for(var D=c?this.nextAacPts:b*w,E=z*y,F=D,G=0;G<C.length;){var H=C[G],I=this._PTSNormalize(H.pts-this._initDTS,D),J=I-F;if(J<=-E)k.logger.warn("Dropping 1 audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(Math.abs(J/90))+" ms overlap."),C.splice(G,1),a.len-=H.unit.length;else if(J>=E){var K=Math.round(J/E);k.logger.warn("Injecting "+K+" audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(J/90)+" ms gap.");for(var L=0;L<K;L++)v=F+this._initDTS,v=Math.max(v,this._initDTS),u=h["default"].getSilentFrame(a.channelCount),u||(k.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),u=H.unit.slice(0)),C.splice(G,0,{unit:u,pts:v,dts:v}),a.len+=u.length,F+=E,G+=1;H.pts=H.dts=F+this._initDTS,F+=E,G+=1}else Math.abs(J)>.1*E,F+=E,0===G?H.pts=H.dts=this._initDTS+D:H.pts=H.dts=C[G-1].pts+E,G+=1}for(;C.length;){if(e=C.shift(),g=e.unit,q=e.pts-this._initDTS,r=e.dts-this._initDTS,void 0!==p)s=this._PTSNormalize(q,p),t=this._PTSNormalize(r,p),f.duration=Math.round((t-p)/y);else{s=this._PTSNormalize(q,D),t=this._PTSNormalize(r,D);var M=Math.round(1e3*(s-D)/w),N=0;if(c&&M){if(M>0)N=Math.round((s-D)/E),k.logger.log(M+" ms hole between AAC samples detected,filling it"),N>0&&(u=h["default"].getSilentFrame(a.channelCount),u||(u=g.slice(0)),a.len+=N*u.length);else if(M<-12){k.logger.log(-M+" ms overlapping between AAC samples detected, drop frame"),a.len-=g.byteLength;continue}s=t=D}if(n=Math.max(0,s),o=Math.max(0,t),!(a.len>0))return;for(i=new Uint8Array(a.len+8),d=new DataView(i.buffer),d.setUint32(0,i.byteLength),i.set(m["default"].types.mdat,4),G=0;G<N;G++)v=s-(N-G)*E,u=h["default"].getSilentFrame(a.channelCount),u||(k.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),u=g.slice(0)),i.set(u,A),A+=u.byteLength,f={size:u.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},B.push(f)}i.set(g,A),A+=g.byteLength,f={size:g.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},B.push(f),p=t}var O=0,P=B.length;if(P>=2&&(O=B[P-2].duration,f.duration=O),P){this.nextAacPts=s+y*O,a.len=0,a.samples=B,l=m["default"].moof(a.sequenceNumber++,o/y,a),a.samples=[];var Q={id:this.id,level:this.level,sn:this.sn,data1:l,data2:i,startPTS:n/w,endPTS:this.nextAacPts/w,startDTS:o/w,endDTS:(t+y*O)/w,type:"audio",nb:P};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,Q),Q}return null}},{key:"remuxEmptyAudio",value:function(a,b,c,d){var e=this.PES_TIMESCALE,f=a.timescale?a.timescale:a.audiosamplerate,g=e/f,i=d.startDTS*e+this._initDTS,j=d.endDTS*e+this._initDTS,l=1024,m=g*l,n=Math.ceil((j-i)/m),o=h["default"].getSilentFrame(a.channelCount);if(!o)return void k.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],q=0;q<n;q++){var r=i+q*m;p.push({unit:o.slice(0),pts:r,dts:r}),a.len+=o.length}a.samples=p,this.remuxAudio(a,b,c)}},{key:"remuxID3",value:function(a,b){var c,d=a.samples.length;if(d){for(var e=0;e<d;e++)c=a.samples[e],c.pts=(c.pts-this._initPTS)/this.PES_TIMESCALE,c.dts=(c.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(j["default"].FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:a.samples})}a.samples=[],b=b}},{key:"remuxText",value:function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length;if(d){for(var e=0;e<d;e++)c=a.samples[e],c.pts=(c.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(j["default"].FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:a.samples})}a.samples=[],b=b}},{key:"_PTSNormalize",value:function(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}},{key:"passthrough",get:function(){return!1}}]),a}();c["default"]=o},{24:24,26:26,27:27,35:35,43:43,44:44}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(26),h=d(g),i=function(){function a(b,c){e(this,a),this.observer=b,this.id=c,this.ISGenerated=!1}return f(a,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f){var g=this.observer;if(!this.ISGenerated){var i={},j={id:this.id,tracks:i,unique:!0},k=b,l=k.codec;l&&(j.tracks.video={container:k.container,codec:l,metadata:{width:k.width,height:k.height}}),k=a,l=k.codec,l&&(j.tracks.audio={container:k.container,codec:l,metadata:{channelCount:k.channelCount}}),this.ISGenerated=!0,g.trigger(h["default"].FRAG_PARSING_INIT_SEGMENT,j)}g.trigger(h["default"].FRAG_PARSING_DATA,{id:this.id,data1:f,startPTS:e,startDTS:e,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),a}();c["default"]=i},{26:26}],38:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return e(a,[{key:"decimalInteger",value:function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"hexadecimalInteger",value:function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null}},{key:"hexadecimalIntegerAsNumber",value:function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"decimalFloatingPoint",value:function(a){return parseFloat(this[a])}},{key:"enumeratedString",value:function(a){return this[a]}},{key:"decimalResolution",value:function(a){var b=/^(\d+)x(\d+)$/.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}}}],[{key:"parseAttrList",value:function(a){for(var b,c=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,d={};null!==(b=c.exec(a));){var e=b[2],f='"';0===e.indexOf(f)&&e.lastIndexOf(f)===e.length-1&&(e=e.slice(1,-1)),d[b[1]]=e}return d}}]),a}();c["default"]=f},{}],39:[function(a,b,c){"use strict";var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}};b.exports=d},{}],40:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g=function(a){var b=a;return f.hasOwnProperty(a)&&(b=f[a]),String.fromCharCode(b)},h=15,i=32,j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],o={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},p=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},q=function(){function a(b,c,e,f,g){d(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=e||!1,this.background=f||"black",this.flash=g||!1}return e(a,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash}},{key:"copy",value:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),a}(),r=function(){function a(b,c,e,f,g,h){d(this,a),this.uchar=b||" ",this.penState=new q(c,e,f,g,h)}return e(a,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(a,b){this.uchar=a,this.penState.copy(b)}},{key:"setPenState",value:function(a){this.penState.copy(a)}},{key:"equals",value:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)}},{key:"copy",value:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),a}(),s=function(){function a(){d(this,a),this.chars=[];for(var b=0;b<i;b++)this.chars.push(new r);this.pos=0,this.currPenState=new q}return e(a,[{key:"equals",value:function(a){for(var b=!0,c=0;c<i;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<i;b++)this.chars[b].copy(a.chars[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<i;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a}},{key:"setCursor",value:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(o.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(o.log("ERROR","Too large cursor position "+this.pos),this.pos=i)}},{key:"moveCursor",value:function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(a){a>=144&&this.backSpace();var b=g(a);return this.pos>=i?void o.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(a){var b;for(b=a;b<i;b++)this.chars[b].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var a=[],b=!0,c=0;c<i;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")}},{key:"setPenStyles",value:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}}]),a}(),t=function(){function a(){d(this,a),this.rows=[];for(var b=0;b<h;b++)this.rows.push(new s);this.currRow=h-1,this.nrRollUpRows=null,this.reset()}return e(a,[{key:"reset",value:function(){for(var a=0;a<h;a++)this.rows[a].clear();this.currRow=h-1}},{key:"equals",value:function(a){for(var b=!0,c=0;c<h;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<h;b++)this.rows[b].copy(a.rows[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<h;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a}},{key:"backSpace",value:function(){var a=this.rows[this.currRow];a.backSpace()}},{key:"clearToEndOfRow",value:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()}},{key:"insertChar",value:function(a){var b=this.rows[this.currRow];b.insertChar(a)}},{key:"setPen",value:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)}},{key:"moveCursor",value:function(a){var b=this.rows[this.currRow];b.moveCursor(a)}},{key:"setCursor",value:function(a){o.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)}},{key:"setPAC",value:function(a){o.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.currRow=b;var c=this.rows[this.currRow];if(null!==a.indent){var d=a.indent,e=Math.max(d-1,0);c.setCursor(a.indent),a.color=c.chars[e].penState.foreground}var f={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(f)}},{key:"setBkgData",value:function(a){o.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)}},{key:"setRollUpRows",value:function(a){this.nrRollUpRows=a}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void o.log("DEBUG","roll_up but nrRollUpRows not set yet");o.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),o.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<h;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c}},{key:"getTextAndFormat",value:function(){return this.rows}}]),a}(),u=function(){function a(b,c){d(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t,this.nonDisplayedMemory=new t,this.lastOutputScreen=new t,this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e(a,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(a){this.outputFilter=a}},{key:"setPAC",value:function(a){this.writeScreen.setPAC(a)}},{key:"setBkgData",value:function(a){this.writeScreen.setBkgData(a)}},{key:"setMode",value:function(a){a!==this.mode&&(this.mode=a,o.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)}},{key:"insertChars",value:function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";o.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(o.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){o.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){o.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){o.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(a){o.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)}},{key:"ccFON",value:function(){o.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){o.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){o.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){o.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){o.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){o.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){o.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(o.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,o.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(a){o.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)}},{key:"ccMIDROW",value:function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}o.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)}},{key:"outputDataUpdate",value:function(){var a=o.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}}]),a}(),v=function(){function a(b,c,e){d(this,a),this.field=b||1,this.outputs=[c,e],this.channels=[new u(1,c),new u(2,e)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return e(a,[{key:"getHandler",value:function(a){return this.channels[a].getHandler()}},{key:"setHandler",value:function(a,b){this.channels[a].setHandler(b)}},{key:"addData",value:function(a,b){var c,d,e,f=!1;this.lastTime=a,o.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(o.log("DATA","["+p([b[g],b[g+1]])+"] -> ("+p([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else o.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,o.log("WARNING","Couldn't parse cleaned data "+p([d,e])+" orig: "+p([b[g],b[g+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,b){var c=null,d=(20===a||28===a)&&32<=b&&b<=47,e=(23===a||31===a)&&33<=b&&b<=35;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,o.log("DEBUG","Repeated command ("+p([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"parseMidrow",value:function(a,b){var c=null;if((17===a||25===a)&&32<=b&&b<=47){if(c=17===a?1:2,c!==this.currChNr)return o.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),o.log("DEBUG","MIDROW ("+p([a,b])+")"),!0}return!1}},{key:"parsePAC",value:function(a,b){var c=null,d=null,e=(17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127,f=(16===a||24===a)&&64<=b&&b<=95;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=a<=23?1:2,d=64<=b&&b<=95?1===c?j[a]:l[a]:1===c?k[a]:m[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"interpretPAC",value:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d}},{key:"parseChars",value:function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),17<=e&&e<=19){var f=b;f=17===e?b+80:18===e?b+112:b+144,o.log("INFO","Special char '"+g(f)+"' in channel "+c),d=[f]}else 32<=a&&a<=127&&(d=0===b?[a]:[a,b]);if(d){var h=p(d);o.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d}},{key:"parseBackgroundAttributes",value:function(a,b){var c,d,e,f,g=(16===a||24===a)&&32<=b&&b<=47,h=(23===a||31===a)&&45<=b&&b<=47;return!(!g&&!h)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=n[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=a<24?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a);
}}]),a}();c["default"]=v},{}],41:[function(a,b,c){"use strict";var d={newCue:function(a,b,c,d){for(var e,f,g,h,i,j=window.VTTCue||window.TextTrackCue,k=0;k<d.rows.length;k++)if(e=d.rows[k],g=!0,h=0,i="",!e.isEmpty()){for(var l=0;l<e.chars.length;l++)e.chars[l].uchar.match(/\s/)&&g?h++:(i+=e.chars[l].uchar,g=!1);f=new j(b,c,i.trim()),h>=16?h--:h++,navigator.userAgent.match(/Firefox\//)?f.line=k+1:f.line=k>7?k-2:k+1,f.align="left",f.position=100*(h/32)+(navigator.userAgent.match(/Firefox\//)?50:0),a.addCue(f)}}};b.exports=d},{}],42:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return e(a,[{key:"sample",value:function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_}}]),a}();c["default"]=f},{}],43:[function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i;c.enableLogs=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(b){j=i}}else j=i},c.logger=j},{}],44:[function(a,b,c){"use strict";"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){var c=new Uint8Array(this);void 0===b&&(b=c.length);for(var d=new ArrayBuffer(b-a),e=new Uint8Array(d),f=0;f<e.length;f++)e[f]=c[f+a];return d})},{}],45:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"toString",value:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d)+","+a.end(d)+"]";return b}}]),a}();c["default"]=f},{}],46:[function(a,b,c){"use strict";var d={buildAbsoluteURL:function(a,b){if(b=b.trim(),/^[a-z]+:/i.test(b))return b;var c=null,e=null,f=/^([^#]*)(.*)$/.exec(b);f&&(e=f[2],b=f[1]);var g=/^([^\?]*)(.*)$/.exec(b);g&&(c=g[2],b=g[1]);var h=/^([^#]*)(.*)$/.exec(a);h&&(a=h[1]);var i=/^([^\?]*)(.*)$/.exec(a);i&&(a=i[1]);var j=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(a);if(!j)throw new Error("Error trying to parse base URL.");var k=j[2]||"",l=j[1]||"",m=j[4],n=null;return n=/^\/\//.test(b)?k+"//"+d.buildAbsolutePath("",b.substring(2)):/^\//.test(b)?l+"/"+d.buildAbsolutePath("",b.substring(1)):d.buildAbsolutePath(l+m,b),c&&(n+=c),e&&(n+=e),n},buildAbsolutePath:function(a,b){for(var c,d,e=b,f="",g=a.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),h=0;d=g.indexOf("/../",h),d>-1;h=d+c)c=/^\/(?:\.\.\/)*/.exec(g.slice(d))[0].length,f=(f+g.substring(h,d)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(c-1)/3+"}$"),"/");return f+g.substr(h)}};b.exports=d},{}],47:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=function(){function a(b){d(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return e(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a,b=this.context;a="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.open("GET",b.url,!0),b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.responseType=b.responseType;var c=this.stats;c.tfirst=0,c.loaded=0,this.xhrSetup&&this.xhrSetup(a,b.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,g=this.config;if(!d.aborted&&(window.clearTimeout(this.requestTimeout),c>=2&&(0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),g.timeout-(d.tfirst-d.trequest))),4===c))){var h=b.status;if(h>=200&&h<300){d.tload=Math.max(d.tfirst,performance.now());var i=void 0,j=void 0;"arraybuffer"===e.responseType?(i=b.response,j=i.byteLength):(i=b.responseText,j=i.length),d.loaded=d.total=j;var k={url:b.responseURL,data:i};this.callbacks.onSuccess(k,d,e)}else d.retry>=g.maxRetry||h>=400&&h<499?(f.logger.error(h+" while loading "+e.url),this.callbacks.onError({code:h,text:b.statusText},e)):(f.logger.warn(h+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),d.retry++)}}},{key:"loadtimeout",value:function(){f.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total);var c=this.callbacks.onProgress;c&&c(b,this.context,null)}}]),a}();c["default"]=g},{43:43}]},{},[31])(31)}),define("player/getSupportedMode",["jquery","hlsjs","swfobject"],function(a,b){"use strict";function c(a){return e.canPlayType(a).replace(/^no$/,"")}var d=["flash","hls","h264"],e=document.createElement("video");return function(a){var f=navigator.userAgent.toLowerCase(),g=f.indexOf("windows nt")>-1&&f.indexOf("; arm;")>-1,h=a.modes||d,i={flash:function(){return!(g||f.indexOf("android")!==-1||!swfobject.hasFlashPlayerVersion(a.flashVersion))},h264:function(){return!(!e.canPlayType||!c('video/mp4; codecs="avc1.42E01E"'))},hls:function(){return!(!e.canPlayType||f.indexOf("android")!==-1||f.indexOf("googletv")!==-1||!c("application/vnd.apple.mpegURL")&&!c("application/x-mpegURL"))},hlsjs:function(){return!(i.hls()||!e.canPlayType||f.indexOf("windows phone")!==-1||!b.isSupported())}};if(a.mode&&i[a.mode]!==-1)return!!i[a.mode]()&&a.mode;try{for(var j=-1,k=h.length;++j<k;)if(i[h[j]]())return h[j]}catch(l){}return!1}}),define("player/checkRequiredParams",[],function(){"use strict";var a=["el","talks"];return function(b,c){for(var d=!0,e=a.length;e--;)b[a[e]]||(c({type:"init",message:"Required option property is missing: "+a[e],severity:"fatal"}),d=!1);return d}}),define("player/throttle",["jquery"],function(a){"use strict";return function(b,c,d,e){var f,g=0;"boolean"!=typeof c&&(e=d,d=c,c=void 0);var h=function(){function a(){g=+new Date,d.apply(i,k)}function h(){f=void 0}var i=this,j=+new Date-g,k=arguments;e&&!f&&a(),f&&clearTimeout(f),void 0===e&&j>b?a():c!==!0&&(f=setTimeout(e?h:a,void 0===e?b-j:b))};return a.guid&&(h.guid=d.guid=d.guid||a.guid++),h}}),define("player/flashifySource",[],function(){"use strict";return function(a){return a+(a.indexOf("?")===-1?"?":"&")+"preroll=Blank&qr&network=tv"}}),define("player/getTalk",[],function(){"use strict";return function(a,b,c){var d,e=a.options.talks,f=e.length;for(c||(c=0);f--;)if(d=e[f],d.id==b)return e[f+c]}}),define("player/getLanguage",[],function(){"use strict";return function(a,b){if(!a.languages||!b)return!1;for(var c=a.languages.length;c--;)if(a.languages[c].languageCode===b)return a.languages[c];return!1}}),define("player/addHandlersFlash",["jquery","./flashifySource","./throttle","./getTalk","./getLanguage"],function(a,b,c,d,e){"use strict";var f=c(100,function(a,b){a("currentTime").publishUnique(b)}),g=c(100,function(a,b){a("postrollRemaining").publishUnique(b)});return function(c){function h(b,h){switch(b){case"player.error":c.throwError(a.extend({},h,{type:"flash"}));break;case"player.pause":m=!1,i("pause").publish();break;case"player.seeked":c._isFirstPlaying||i("seeked").publish();break;case"player.seeking":c._isFirstPlaying||(i("seeking").publish(),m&&(n=!0));break;case"player.play":c._isFirstPlaying=!1,i("ready.seekable").publish(),j&&(i("bufferPlayable").publish(),j=!1),m=!0,!c._isRequestedPlay&&n||i("play").publish(),n=!1,c._isRequestedPlay=!1;break;case"player.complete":m=!1,i("complete").publish(c.currentTalk);break;case"player.talk.complete":m=!1,i("talkComplete").publish(c.currentTalk);break;case"player.ready":i("ready.flashInterface").publish();break;case"player.loaded":i("ready.flashTalk").publish();var o=d(c,h.talkId),p=c.config.get("languageCode"),q=e(o,p);c.currentTalk=o,i("talk").publishUnique(o),q||!o.isSubtitleRequired&&o.nativeLanguage===c.options.nativeLanguage||(q=e(o,c.options.nativeLanguage)),q?(c.el.setLanguage(q.languageCode,q.isRtl),i("subtitle").publishUnique(q)):c.el.setLanguage(null,null),l&&c.el.playVideo(),l=!0;break;case"player.metadata":i("duration").publishUnique(h.duration);break;case"player.timeupdate":f(i,h.time);break;case"player.volumechange":var r=Math.round(1e3*+h.volume)/1e3;(r>0||!k)&&i("volume").publishUnique(r);break;case"player.ad.preroll.block":i("adBlock").publish(),i("prerollBlock").publish();break;case"player.ad.preroll.start":i("prerollStart").publish();break;case"player.ad.preroll.end":i("prerollComplete").publish();break;case"player.ad.postroll.start":i("postrollStart").publish();break;case"player.ad.postroll.end":i("postrollComplete").publish();break;case"player.ad.postroll.duration":i("postrollDuration").publish(h.duration);break;case"player.ad.postroll.remaining":g(i,h.time);break;case"player.buffer.empty":j||(j=!0,i("bufferUnplayable").publish());break;case"player.mouse.down":c.postrolling?i("postrollClick").publish():c.toggle();break;case"player.metrics":i("metricsData").publish(h);break;case"player.metrics.toggle":i("metricsToggle").publish()}}var i=c.topic,j=!1,k=c.config.get("muted");i("muted").subscribe(function(a){k=a}),i("ready.flashInterface").once(function(){var a=c.currentTalk||c.options.talks[0];c.currentTalk=a,c.el.load(a.id,b(a.resources.hls.stream),a.introDuration,a.adDuration,a.postAdDuration)}),i("ready.flashTalk").once(function(){i("ready.handlers").publish()});var l,m,n;window.onPlayerEvent=function(a,b){try{h(a,b)}catch(d){if(!d)return;c.throwError({message:d.message,stack:d.stack})}};var o=c.options.history,p=[];if(o&&o.length)for(var q=-1,r=o.length;++q<r;)window.onPlayerEvent.apply(p.slice.apply(o[q]))}}),define("player/isLastTalk",[],function(){"use strict";return function(a){return a.currentTalk.id===a.options.talks[a.options.talks.length-1].id}}),define("player/addHandlersVideo",["jquery","./throttle","./isLastTalk"],function(a,b,c){"use strict";function d(a){var b=a.topic,c={};b("play").subscribe(function(){c={}}),b("talkComplete.unnormalized").subscribe(function(){var d=a.currentTalk||{};c.id&&d.id==c.id||b("talkComplete").publish(d),c=d})}return function(c){var e=c.topic,f=c.el,g=a(f);d(c),a.each(["play","seeked","seeking"],function(a,b){g.on(b,function(){e(b).publish()})}),g.on("pause",function(){c._isSourcing||e("pause").publish()}),g.on("canplay",function(){var a;return function(){a&&f.play(),a=!0}}()),g.on("timeupdate",b(100,function(){e("currentTime").publishUnique(f.currentTime)})),g.on("durationchange",function(){e("duration").publishUnique(f.duration)}),g.on("ended",function(){e("talkComplete.unnormalized").publish(),e("complete").publish(c.currentTalk)}),g.on("volumechange",function(){e("volume").publishUnique(Math.round(1e3*+f.volume)/1e3),e("muted").publishUnique(f.muted)}),g.on("webkitpresentationmodechanged",function(a,b){e("popOut").publishUnique("picture-in-picture"===a.target.webkitPresentationMode)}),g.on("loadedmetadata",function(){e("ready.seekable").publish()})}}),define("player/addHandlersHls",["jquery","./handleError"],function(a,b){"use strict";function c(d){var f=d.el,g=d.topic;a(f).on("error",function(a){b({context:"hls",error:"Error playing video",currentTime:f.currentTime,src:f.src,code:f.error?f.error.code:void 0})});var h;g("talk").subscribe(function(a){h!==a.id&&(e(d),h=a.id)}),g("currentTime").subscribe(c.checkAdEvents)}function d(a){var b=new Image;b.src=a}function e(e){function f(a){m.push(c.createAdEvent(a))}var g=e.topic;c.adEvents=[];var h;try{h=e.currentTalk.resources.hls.metadata}catch(i){return void e.throwError({type:"init",message:"Missing HLS metadata for current talk.",severity:"fatal"})}var j={},k=e.vastAd;if(k)j=k.sponsor(),k.topic("companion").subscribe(function(a){g("ad").publish(a)});else if(!e.options.mai)return void e.throwError({type:"hls",message:"Error retrieving VAST ad on talk change."});var l=e.maiAd,m=[];a.getJSON(h,j).then(function(a){var b=a.timing;f({startsAt:Math.floor(b.outro.end)-1,onFirstStart:function(){k&&k.impressionUrl().forEach(d)}}),f({startsAt:8,endsAt:12,onFirstStart:function(){k&&k.prerollUrl().forEach(d),l&&l.prerollImpressions.forEach(d)},onEveryStart:function(){g("prerollStart").publish()},onEveryEnd:function(){g("prerollComplete").publish()}}),b.ad&&(f({startsAt:Math.floor(b.ad.start),endsAt:Math.floor(b.ad.end),onFirstStart:function(){k&&(k.startUrl().forEach(d),k.creativeViewUrl().forEach(d)),l&&l.postrollQ0Impressions.forEach(d)},onEveryStart:function(){g("talkComplete.unnormalized").publish(),g("postrollStart").publish()},onEveryEnd:function(){g("postrollComplete").publish()}}),f({startsAt:Math.floor(b.ad.start+(b.ad.end-b.ad.start)/4),endsAt:Math.floor(b.ad.end),onFirstStart:function(){k&&k.firstQuartileUrl().forEach(d),l&&l.postrollQ1Impressions.forEach(d)}}),f({startsAt:Math.floor(b.ad.start+(b.ad.end-b.ad.start)/2),endsAt:Math.floor(b.ad.end),onFirstStart:function(){k&&k.midpointUrl().forEach(d),l&&l.postrollQ2Impressions.forEach(d)}}),f({startsAt:Math.floor(b.ad.start+3*(b.ad.end-b.ad.start)/4),endsAt:Math.floor(b.ad.end),onFirstStart:function(){k&&k.thirdQuartileUrl().forEach(d),l&&l.postrollQ3Impressions.forEach(d)}}),f({startsAt:Math.floor(b.ad.end)-1,endsAt:Math.floor(b.ad.end),onFirstStart:function(){k&&k.completeUrl().forEach(d),l&&l.postrollQ4Impressions.forEach(d)}})),c.adEvents=m}).fail(function(a,c,d){b({context:"hls",error:"Error retrieving HLS metadata",status:c,uri:h,query:j})})}function f(a){a.isCurrent||(a.onEveryStart(),a.hasEverStarted||(a.onFirstStart(),a.hasEverStarted=!0),a.isCurrent=!0)}function g(a){a.isCurrent&&(a.onEveryEnd(),a.hasEverEnded||(a.onFirstEnd(),a.hasEverEnded=!0),a.isCurrent=!1)}return c.adEvents=[],c.createAdEvent=function(b){return a.extend({startsAt:0,endsAt:-1,onFirstStart:a.noop,onFirstEnd:a.noop,onEveryStart:a.noop,onEveryEnd:a.noop},b,{isCurrent:!1,hasEverStarted:!1,hasEverEnded:!1})},c.checkAdEvents=function(a){for(var b,d=c.adEvents,e=d.length,h=0;h<e;h++)b=d[h],a>=b.startsAt&&(a<b.endsAt||b.endsAt===-1)?f(b):b.isCurrent&&g(b)},c}),define("player/addHandlers",["./throttle","./addHandlersFlash","./addHandlersVideo","./addHandlersHls","./isLastTalk"],function(a,b,c,d,e){"use strict";function f(b){var c,d,e=a(100,function(){c&&d&&b("progress").publishUnique(c/d)});b("currentTime").subscribe(function(a){c=a,e()}),b("duration").subscribe(function(a){d=a,c=0,e()}),b("progress").publish(0)}return function(a){var g=a.mode,h=a.topic;switch(g){case"flash":b(a);break;case"h264":c(a);break;case"hls":c(a),d(a);break;case"hlsjs":c(a),d(a);break;default:return void a.throwError({type:"init",message:"No handlers found for unrecognized player mode: "+g,severity:"fatal"})}"flash"!==g&&h("ready.handlers").publish(),a.options.talks[0]&&h("duration").publish(a.options.talks[0].duration),h("duration").subscribe(function(b){a.currentTalk?a.currentTalk.duration=b:a.options.talks[0].duration=b}),h("complete").subscribe(function(){e(a)?h("ended").publish(a.currentTalk):a.playNext()}),h("popOut").subscribe(function(b){a.config.set("popOut",b)}),h("play").once(function(){a.config.get("popOut")&&a.popOut(!0)}),f(h),h("postrollStart").subscribe(function(){a.postrolling=!0}),h("postrollComplete").subscribe(function(){a.postrolling=!1}),h("talk").subscribe(function(){a.postrolling=!1})}}),define("player/actionsFlash",["jquery","./flashifySource","./getTalk","./getLanguage"],function(a,b,c,d){"use strict";var e={};return a.each({pause:"pauseVideo",seek:"seek",sendAds:"sendAds",capQualityToStage:"capQualityToStage"},function(a,b){e[a]=function(){var a=this.el[b];a&&a.apply(this.el,[].slice.call(arguments))}}),e.play=function(){this._isRequestedPlay=!0,this.lastPlayedTalkId==(this.currentTalk&&this.currentTalk.id)?this.el.resumeVideo():(this._isFirstPlaying=!0,this.el.playVideo())},e.playTalk=function(a){var d=c(this,a);d&&this.currentTalk!=d?(this._isFirstPlaying=!0,this.currentTalk=d,this.el.load(d.id,b(d.resources.hls.stream),d.introDuration,d.adDuration,d.postAdDuration)):this.play()},e.mute=function(a){this.el.volume(a?0:this.config.get("volume"))},e.subtitle=function(a){var b=d(this.currentTalk,a);b?this.el.setLanguage(b.languageCode,b.isRtl):this.el.setLanguage(null,null),this.config.set("languageCode",!!b&&b.languageCode),this.topic("subtitle").publishUnique(b)},e.volume=function(a){this.el.volume(a)},e._playbackRate=function(){},e}),define("player/actionsH264",["jquery","./getTalk"],function(a,b){"use strict";var c={};return c.play=function(){this.topic("talk").publishUnique(this.currentTalk),this.el.play()},c.pause=function(){this.el.pause()},c.playTalk=function(a){var c=b(this,a);c&&(this.currentTalk=c,this.topic("talk").publishUnique(c),this.el.src=c.resources.h264[0].file)},c.mute=function(a){this.el.muted=a},c.seek=function(a){this.el.currentTime=a},c.volume=function(a){this.el.volume=a},c._playbackRate=function(a){this.el.playbackRate=a},c}),define("player/actionsHls",["jquery","./getTalk","./hlsInitTalk"],function(a,b,c){"use strict";var d={};return d.play=function(){this.topic("talk").publishUnique(this.currentTalk),this.el.play()},d.pause=function(){this.el.pause()},d.playTalk=function(a){var d=b(this,a),e=this.topic,f=this.el;d&&this.currentTalk!=d?(this.currentTalk=d,c(this,f).done(function(){f.play()}).always(function(){e("talk").publishUnique(d)})):this.play()},d.playNext=function(){var a=b(this,this.currentTalk.id,1);a&&this.playTalk(a.id)},d.playPrev=function(){var a=b(this,this.currentTalk.id,-1);a&&this.playTalk(a.id)},d.mute=function(a){this.el.muted=a},d.seek=function(a){this.el.currentTime=a},d.volume=function(a){this.el.volume=a},d._playbackRate=function(a){this.el.playbackRate=a},d._setSource=function(a){this._isSourcing=!0,this.el.src=a,this._isSourcing=!1},d}),define("player/actionsHlsjs",["jquery","hlsjs","./actionsHls"],function(a,b,c){"use strict";var d={};return a.extend(d,c),d._setSource=function(a){var c=this;c._isSourcing=!0,c.hlsjs&&c.hlsjs.destroy(),c.hlsjs=new b,c.hlsjs.on(b.Events.MANIFEST_PARSED,function(){c._isSourcing=!1});var d=null;c.hlsjs.on(b.Events.ERROR,function(a,e){var f=!1,g=!1,h="Unknown error.";switch(e.details){case b.ErrorDetails.BUFFER_FULL_ERROR:case b.ErrorDetails.BUFFER_SEEK_OVER_HOLE:case b.ErrorDetails.BUFFER_STALLED_ERROR:case b.ErrorDetails.FRAG_LOAD_ERROR:g=!e.fatal}if(!g){switch(e.type){case b.ErrorTypes.NETWORK_ERROR:h="Network error.",e.fatal&&(d=h,h+=" Attempting recovery.",c.hlsjs.startLoad());break;case b.ErrorTypes.MEDIA_ERROR:h="Media error.",e.fatal&&(d=h,h+=" Attempting recovery.",c.hlsjs.recoverMediaError());break;default:e.fatal&&(f=!0,h=d,d=null)}e.details&&(h+=" ErrorDetails: "+e.details),c.throwError({type:"hlsjs",message:h,severity:f?"fatal":"warning"})}}),c.hlsjs.loadSource(a),c.hlsjs.attachMedia(c.el)},d}),define("player/getFullScreenActions",["jquery"],function(a){"use strict";function b(b){function c(){b.topic("enterFullScreen").publish(),b.isFullScreen=!0}function d(){b.topic("exitFullScreen").publish(),b.isFullScreen=!1}var e=document,g=b.fullScreenMode,h=f[g];"webkitVideo"===g?(a(b.el).on("webkitbeginfullscreen",c),a(b.el).on("webkitendfullscreen",d)):h&&a(e).on(h.change,function(){e[h.element]===b.fullScreenElement?c():!e[h.element]&&b.isFullScreen&&d()})}function c(a){function b(){c.webkitEnterFullscreen()}var c=a.el;c.readyState>=1?b(a):(c.addEventListener("loadedmetadata",b,!1),a.play())}function d(a){var b=a.fullScreenMode,c=window.document;"webkitVideo"===b?a.el.webkitExitFullscreen():f[b]&&c[f[b].cancel]()}function e(a){var b=a.fullScreenMode;"webkitVideo"===b?c(a):f[b]?a.fullScreenElement[f[b].request]():a.throwError({type:"client",message:"Full screen mode not supported",severity:"warning"})}var f={standard:{cancel:"cancelFullScreen",change:"fullscreenchange",enabled:"fullscreenEnabled",error:"fullscreenerror",element:"fullscreenElement",request:"requestFullScreen"},moz:{cancel:"mozCancelFullScreen",change:"mozfullscreenchange",enabled:"mozFullScreenEnabled",error:"mozfullscreenerror",element:"mozFullScreenElement",request:"mozRequestFullScreen"},ms:{cancel:"msExitFullscreen",change:"MSFullscreenChange",enabled:"msFullscreenEnabled",error:"MSFullscreenError",element:"msFullscreenElement",request:"msRequestFullscreen"},webkit:{cancel:"webkitCancelFullScreen",change:"webkitfullscreenchange",enabled:"webkitFullscreenEnabled",error:"webkitfullscreenerror",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen"}};return function(a){return b(a),{requestFullScreen:function(b){a.fullScreenElement||(a.fullScreenElement=b||a.el),e(a)},cancelFullScreen:function(){d(a)}}}}),define("player/addActions",["jquery","./actionsFlash","./actionsH264","./actionsHls","./actionsHlsjs","./getTalk","./getFullScreenActions"],function(a,b,c,d,e,f,g){"use strict";var h={flash:b,h264:c,hls:d,hlsjs:e};return function(a){function b(b){for(var c=-1,d=b.length;++c<d;)b[c].callback.apply(a,b[c].args)}function c(b){return function(){var c=[].slice.call(arguments);return j?b.apply(a,c):i.push({callback:b,args:c}),a}}var d=a.mode,e=h[d],i=[],j=!1;if(!e)return void a.throwError({type:"init",message:"No actions found for unrecognized player mode: "+d,severity:"fatal"});a.topic("ready").once(function(){j=!0,b(i)}),a.topic("play").subscribe(function(){a.lastPlayedTalkId=a.currentTalk&&a.currentTalk.id}),e.play=function(){var b=e.play,c=!1;return a.topic("ended").subscribe(function(){c=!0}),a.topic("play").subscribe(function(){c=!1}),function(){c&&e.seek(0),b.call(a)}}(),e.playNext=function(){var b=f(a,a.currentTalk.id,1);b&&a.playTalk(b.id)},e.playPrev=function(){var b=f(a,a.currentTalk.id,-1);b&&a.playTalk(b.id)},e.playbackRate=function(b){a.topic("playbackRate").publish(b)},e.popOut=function(b){a.canPopOut&&a.el.webkitSetPresentationMode&&a.el.webkitSetPresentationMode(b?"picture-in-picture":"inline")},e.volume=function(){var b=e.volume;return function(c){c=Math.round(1e3*+c)/1e3,c<0&&(c=0),c>1&&(c=1),b.call(a,c),a.topic("volume").publishUnique(c)}}(),e.mute=function(){var b=e.mute;return function(c){c=!!c,b.call(a,c),a.topic("muted").publishUnique(c)}}(),e.seek=function(){var b=e.seek,c=0;return a.topic("duration").subscribe(function(a){c=a}),function(d){d=+d,d<0&&(d=0),d>c&&(d=c),b.call(a,d)}}(),e.seek=function(){var b=e.seek,c=!1,d=!1;return a.topic("ready.seekable").once(function(){c!==!1&&b.call(a,c),d=!0}),function(e){d?b.call(a,e):c=e}}(),e.toggle=function(){a.paused?a.play():a.pause()};var k=g(a);e.requestFullScreen=k.requestFullScreen,e.cancelFullScreen=k.cancelFullScreen;for(var l in e)e.hasOwnProperty(l)&&(a[l]=c(e[l]))}}),define("player/addProperties",[],function(){"use strict";function a(){return e.requestFullScreen?!!d.fullscreenEnabled&&"standard":e.mozRequestFullScreen?!!d.mozFullScreenEnabled&&"moz":e.webkitRequestFullScreen?!!d.webkitFullscreenEnabled&&"webkit":e.webkitEnterFullscreen?"webkitVideo":!!e.msRequestFullscreen&&(!!d.msFullscreenEnabled&&"ms")}function b(){return!(!e.playbackRate||e.playbackRate!==e.defaultPlaybackRate)}function c(){return"function"==typeof e.webkitSupportsPresentationMode}var d=document,e=d.createElement("video");return function(d){d.fullScreenMode=a(),d.canFullScreen=d.fullScreenMode!==!1,d.canPopOut="flash"!==d.mode&&c(),d.mode=d.options.mode,d.talks=d.options.talks,d.canPlaybackRate=("hls"===d.mode||"hlsjs"===d.mode||"h264"===d.mode)&&b(),d.postrolling=!1,d.paused=!0,d.on("play",function(){d.paused=!1}).on("pause",function(){d.paused=!0})}}),define("player/addPlaybackRate",[],function(){"use strict";var a=1;return function(b){function c(){return b.config.get("playbackRate")}function d(){g?b._playbackRate(a):b._playbackRate(c())}function e(){g=!1,d()}function f(){g=!0,d()}var g=!1;b.on("ready",function(){b.playbackRate(c())}),b.on("play",d),b.on("prerollStart",f),b.on("postrollStart",f),b.on("prerollComplete",e),b.on("postrollComplete",e),b.on("playbackRate",function(a){b.config.set("playbackRate",a),d()})}}),define("player/addVolume",[],function(){"use strict";return function(a){var b=!1;a.on("ready",function(){a.volume(a.config.get("volume")),a.mute(a.config.get("muted"))}).on("muted",function(c){b=c,a.config.set("muted",c)}).on("volume",function(c){a.config.set("volume",c),c>0&&b&&a.mute(!1)})}}),define("player/augmentTalks",[],function(){"use strict";return function(a){if(!a||!a.length)return[];for(var b,c=a.length,d=c;d--;)b=a[d],b.index=d;return a}}),define("player/addInitPromise",["jquery"],function(a){"use strict";return function(b){var c=new a.Deferred;b.on("error",function(a){c.rejectWith(b,[a])}),b.on("ready",function(){"pending"===c.state()&&c.resolveWith(b,[b])}),a.extend(b,c.promise())}}),define("player/addThrower",["jquery","./handleError"],function(a,b){"use strict";return function(c){var d=!0;c.one("play",function(){d=!1}),c.throwError=function(e){e=a.extend({type:"unknown",message:null,severity:"warning"},e||{}),d&&"fatal"===e.severity&&(e.severity="abortive"),b(a.extend({context:"ted_player_wrapper"},e)),c.topic("error").publish(e)}}}),define("player/Config",["jquery"],function(a){"use strict";function b(a){return!!(a&&a.getItem&&a.setItem&&window.JSON&&JSON.parse&&JSON.stringify)}function c(c,d){if(b(c)){var e=c.getItem(d);if("string"===a.type(e)&&(e=JSON.parse(e),"object"===a.type(e)))return e}return{}}function d(c,d,e){b(c)&&"object"===a.type(e)&&c.setItem(d,JSON.stringify(e))}function e(a){this._options=a,this._inited=!1}return a.extend(e.prototype,{_init:function(){this._inited||(this.internal=a.extend({},this._options.defaults,c(this._options.storageAdapter,this._options.storageProperty)),this._inited=!0)},get:function(a){return this._init(),this.internal[a]},set:function(a,b){this._init(),this.internal[a]=b,d(this._options.storageAdapter,this._options.storageProperty,this.internal)}}),e}),define("player/Player",["jquery","./topicFactory","./replaceElement","./getSupportedMode","./checkRequiredParams","./addHandlers","./addActions","./addProperties","./addPlaybackRate","./addVolume","./augmentTalks","./isLastTalk","./addInitPromise","./addThrower","./Config"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(l){var p=this;this.topic=b({bufferPlayable:void 0,bufferUnplayable:void 0,play:void 0,pause:void 0,prerollStart:void 0,prerollBlock:void 0,postrollStart:void 0,postrollEnd:void 0,adBlock:void 0,seeked:void 0,seeking:void 0}),n(p);var q=!1;this.topic("error").subscribe(function(a){"abortive"===a.severity&&(q=!0)}),m(p),l=a.extend({},t,l),e(l,p.throwError),l.mode=d(l),l.mode||p.throwError({type:"client",message:"Client does not support any player mode.",severity:"fatal"}),l.talks=k(l.talks),l.talks.length||p.throwError({type:"init",message:"No talks sent to player.",severity:"fatal"}),this.options=l,this.config=new o(a.extend({defaults:{languageCode:!1,muted:!1,volume:l.defaultVolume,playbackRate:l.defaultPlaybackRate,popOut:!1}},l)),h(this),g(p),j(p),i(p),q||(this.topic("ready.dom").once(function(){window.setTimeout(function(){f(p),p.topic("ready.handlers").once(function(){q||p.topic("ready").publish()})},10)}),c(this))}var q,r=function(){var a=document.createElement("video");return a&&a.defaultPlaybackRate?a.defaultPlaybackRate:1}();try{q=window.localStorage}catch(s){}var t={attrs:{},defaultPlaybackRate:r,defaultVolume:.5,el:null,flashVersion:"11.1.0",mai:!1,maiAdUnitId:null,maiPostrollType:"stitched",modes:void 0,nativeLanguage:"en",storageAdapter:q,storageProperty:"playerconfig",swf:"assets/player.swf"};a.extend(p.prototype,{on:function(a,b){return this.topic(a).subscribe(b),this},one:function(a,b){return this.topic(a).once(b),this},isLastTalk:function(){return l(this)}});b();return p}),define("jqueryui/core",["jquery"],function(a){return function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g))):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e);
})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(a),a}),define("lib/focus-zone",["jquery","lodash","jqueryui/core"],function(a,b){"use strict";function c(b){this.$el=a(b)}function d(a){a.preventDefault()}var e=a(window);return c.__reset=function(){b.assign(c,{__active:void 0,__isListening:!1,__zones:[]})},c.__addZone=function(a){c.__zones.push(a),c.__setActive(),c.__startListening()},c.__removeZone=function(a){c.__zones=b.without(c.__zones,a),c.__setActive(),c.__stopListening()},c.__setActive=function(){c.__active=b.last(c.__zones)},c.__startListening=function(){c.__isListening||c.__active&&(c.__startListeningInner(),c.__isListening=!0)},c.__startListeningInner=function(){e.on("keydown",c.__keyDown)},c.__stopListening=function(){c.__isListening&&(c.__active||(c.__stopListeningInner(),c.__isListening=!1))},c.__stopListeningInner=function(){e.off("keydown",c.__keyDown)},c.__keyDown=function(e){var f=c.__active;if(f&&e.keyCode===a.ui.keyCode.TAB){var g=e.target,h=f.$el,i=h.find(":tabbable"),j=i.filter(":first"),k=i.filter(":last");g!==k[0]&&g!==h[0]||e.shiftKey?g!==j[0]&&g!==h[0]||!e.shiftKey?b.indexOf(i,g)===-1&&(j.focus(),d(e)):(k.focus(),d(e)):(j.focus(),d(e))}},b.assign(c.prototype,{activate:function(){return this._recordFocus(),c.__addZone(this),this},deactivate:function(){return c.__removeZone(this),this._restoreFocus(),this},_recordFocus:function(){this.$focus=a(":focus")},_restoreFocus:function(){this.$focus&&this.$focus.length&&this.$focus.focus()}}),c.__reset(),c}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("spinjs",b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;if(void 0!==e[b])return b}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):void(this.opts=f(a||{},i.defaults,o))}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i}),define("widgets/hover",["jquery","lodash","jqueryui/widget"],function(a,b){"use strict";function c(a,b,c){return Math.abs(a[0]-b[0])>c||Math.abs(a[1]-b[1])>c}function d(a){a._hoverIsTouchTriggered=!1}var e=a(document);a.widget("ted.hover",{options:{hoverIdleDelay:4e3,hoverStartDelay:200,hoverStopDelay:400,hoverSwipeTolerance:5},hoverState:function(a){return b.isUndefined(a)||this._hoverChangeState(null,!!a),this._hoverIsOn},_hoverIsClicking:!1,_hoverIsOn:!1,_hoverIsTouchTriggered:!1,_hoverLastCoords:null,_hoverStartTimeout:null,_hoverIdleTimeout:null,_hoverStopTimeout:null,_hoverChangeStateBound:null,_hoverMoveChangeBound:null,_hoverMouseMoveThrottled:null,_hoverTouchOutBound:null,_create:function(){this._hoverInit()},_hoverEvents:function(){return{mouseenter:this._hoverMouseMoveThrottled,mousemove:this._hoverMouseMoveThrottled,mouseleave:this._hoverOut,touchstart:this._hoverTouchStart,touchend:this._hoverTouchEnd,touchmove:this._hoverTouchMove,touchcancel:this._hoverTouchCancel,mousedown:this._hoverMouseDown,mouseup:this._hoverMouseUp,click:this._hoverMouseClick}},_hoverMove:function(a){this._hoverIsOn?this._hoverMoveChange(a):this._hoverStartSetTimeout(a)},_hoverMoveChange:function(a){var b={x:a.pageX||null,y:a.pageY||null};"mousedown"!==a.type&&"touchstart"!==a.type&&this._hoverLastCoords&&b.x&&b.x===this._hoverLastCoords.x&&b.y===this._hoverLastCoords.y||(this._hoverLastCoords=b,this._hoverChangeState(a,!0),this._hoverIdleSetTimeout(a))},_hoverOut:function(a){this._hoverStartClearTimeout(),this._hoverStopSetTimeout(a)},_hoverMouseClick:function(a){this._hoverIsTouchTriggered||this._hoverIsOn&&this._trigger("tap",a)},_hoverMouseDown:function(){this._hoverIsTouchTriggered||(this._hoverIsClicking=!0,this._hoverIdleClearTimeout())},_hoverMouseMove:function(a){this._hoverIsTouchTriggered||this._hoverMove(a)},_hoverMouseUp:function(a){this._hoverIsTouchTriggered||(this._hoverIsClicking=!1,this._hoverIdleSetTimeout(a))},_hoverTouchStart:function(){this._hoverIsTouchTriggered=!0,this._hoverTouchStartCoords=null,this._hoverTouchEndCoords=null},_hoverTouchEnd:function(a){this._hoverTouchSafetyTimeout&&window.clearTimeout(this._hoverTouchSafetyTimeout),this._hoverTouchSafetyTimeout=b.delay(d,600,this),this._hoverTouchEndCoords&&c(this._hoverTouchStartCoords,this._hoverTouchEndCoords,this.options.hoverSwipeTolerance)||(this._hoverIsOn&&this._trigger("tap",a),this._hoverMoveChange(a))},_hoverTouchCancel:function(a){a.preventDefault()},_hoverTouchMove:function(a){var b=a.originalEvent.touches[0],c=[b.pageX,b.pageY];null===this._hoverTouchStartCoords?this._hoverTouchStartCoords=c:this._hoverTouchEndCoords=c,this._hoverIsOn&&this._hoverMove(a)},_hoverTouchOut:function(b){a(b.target).closest(this.element).length||this._hoverChangeState(b,!1)},_hoverChangeState:function(a,b){b=!!b,this._hoverIdleClearTimeout(),this._hoverStartClearTimeout(),this._hoverStopClearTimeout(),!b&&this._hoverIsClicking||b!==this._hoverIsOn&&(this._hoverIsOn=b,this[b?"_hoverStart":"_hoverStop"](a),b?this._on(e,{touchstart:this._hoverTouchOutBound}):this._off(e,"touchstart"))},_hoverStartSetTimeout:function(a){this._hoverStartTimeout||(this._hoverStartTimeout=b.delay(this._hoverMoveChangeBound,this.options.hoverStartDelay,a))},_hoverStartClearTimeout:function(){this._hoverStartTimeout&&(window.clearTimeout(this._hoverStartTimeout),this._hoverStartTimeout=null)},_hoverStopSetTimeout:function(a){this._hoverStopClearTimeout(),this._hoverStopTimeout=b.delay(this._hoverChangeStateBound,this.options.hoverStopDelay,a,!1)},_hoverStopClearTimeout:function(){this._hoverStopTimeout&&(window.clearTimeout(this._hoverStopTimeout),this._hoverStopTimeout=null)},_hoverIdleSetTimeout:function(a){this._hoverIdleClearTimeout(),!this._hoverIsClicking&&this.options.hoverIdleDelay&&(this._hoverIdleTimeout=b.delay(this._hoverChangeStateBound,this.options.hoverIdleDelay,a,!1))},_hoverIdleClearTimeout:function(){this._hoverIdleTimeout&&(window.clearTimeout(this._hoverIdleTimeout),this._hoverIdleTimeout=null)},_hoverInit:function(){this._hoverChangeStateBound=b.bind(this._hoverChangeState,this),this._hoverMoveChangeBound=b.bind(this._hoverMoveChange,this),this._hoverTouchOutBound=b.bind(this._hoverTouchOut,this),this._hoverMouseMoveThrottled=b.throttle(b.bind(this._hoverMouseMove,this),100,{leading:!0,trailing:!1}),this._on(this._hoverEvents())},_hoverDestroy:function(){this._off(this._hoverEvents())},_hoverStart:function(a){this._trigger("start",a)},_hoverStop:function(a){this._trigger("stop",a)}})}),define("widgets/player",["jquery","lodash","widgets/player/ga-tracker","widgets/player/ted-tracker","widgets/player/cs-tracker","lib/abby","utils/f","utils/is_mobile","utils/query_param","utils/ted","player/Player","lib/browserDetect","lib/pubSub","lib/focus-zone","Cookies","spinjs","jqueryui/widget","widgets/hover","lib/resize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(){return i("playerMode")||null}function r(a){a.preventDefault(),a.stopPropagation()}var s="player",t=s+"--paused",u=s+"--playing",v=s+"--fullscreen",w=s+"--uncropped",x=s+"--show-cursor",y=s+"__container",z=y+"__cursor-killer",A=y+"__focus",B=y+"__placeholder",C=y+"__video",D=a("<div></div>"),E=b.once(function(c,d){window.onYouTubeIframeAPIReady=b.bind(c,d),a.getScript("//www.youtube.com/iframe_api")});return a.widget("ted.player",a.ted.hover,{options:{breakpoint:!0,currentTalk:null,flashVars:{},metricsKey:null,mai:!1,maiAdUnitId:null,maiPostrollType:"stitched",mode:q(),nativeLanguage:"en",startTrackingAt:0,swf:j("playerPath"),talks:null,hideCursorDelay:1e3,uncropped:!0,soonThreshold:.1,recordInIdentity:!0},_isPlayerInitialized:!1,_isPlaying:!1,_addElements:function(){var a=this.element.find("div."+y);a.length||(a=D.clone().addClass(y).appendTo(this.element));var b=a.find("div."+B);b.length||(b=D.clone().addClass(B).appendTo(a)),b.wrap(D.clone().addClass(A));var c=b.closest("div."+A).addClass(C).attr({href:"#",role:"button",title:"Play/Pause"}),d=a.find("div."+z);d.length||(d=D.clone().addClass(z).appendTo(a)),this.elements={container:a,focal:c,placeholder:b,cursorKiller:d}},_breakpoint:function(a){this.options.breakpoint&&(a<1024?this.video.attr("controls","controls"):this.video.removeAttr("controls"))},_create:function(){this.options.currentTalk||(this.options.currentTalk=this.options.talks[0]),this._on({playerplay:function(){this._isPlaying=!0,this.element.addClass(u).removeClass(t)},playerpause:function(){this._isPlaying=!1,this.element.addClass(t).removeClass(u)},playerended:function(){this._isPlaying=!1,this.element.removeClass(t).removeClass(u)}}),this._isInternal=!this.talk().external,this.options.hoverStopDelay=this.options.hideCursorDelay,new c(this),new d(this),new e(this),this._initializePlayer()},_initializePlayer:function(){this._isPlayerInitialized||(this._isPlayerInitialized=!0,this.element.addClass(s+" "+(this.options.uncropped?w:"")),this._addElements(),this._isInternal?this._initializeInternalPlayer():"YouTube"===this.talk().external.service&&this._initializeYouTubePlayer(),this._hoverInit())},_initializeYouTubePlayer:function(){E(this._youTubeApiReady,this),this._on({playerrequestplay:function(){this._ytPlayer&&this._ytPlayer.playVideo&&this._ytPlayer.playVideo()}})},_youTubeApiReady:function(){var b=this,c=this.talk(),d="//www.youtube.com/embed/"+c.external.code+"?showinfo=0&enablejsapi=1&autoplay=0&origin="+location.origin;c.external.startTime&&(d+="&start="+c.external.startTime);var e=a("<iframe class="+C+" src="+d+" frameborder=0 allowfullscreen></iframe>");b.elements.placeholder.replaceWith(e),b._ytPlayer=new YT.Player(e.get(0),{events:{}}),b._trigger("domready")},_getPlayerModes:function(){var a=!1;return a=a||"Firefox"===l.browser&&l.version>47,a=a||String((window.navigator||{}).userAgent).indexOf("Android")!==-1,b.filter(["flash","hls",a&&"hlsjs","h264"])},_initializeInternalPlayer:function(){var c=i("dfptest"),d=i("maiAdUnitId");d&&(this.options.mai=!0,this.options.maiAdUnitId=d);var e=i("maiPostrollType");e&&(this.options.maiPostrollType=e),this.options.talks=this.options.talks.map(function(a){if(c){var b=encodeURIComponent(c);a.resources.hls.adUrl=a.resources.hls.adUrl.replace(/(cust_params=[^&]+)&/,"$1%26dfptest%3D"+b+"&"),a.resources.hls.maiTargeting.dfptest=c}var d=Number(a.introDuration);return a.introDuration=Math.min(d,11.82),a.adDuration=0===d?0:3.33,a.postAdDuration=0===d?0:.83,a});var f={"class":C,playsinline:"playsinline"};this.player=new k({attrs:f,el:this.elements.placeholder.get(0),flashVars:this.options.flashVars,mai:this.options.mai,maiAdUnitId:this.options.maiAdUnitId,maiPostrollType:this.options.maiPostrollType,metricsKey:this.options.metricsKey,mode:this.options.mode,modes:this._getPlayerModes(),nativeLanguage:this.options.nativeLanguage,swf:this.options.swf,talks:this.options.talks}),this.element.addClass(s+"--"+this.mode()),h()&&this.element.addClass(s+"--is-mobile"),this._subscribeToPlayerEvents(),this._subscribeToKeyboardEvents(),this.player.one("ready.dom",b.bind(this._playerDomReady,this)),this.player.canFullScreen&&(this.player.on("enterFullScreen",b.bind(this._playerEnterFullScreen,this)),this.player.on("exitFullScreen",b.bind(this._playerExitFullScreen,this))),this.player.on("talk",b.bind(function(a){this.options.currentTalk=a,this._trigger("talk",null,a)},this)),this.player.on("bufferUnplayable",b.bind(this._bufferingStarted,this)),this.player.on("bufferPlayable",b.bind(this._bufferingStopped,this)),this._on({playercurrenttime:function(a,b){this._currentTime=b.currentTime},playerplaybackrate:function(a,b){this._playbackRate=b.playbackRate},playerpopout:function(a,b){this._popOut=b.popOut},playervolume:function(a,b){this._volume=b.volume},playerprogress:function(){var a;return function(b,c){!a&&c.progress>1-this.options.soonThreshold&&this.player.isLastTalk()&&(a=!0,this._trigger("soon"))}}(),playerpostrollcomplete:function(){this.player.isLastTalk()&&!this._queuedTalkId&&(this._queuedTalkId=this.options.currentTalk.id)},playerrequestplay:function(){var c=a("*:focus");c.closest(this.elements.focal).length||(this._oldFocus=c),this.elements.focal.attr("tabindex","1"),this._queuedTalkId?(a(this.player.el).attr("preload",""),this.player.playTalk(this._queuedTalkId),this._queuedTalkId=null,b.delay(g(this.player,"play"))):this.player.play()},playerplay:function(){this.elements.focal.focus()},playerrequestpause:function(){this.player.postrolling||this.player.pause()}})},_destroy:function(){this.options.breakpoint&&m("breakpoint").unsubscribe(this._breakpoint)},_playerDomReady:function(){var c=a(this.player.el);this.video=c,this.options.breakpoint&&m("breakpoint").subscribe(b.bind(this._breakpoint,this)),this._trigger("domready")},_playerEnterFullScreen:function(){this.element.addClass(v),this._fullscreenZone("activate")},_playerExitFullScreen:function(){this.element.removeClass(v),this._fullscreenZone("deactivate")},_playerOption:function(a){return this.player&&this.player.options&&this.player.options[a]||null},_subscribeToKeyboardEvents:function(){this._on(this.elements.focal,{keydown:this._keyDown,keyup:this._keyUp})},_subscribeToPlayerEvents:function(){var a,c=this;this._on({playerrequestplay:function(){a=!0},playerplay:function(){a=!1}}),b.forEach(["ad","currentTime","duration","ended","enterFullScreen","error","exitFullScreen","pause","play","progress","ready","seeked","seeking","volume","muted","idle","complete","talkComplete","prerollStart","prerollBlock","postrollStart","postrollComplete","postrollDuration","postrollRemaining","adBlock","bufferPlayable","bufferUnplayable","subtitle","playbackRate","popOut","metricsData","metricsToggle"],function(b){c.player.on(b,function(d){var e={};"play"!==b||a||c._trigger("requestplay"),e[b]=d,c._trigger(b,null,e),c["_"+b]=d})})},_hoverStart:function(a){this.element.addClass(x),this._trigger("hoverstart",a)},_hoverStop:function(a){this.element.removeClass(x),this._trigger("hoverstop",a)},_bufferingStarted:function(){this._spinner||(this._spinner=new p({lines:13,length:13,width:5,radius:16,color:"#FFF",trail:50,shadow:!0})),this._spinner.spin(this.element.get(0))},_bufferingStopped:function(){this._spinner.stop()},_keyDown:function(b){var c=a.ui.keyCode,d=b.ctrlKey||b.shiftKey||b.altKey,e=this,f=e.options.currentTalk&&e.options.currentTalk.duration||0,g=e._currentTime||0,h=e.volume()||0;switch(b.keyCode){case c.ENTER:case c.NUMPAD_ENTER:case c.SPACE:e.toggle(),r(b);break;case c.DOWN:d?e.mute(!0):e.volume(h-.1),r(b);break;case c.UP:d?e.mute(!1):e.volume(h+.1),r(b);break;case c.LEFT:d?e.seek(g-.1*f):e.seek(g-15),r(b);break;case c.RIGHT:d?e.seek(g+.1*f):e.seek(g+15),r(b);break;case c.HOME:e.seek(0),r(b);break;case c.END:e.seek(f-1),r(b);break;case c.TAB:var i=this._oldFocus;this._tabDown||!i||i.is(":hidden")||i.is(":disabled")||(i.focus(),r(b)),this._oldFocus=null,this._tabDown=!0}},_keyUp:function(b){b.keyCode===a.ui.keyCode.TAB&&(this._tabDown=!1)},_fullscreenZone:function(a){var b=this.player.fullScreenElement,c=this._fullscreenZoneObj;b&&(c||(c=new n(b),this._fullscreenZoneObj=c),c[a]())},mode:function(){return this._isInternal?this.player.options.mode:"external"},talk:function(a){return arguments.length&&(this.queue(a),this._trigger("requestplay")),this.options.currentTalk},talks:function(){return this.player.talks},toggle:function(){this[this._isPlaying?"pause":"play"]()},play:function(){this._trigger("requestplay")},playNext:function(){this._trigger("requestnext"),this.player.playNext()},playPrev:function(){this._trigger("requestprev"),this.player.playPrev()},pause:function(){this._trigger("requestpause")},_playbackRate:null,playbackRate:function(a){return arguments.length&&(this.player.playbackRate(a),this._playbackRate=a),this._playbackRate},_popOut:!1,popOut:function(a){return arguments.length&&(this.player.popOut(a),this._popOut=a),this._popOut},queue:function(a){this._queuedTalkId=a},sendAds:function(a){this.player.sendAds(a)},seek:function(a,b){this.options.startTrackingAt=b?a:0,this.player.seek(a)},_subtitle:null,subtitle:function(a){if(arguments.length){var c=!!a&&b.find(this.talk().languages,{languageCode:a});this.player.subtitle(a),this._subtitle=c}return this._subtitle},_volume:null,volume:function(a){return arguments.length&&this.player.volume(a),this._volume},_muted:null,mute:function(a){return arguments.length&&this.player.mute(a),this._muted},toggleFullScreen:function(){var b=a("html,body"),c=a(document).scrollTop(),d=a(this.element),e=d.offset().top;c>e&&b.scrollTop(e),this[this.player.isFullScreen?"cancelFullScreen":"requestFullScreen"](this.elements.container.get(0))},requestFullScreen:function(a){this.player.requestFullScreen(a)},cancelFullScreen:function(a){this.player.cancelFullScreen(a)},isControllable:function(){return this._isInternal},isFullScreen:function(){return!!this._isInternal&&this.player.isFullScreen},isMai:function(){var a=this.mode();return("hls"===a||"hlsjs"===a)&&this._playerOption("mai")&&this._playerOption("maiAdUnitId")},canFullScreen:function(){return!!this._isInternal&&this.player.canFullScreen},canPlaybackRate:function(){return!!this._isInternal&&this.player.canPlaybackRate},canPopOut:function(){return!!this._isInternal&&this.player.canPopOut},canSubtitle:function(){var a=String(this.player.mode);return this._isInternal&&"flash"===a},capQualityToStage:function(a){this.player.capQualityToStage(a)},maiAdUnitId:function(){return this._playerOption("maiAdUnitId")}}),function(b,c){return a(b).player(c)}}),define("apps/embeddable/views/player",["jquery","lodash","./base","utils/is_mobile","hbs!apps/embeddable/templates/player","widgets/player"],function(a,b,c,d,e){"use strict";var f=c.extend({play:function(){this.state.set("activated",!0),this.$player.player("play")},pause:function(){this.$player.player("pause")},talk:function(a){this.$player.player("talk",a.get("id"))},mute:function(){this.$player.player("mute",!0)},unmute:function(){this.$player.player("mute",!1)},volume:function(a){this.$player.player("volume",a)},subtitle:function(a){this.$player.player("subtitle",a)},fullscreen:function(){this.$player.player("requestFullScreen",this.fullscreenElement||this.el)},smallscreen:function(){this.$player.player("cancelFullScreen",this.fullscreenElement||this.el)},seek:function(a){this.$player.player("seek",a)},fullscreenElement:null,className:"Embeddable__player",events:{playererror:function(a,b){var c=b.error,d="client"===c.type?"client":null;"abortive"===c.severity&&this.state.set("error",d||"init"),"fatal"===c.severity&&this.state.set("error",d||"fatal")},playerready:function(){this.state.set("ready",!0),this._checkCapabilities()},playerplay:function(){this.state.set("playing",!0),this.state.set("paused",!1),this.state.set("ended",!1)},playerpause:function(){this.state.set("paused",!0),this.state.set("playing",!1)},playerduration:function(a,b){var c=this.$player.player("talk").id,d=this.talks.get(c);d.set("duration",b.duration),this.state.set("duration",b.duration)},playercurrenttime:function(a,b){this.state.set("currentTime",b.currentTime)},playertalk:function(a,b){this.state.set("postrolling",!1),this.state.set("talk",this.talks.get(b.id))},playerended:function(){this.state.set("paused",!1),this.state.set("playing",!1),this.state.set("ended",!0)},playervolume:function(a,b){this.state.set("volume",b.volume)},playermuted:function(a,b){this.state.set("muted",b.muted)},playersubtitle:function(a,b){this.state.set("subtitle",b&&b.subtitle&&b.subtitle.languageCode)},playerenterfullscreen:function(){this.state.set("fullscreen",!0)},playerexitfullscreen:function(){this.state.set("fullscreen",!1)},playerpostrollstart:function(){this.state.set("postrolling",!0)},playerpostrollcomplete:function(){this.state.set("postrolling",!1)}},propsDefaults:{defaultSubtitleLanguage:"en"},stateDefaults:{nativeControls:!1,activated:!1,ended:!1,error:!1,ready:!1,playing:!1,paused:!1,duration:null,currentTime:null,talk:null,volume:.5,canVolume:!1,muted:!1,subtitle:!1,canSubtitle:!1,fullscreen:!1,canFullscreen:!1,postrolling:!1},stateEvents:{"change:nativeControls":function(a,b){b?this.find("video").attr("controls","controls"):this.find("video").removeAttr("controls")},"on:activated":function(){this.$el.addClass("Embeddable__player--activated")}},initialize:function(a){this.talks=a.talks,this.fullscreenElement=a.fullscreenElement||null,this.initializeState(),this.initializeProps()},render:function(){return this.$el.html(e()),this.$player=this.$el.find("div.Embeddable__player__object"),this.$player.player({breakpoint:!1,nativeLanguage:this.props.get("defaultSubtitleLanguage"),talks:this.talks.toPlayer(),recordInIdentity:!1,uncropped:!1}),this},_canFullscreen:function(){return!!this.$player.player("canFullScreen")&&!d()},_checkCapabilities:function(){var a=this._canFullscreen(),b=this.$player.player("canSubtitle"),c=this.$player.player("mode");this.state.set("canFullscreen",a),this.state.set("canVolume","flash"===c),this.state.set("canSubtitle",b),"flash"===c||a||this.state.set("nativeControls",!0)}});return f}),define("apps/embeddable/views/canonball",["./base"],function(a){"use strict";var b=a.extend({className:"Embeddable__canonball ted-logo",tagName:"a",attributes:{href:"#",target:"_blank"},propsDefaults:{enabled:!1,visible:!1,url:"https://www.ted.com/"},propsEvents:{"change:url":"render","change:enabled":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__canonball--enabled")},"change:visible":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__canonball--visible")}},render:function(){var a=this.props.get("url")||this.propsDefaults.url;this.$el.attr("href",a)}});return b}),define("hbs!apps/embeddable/templates/ended",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){return"?utm_source=embedPlayer&utm_medium=referral&utm_campaign=embed_newsletter"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="vc">\n  <div class="vc__wrap">\n    <div class="hpad2 inverse text-center">\n      <div class="m2">\n        Enjoy watching TED talks?<br>\n        <a href="https://www.ted.com/newsletter'+(null!=(e=b.unless.call(a,null!=a?a.disableCampaigns:a,{name:"unless",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'" target="_blank">Get new talks in your inbox</a>\n      </div>\n\n      <a hre="#" class="Embeddable__ended__rewatch button button--highlight" role="button">Rewatch</a>\n    </div>\n  </div>\n</div>\n'},useData:!0});return b.registerPartial("apps/embeddable/templates/ended",c),c}),define("apps/embeddable/views/ended",["./base","hbs!apps/embeddable/templates/ended"],function(a,b){"use strict";var c=a.extend({className:"Embeddable__ended",events:{"click a.Embeddable__ended__rewatch":function(){this.state.set("rewatchPending",!0)}},propsDefaults:{activated:!1,disableCampaigns:!1},propsEvents:{"change:activated":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__ended--activated"),this.state.set("rewatchPending",!1)},"change:disableCampaigns":function(){this.render()}},stateDefaults:{rewatchPending:!1},stateEvents:{"change:rewatchPending":function(a,b){this.$el[b?"addClass":"removeClass"]("Embeddable__ended--rewatching")}},render:function(){this.$el.html(b(this.props.toJSON()))}});return c}),define("apps/embeddable/app",["jquery","lodash","lib/ads","hbs!apps/embeddable/templates/error","apps/embeddable/collections/talks","apps/embeddable/views/chrome","apps/embeddable/views/player","apps/embeddable/views/canonball","apps/embeddable/views/ended","widgets/hover"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){function c(){o.props.set("enabled",n.props.get("activated")&&!n.props.get("postrolling")&&!n.props.get("hideBranding")),o.props.set("visible",n.props.get("hovering")&&!n.props.get("fullscreen")||m.state.get("paused"))}function j(){n.props.set("visible",n.props.get("hovering")||m.state.get("paused"))}var k=a(b.el),l=new e(b.talks),m=new g({fullscreenElement:b.el,talks:l}),n=new f({talks:l}),o=new h,p=new i;n.props.set("hideBranding",b.hideBranding),p.props.set("disableCampaigns",b.disableCampaigns),m.props.set("defaultSubtitleLanguage",b.subtitleLang),o.props.set("url",b.canonicalUrl),m.state.on("change:error",function(a,c){k.html(d({isClient:"client"===c,isInit:"init"===c,isFatal:"fatal"===c,url:b.canonicalUrl}))}),m.state.on("change:nativeControls",function(a,b){n.props.set("enabled",!b)}),m.state.on("change:activated",function(a,b){k.addClass("Embeddable--activated"),k.removeClass("Embeddable--activating"),n.props.set("activated",b)}),m.state.on("change:playing",function(a,b){n.props.set("playing",b)}),m.state.on("change:paused",function(a,b){n.props.set("paused",b)}),m.state.on("change:duration",function(a,b){n.props.set("duration",b)}),m.state.on("change:currentTime",function(a,b){n.props.set("currentTime",b)}),m.state.on("change:ended",function(a,b){p.props.set("activated",b)}),m.state.on("change:talk",function(a,b){n.props.set("talk",b),n.props.set("next",l.after(b)||null),n.props.set("prev",l.before(b)||null)}),m.state.on("change:volume",function(a,b){n.props.set("volume",b)}),m.state.on("change:canVolume",function(a,b){n.props.set("canVolume",b)}),m.state.on("change:muted",function(a,b){n.props.set("muted",b)}),m.state.on("change:subtitle",function(a,b){n.props.set("subtitle",b)}),m.state.on("change:canSubtitle",function(a,b){n.props.set("canSubtitle",b)}),m.state.on("change:fullscreen",function(a,b){n.props.set("fullscreen",b)}),m.state.on("change:canFullscreen",function(a,b){n.props.set("canFullscreen",b)}),m.state.on("change:postrolling",function(a,b){n.props.set("postrolling",b)}),n.state.on("change:playPending",function(a,b){b&&m.play()}),n.state.on("change:pausePending",function(a,b){b&&m.pause()}),n.state.on("change:pendingTalk",function(a,b){b&&m.talk(b)}),n.state.on("change:mutePending",function(a,b){b&&m.mute()}),n.state.on("change:unmutePending",function(a,b){
b&&m.unmute()}),n.state.on("change:pendingVolume",function(a,b){null!=b&&m.volume(b)}),n.state.on("change:pendingSubtitle",function(a,b){null!==b&&(b?m.subtitle(b):m.subtitle(!1))}),n.state.on("change:fullscreenPending",function(a,b){b&&m.fullscreen()}),n.state.on("change:smallscreenPending",function(a,b){b&&m.smallscreen()}),n.state.on("change:pendingSeek",function(a,b){null!=b&&m.seek(b)}),p.state.on("change:rewatchPending",function(a,b){b&&(m.seek(0),m.play())}),n.props.on("change:activated",c),n.props.on("change:hovering",c),n.props.on("change:postrolling",c),n.props.on("change:fullscreen",c),m.state.on("change:paused",c),n.props.on("change:hovering",j),n.state.on("change:paused",j),k.hover().on("hoverstart",function(){n.props.set("hovering",!0)}).on("hoverstop",function(){n.props.set("hovering",!1)}),this.$el=k,this.talks=l,this.player=m,this.chrome=n,this.canonball=o,this.ended=p}return b.extend(j.prototype,{activate:function(){this.$el.addClass("Embeddable--activating"),this.player.play()},render:function(){this.$el.prepend(this.player.$el),this.$el.append(this.canonball.$el),this.$el.append(this.chrome.$el),this.$el.append(this.ended.$el),this.ended.render(),this.chrome.render(),this.player.render(),c.initPlayer(this.player.$player)}}),j.init=function(a){var c=new j({el:a.el,canonicalUrl:a.canonicalUrl,disableCampaigns:!!a.disableCampaigns,hideBranding:!!a.hideBranding,subtitleLang:a.subtitleLang,talks:a.talks});c.$el.data("embeddable",c),c.render(),c.player.state.once("change:ready",function(){window[a.activate]=b.once(function(){c.activate()}),c.$el.hasClass("Embeddable--activating")&&window[a.activate]()})},j}),define("embed",["dq","apps/embeddable/app","lib/ads"],function(a,b,c){"use strict";a({q:window._q,modules:{embeddable:b}}),a({q:window._g,modules:{ads:c}})})}();